<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ps2sdk: Kernel</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="code.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ps2sdk
   &#160;<span id="projectnumber">1.1</span>
   </div>
   <div id="projectbrief">A collection of Open Source libraries used for developing applications on Sony&#39;s PlayStation 2Â® (PS2).</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group__libkernel.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Modules</a>  </div>
  <div class="headertitle">
<div class="title">Kernel</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:group__cache"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cache.html">Cache</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__loadfile"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__loadfile.html">EE Loadfile: ELF and IRX loader client library.</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__interrupt"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__interrupt.html">Interrupts</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__semaphore"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__semaphore.html">Semaphores</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__thread"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__thread.html">Threads</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__timer"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__timer.html">Timers</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>The core library of the EE. </p>


<h3><a id="kernel_main"></a>Overview</h3><div class="textblock">Based on the EE kernel emulation in the Play! PS2 Emulator and my own tests.<h1><a class="anchor" id="sema_main"></a>
Semaphores</h1>
<p>Synchronization on the EE is provided by semaphores. Semaphores have a wait queue for threads when the resource is used.</p>
<h2><a class="anchor" id="sema_attr"></a>
Attributes</h2>
<dl class="section user"><dt>sema.count</dt><dd>Filled by <a class="el" href="kernel_8h.html#a29c2cd355bfc9cb4f0b799c80986f7d0">ReferSemaStatus()</a>. The current count.</dd></dl>
<dl class="section user"><dt>sema.max_count</dt><dd>The number of times the semaphore can be used.</dd></dl>
<dl class="section user"><dt>sema.init_count</dt><dd>The initial count value when creating the semaphore.</dd></dl>
<dl class="section user"><dt>sema.wait_threads</dt><dd>The number of threads waiting on the semaphore.</dd></dl>
<dl class="section user"><dt>sema.option</dt><dd>A pointer to user data. E.g. A string constant describing its use.</dd></dl>
<h2><a class="anchor" id="sema_mutex"></a>
Mutexes</h2>
<p>A mutex is a semaphore that allows only one running thread into a critical section of code.</p>
<dl class="section user"><dt>sema.max_count</dt><dd>Set the max count to 1.</dd></dl>
<dl class="section user"><dt>sema.init_count</dt><dd>To create a mutex locked, set the init_count to 0.</dd></dl>
<dl class="section user"><dt>sema.init_count</dt><dd>To create a mutex unlocked, set the init_count to 1.</dd></dl>
<h2><a class="anchor" id="sema_using"></a>
Using Semaphores</h2>
<p>The functions with a lowercase 'i' should be used when interrupts are disabled like when in an interrupt handler. </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#a003e696233a4735eb9994a2b491f62b1">CreateSema</a>(<a class="code" href="structee__sema__t.html">ee_sema_t</a> *sema);</div>
<div class="ttc" id="akernel_8h_html_a003e696233a4735eb9994a2b491f62b1"><div class="ttname"><a href="kernel_8h.html#a003e696233a4735eb9994a2b491f62b1">CreateSema</a></div><div class="ttdeci">s32 CreateSema(ee_sema_t *sema)</div></div>
<div class="ttc" id="astructee__sema__t_html"><div class="ttname"><a href="structee__sema__t.html">ee_sema_t</a></div><div class="ttdef"><b>Definition:</b> <a href="kernel_8h_source.html#l00214">kernel.h:215</a></div></div>
</div><!-- fragment --><p> Returns the id of the semaphore. </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#a9229c0a80194a094ab2c779ea00f7b5a">WaitSema</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>);</div>
<div class="ttc" id="akernel_8h_html_a9229c0a80194a094ab2c779ea00f7b5a"><div class="ttname"><a href="kernel_8h.html#a9229c0a80194a094ab2c779ea00f7b5a">WaitSema</a></div><div class="ttdeci">s32 WaitSema(s32 sema_id)</div></div>
</div><!-- fragment --><p> A thread calls <a class="el" href="kernel_8h.html#a9229c0a80194a094ab2c779ea00f7b5a">WaitSema()</a> decreasing the count using the resource. When another thread calls <a class="el" href="kernel_8h.html#a9229c0a80194a094ab2c779ea00f7b5a">WaitSema()</a>, if the count is 0, that thread is put into the semaphore's wait queue. </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#a159ff7f20989dcdad64967f34985e3a3">SignalSema</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>);</div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#a1fd7a2fbd593d43493e15e1b675009d5">iSignalSema</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>);</div>
<div class="ttc" id="akernel_8h_html_a159ff7f20989dcdad64967f34985e3a3"><div class="ttname"><a href="kernel_8h.html#a159ff7f20989dcdad64967f34985e3a3">SignalSema</a></div><div class="ttdeci">s32 SignalSema(s32 sema_id)</div></div>
<div class="ttc" id="akernel_8h_html_a1fd7a2fbd593d43493e15e1b675009d5"><div class="ttname"><a href="kernel_8h.html#a1fd7a2fbd593d43493e15e1b675009d5">iSignalSema</a></div><div class="ttdeci">s32 iSignalSema(s32 sema_id)</div></div>
</div><!-- fragment --><p> A thread calls <a class="el" href="kernel_8h.html#a159ff7f20989dcdad64967f34985e3a3">SignalSema()</a> increasing the count returning the resource. The next thread waiting in the semaphore's queue is run. </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#a90b3032d244216ff9f19173d02c0de18">PollSema</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>);</div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#a210a00bf0b988add7891277f9eafcc3e">iPollSema</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>);</div>
<div class="ttc" id="akernel_8h_html_a210a00bf0b988add7891277f9eafcc3e"><div class="ttname"><a href="kernel_8h.html#a210a00bf0b988add7891277f9eafcc3e">iPollSema</a></div><div class="ttdeci">s32 iPollSema(s32 sema_id)</div></div>
<div class="ttc" id="akernel_8h_html_a90b3032d244216ff9f19173d02c0de18"><div class="ttname"><a href="kernel_8h.html#a90b3032d244216ff9f19173d02c0de18">PollSema</a></div><div class="ttdeci">s32 PollSema(s32 sema_id)</div></div>
</div><!-- fragment --><p> A thread calls <a class="el" href="kernel_8h.html#a90b3032d244216ff9f19173d02c0de18">PollSema()</a> decreasing the count using the resource. If the count is already zero, it does not put the thread calling <a class="el" href="kernel_8h.html#a90b3032d244216ff9f19173d02c0de18">PollSema()</a> into a wait state, but returns an error.</p>
<p>Using <a class="el" href="kernel_8h.html#a90b3032d244216ff9f19173d02c0de18">PollSema()</a> prior to <a class="el" href="kernel_8h.html#a9229c0a80194a094ab2c779ea00f7b5a">WaitSema()</a> on a semaphore acting as a mutex can create a race condition.</p>
<dl class="section user"><dt>E.g.</dt><dd>A thread calls <a class="el" href="kernel_8h.html#a159ff7f20989dcdad64967f34985e3a3">SignalSema()</a> on a semaphore, then a thread using <a class="el" href="kernel_8h.html#a90b3032d244216ff9f19173d02c0de18">PollSema()</a> uses the resource. <a class="el" href="kernel_8h.html#a9229c0a80194a094ab2c779ea00f7b5a">WaitSema()</a> then puts the next thread into wait status. No other threads are in the critical section of code to call <a class="el" href="kernel_8h.html#a159ff7f20989dcdad64967f34985e3a3">SignalSema()</a> to free the resource.</dd></dl>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#a18758b3f3855b1d3f9362c10fb610c02">DeleteSema</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>);</div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#a210e50a587ff6621a2ff4e789041f4ab">iDeleteSema</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>);</div>
<div class="ttc" id="akernel_8h_html_a18758b3f3855b1d3f9362c10fb610c02"><div class="ttname"><a href="kernel_8h.html#a18758b3f3855b1d3f9362c10fb610c02">DeleteSema</a></div><div class="ttdeci">s32 DeleteSema(s32 sema_id)</div></div>
<div class="ttc" id="akernel_8h_html_a210e50a587ff6621a2ff4e789041f4ab"><div class="ttname"><a href="kernel_8h.html#a210e50a587ff6621a2ff4e789041f4ab">iDeleteSema</a></div><div class="ttdeci">s32 iDeleteSema(s32 sema_id)</div></div>
</div><!-- fragment --><p> After <a class="el" href="kernel_8h.html#a18758b3f3855b1d3f9362c10fb610c02">DeleteSema()</a> is called, threads in the semaphore's wait queue are returned to running status, the semaphore is deleted, and calls referring to the semaphore return an error. </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#a29c2cd355bfc9cb4f0b799c80986f7d0">ReferSemaStatus</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>, <a class="code" href="structee__sema__t.html">ee_sema_t</a> *sema);</div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#aad9580468b94f92fe8c0a341c16b4b24">iReferSemaStatus</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>, <a class="code" href="structee__sema__t.html">ee_sema_t</a> *sema);</div>
<div class="ttc" id="akernel_8h_html_a29c2cd355bfc9cb4f0b799c80986f7d0"><div class="ttname"><a href="kernel_8h.html#a29c2cd355bfc9cb4f0b799c80986f7d0">ReferSemaStatus</a></div><div class="ttdeci">s32 ReferSemaStatus(s32 sema_id, ee_sema_t *sema)</div></div>
<div class="ttc" id="akernel_8h_html_aad9580468b94f92fe8c0a341c16b4b24"><div class="ttname"><a href="kernel_8h.html#aad9580468b94f92fe8c0a341c16b4b24">iReferSemaStatus</a></div><div class="ttdeci">s32 iReferSemaStatus(s32 sema_id, ee_sema_t *sema)</div></div>
</div><!-- fragment --><p> <a class="el" href="kernel_8h.html#a29c2cd355bfc9cb4f0b799c80986f7d0">ReferSemaStatus()</a> can be used to check the current count, the max_count, and number of threads waiting on the semaphore.</p>
<h1><a class="anchor" id="threads_main"></a>
Threads</h1>
<p>Multithreading on the EE kernel is cooperative. The kernel provides a pool of 256 threads to be used. A few are reserved for fixing bugs and various libraries on the EE may run their own.</p>
<h2><a class="anchor" id="threads_coop"></a>
Cooperative Multithreading</h2>
<p>Threads with a higher priority have to cede control to other threads. Threads with a longer amount of execution time will take time away from other threads since there isn't a regular preemptive schedule.</p>
<h2><a class="anchor" id="threads_attr"></a>
Attributes</h2>
<dl class="section user"><dt>thread.status</dt><dd>Status of the thread.</dd></dl>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Status   </th><th class="markdownTableHeadNone">Effect    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">THS_RUN   </td><td class="markdownTableBodyNone">Running    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">THS_READY   </td><td class="markdownTableBodyNone">Ready to run    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">THS_WAIT   </td><td class="markdownTableBodyNone">Waiting    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">THS_SUSPEND   </td><td class="markdownTableBodyNone">Suspended    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">THS_DORMANT   </td><td class="markdownTableBodyNone">Newly created or terminated   </td></tr>
</table>
<p>Threads in THS_WAIT state can be suspended, too.</p>
<dl class="section user"><dt>thread.func</dt><dd>Function for the thread to run.</dd></dl>
<dl class="section user"><dt>thread.stack</dt><dd>Memory aligned to 16 byte boundary to use as stack.</dd></dl>
<dl class="section user"><dt>thread.stack_size</dt><dd>Since the stack is 16-byte aligned, size is a multiple of 16.</dd></dl>
<dl class="section user"><dt>thread.gp_reg</dt><dd>Pointer to global offset (the symbol _gp is defined by the linkscript).</dd></dl>
<dl class="section user"><dt>thread.initial_priority</dt><dd>Initial priority when using <a class="el" href="kernel_8h.html#a59b879dd2406903437ca89da03fd3fbe">CreateThread()</a>. 0 - 127 (lower number is higher priority, but 0 is reserved by the kernel).</dd></dl>
<dl class="section user"><dt>thread.current_priority</dt><dd>Filled by <a class="el" href="kernel_8h.html#a57c83fc9996f248665485a9e3f46e4cd">ReferThreadStatus()</a>. Contains the thread's current priority.</dd></dl>
<dl class="section user"><dt>thread.option</dt><dd>Pointer to user data. Documented not to work.</dd></dl>
<dl class="section user"><dt>thread.waitType</dt><dd>Filled by <a class="el" href="kernel_8h.html#a57c83fc9996f248665485a9e3f46e4cd">ReferThreadStatus()</a>. Contains why the thread is waiting.</dd></dl>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Reason    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">THS_WT_NONE   </td><td class="markdownTableBodyNone">Not waiting    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">THS_WT_WAKE   </td><td class="markdownTableBodyNone">Waiting for wakeup    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">THS_WT_SEMA   </td><td class="markdownTableBodyNone">Waiting for semaphore   </td></tr>
</table>
<p>If a thread state is THS_WAIT and the wait type is THS_WT_WAKE, then the thread has been put to sleep using <a class="el" href="kernel_8h.html#a9ace9207a2313dead9a46db9eff452f5">SleepThread()</a>.</p>
<dl class="section user"><dt>thread.waitId</dt><dd>Filled by <a class="el" href="kernel_8h.html#a57c83fc9996f248665485a9e3f46e4cd">ReferThreadStatus()</a>. Contains the semaphore's ID if waiting on a semaphore.</dd></dl>
<dl class="section user"><dt>thread.wakeupCount</dt><dd>Filled by <a class="el" href="kernel_8h.html#a57c83fc9996f248665485a9e3f46e4cd">ReferThreadStatus()</a>. Contains the number of times other threads have tried to wake up the thread when it wasn't sleeping.</dd></dl>
<h2><a class="anchor" id="threads_using"></a>
Using Threads</h2>
<p>The functions with a lowercase 'i' should be used when interrupts are disabled like when in an interrupt handler. </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#a59b879dd2406903437ca89da03fd3fbe">CreateThread</a>(<a class="code" href="structee__thread__t.html">ee_thread_t</a> *thread);</div>
<div class="ttc" id="akernel_8h_html_a59b879dd2406903437ca89da03fd3fbe"><div class="ttname"><a href="kernel_8h.html#a59b879dd2406903437ca89da03fd3fbe">CreateThread</a></div><div class="ttdeci">s32 CreateThread(ee_thread_t *thread)</div></div>
<div class="ttc" id="astructee__thread__t_html"><div class="ttname"><a href="structee__thread__t.html">ee_thread_t</a></div><div class="ttdef"><b>Definition:</b> <a href="kernel_8h_source.html#l00224">kernel.h:225</a></div></div>
</div><!-- fragment --><p> Create the thread and put it into THS_DORMANT state. Returns thread's id on success. </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#ae853a3b5117773ac0e0cdc048b836a13">DeleteThread</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>);</div>
<div class="ttc" id="akernel_8h_html_ae853a3b5117773ac0e0cdc048b836a13"><div class="ttname"><a href="kernel_8h.html#ae853a3b5117773ac0e0cdc048b836a13">DeleteThread</a></div><div class="ttdeci">s32 DeleteThread(s32 thread_id)</div></div>
</div><!-- fragment --><p> Deletes THS_DORMANT thread from another thread. </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#a953c03138db564d52015c4912f148226">StartThread</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>);</div>
<div class="ttc" id="akernel_8h_html_a953c03138db564d52015c4912f148226"><div class="ttname"><a href="kernel_8h.html#a953c03138db564d52015c4912f148226">StartThread</a></div><div class="ttdeci">s32 StartThread(s32 thread_id, void *args)</div></div>
</div><!-- fragment --><p> Starts a THS_DORMANT thread. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="kernel_8h.html#a6e5cad73808b1129c5f67483af44431f">ExitThread</a>(<span class="keywordtype">void</span>);</div>
<div class="ttc" id="akernel_8h_html_a6e5cad73808b1129c5f67483af44431f"><div class="ttname"><a href="kernel_8h.html#a6e5cad73808b1129c5f67483af44431f">ExitThread</a></div><div class="ttdeci">void ExitThread(void)</div></div>
</div><!-- fragment --><p> Changes the calling thread to THS_DORMANT. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="kernel_8h.html#a9c2b1f2ee2847c00704c14ec31476354">ExitDeleteThread</a>(<span class="keywordtype">void</span>);</div>
<div class="ttc" id="akernel_8h_html_a9c2b1f2ee2847c00704c14ec31476354"><div class="ttname"><a href="kernel_8h.html#a9c2b1f2ee2847c00704c14ec31476354">ExitDeleteThread</a></div><div class="ttdeci">void ExitDeleteThread(void)</div></div>
</div><!-- fragment --><p> Changes the calling thread to THS_DORMANT then returns it to internal pool. </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#a9ace9207a2313dead9a46db9eff452f5">SleepThread</a>(<span class="keywordtype">void</span>);</div>
<div class="ttc" id="akernel_8h_html_a9ace9207a2313dead9a46db9eff452f5"><div class="ttname"><a href="kernel_8h.html#a9ace9207a2313dead9a46db9eff452f5">SleepThread</a></div><div class="ttdeci">s32 SleepThread(void)</div></div>
</div><!-- fragment --><p> If the wakeupCount is 0, puts the current thread into THS_WAIT status. </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#affe1f95531f7255bd9bc1a6c6b60b37b">GetThreadId</a>(<span class="keywordtype">void</span>);</div>
<div class="ttc" id="akernel_8h_html_affe1f95531f7255bd9bc1a6c6b60b37b"><div class="ttname"><a href="kernel_8h.html#affe1f95531f7255bd9bc1a6c6b60b37b">GetThreadId</a></div><div class="ttdeci">s32 GetThreadId(void)</div></div>
</div><!-- fragment --><p> Returns the id of the current thread. </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#ad691068f188bb2170bc9181010fe8dad">TerminateThread</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>);</div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#a86f49b940b2041d2698ad836a89a5c54">iTerminateThread</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>);</div>
<div class="ttc" id="akernel_8h_html_a86f49b940b2041d2698ad836a89a5c54"><div class="ttname"><a href="kernel_8h.html#a86f49b940b2041d2698ad836a89a5c54">iTerminateThread</a></div><div class="ttdeci">s32 iTerminateThread(s32 thread_id)</div></div>
<div class="ttc" id="akernel_8h_html_ad691068f188bb2170bc9181010fe8dad"><div class="ttname"><a href="kernel_8h.html#ad691068f188bb2170bc9181010fe8dad">TerminateThread</a></div><div class="ttdeci">s32 TerminateThread(s32 thread_id)</div></div>
</div><!-- fragment --><p> Changes a thread to THS_DORMANT state from another thread. </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#af84ed779828ab1dd1e01aff9c82ea4e7">ChangeThreadPriority</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">int</span> priority);</div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#acfcd42c3fa887f3c2904d017036ae0db">iChangeThreadPriority</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">int</span> priority);</div>
<div class="ttc" id="akernel_8h_html_acfcd42c3fa887f3c2904d017036ae0db"><div class="ttname"><a href="kernel_8h.html#acfcd42c3fa887f3c2904d017036ae0db">iChangeThreadPriority</a></div><div class="ttdeci">s32 iChangeThreadPriority(s32 thread_id, s32 priority)</div></div>
<div class="ttc" id="akernel_8h_html_af84ed779828ab1dd1e01aff9c82ea4e7"><div class="ttname"><a href="kernel_8h.html#af84ed779828ab1dd1e01aff9c82ea4e7">ChangeThreadPriority</a></div><div class="ttdeci">s32 ChangeThreadPriority(s32 thread_id, s32 priority)</div></div>
</div><!-- fragment --><p> Changes a thread's priority and schedules it at the bottom of that priority's queue </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#ad300fac96b4ae0a7aa1df2e0c93ecd81">RotateThreadReadyQueue</a>(<span class="keywordtype">int</span> priority);</div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#a58799014f0d5e6d36a220c882cf3a533">iRotateThreadReadyQueue</a>(<span class="keywordtype">int</span> priority);</div>
<div class="ttc" id="akernel_8h_html_a58799014f0d5e6d36a220c882cf3a533"><div class="ttname"><a href="kernel_8h.html#a58799014f0d5e6d36a220c882cf3a533">iRotateThreadReadyQueue</a></div><div class="ttdeci">s32 iRotateThreadReadyQueue(s32 priority)</div></div>
<div class="ttc" id="akernel_8h_html_ad300fac96b4ae0a7aa1df2e0c93ecd81"><div class="ttname"><a href="kernel_8h.html#ad300fac96b4ae0a7aa1df2e0c93ecd81">RotateThreadReadyQueue</a></div><div class="ttdeci">s32 RotateThreadReadyQueue(s32 priority)</div></div>
</div><!-- fragment --><p> Finds first ready or running thread of a given priority and schedules it at the bottom of the queue. </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#a7a18aeb1b5e8cfb5e635e54cb737788a">ReleaseWaitThread</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>);</div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#a6d99dea8bccfef3e31549c53b4667d0d">iReleaseWaitThread</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>);</div>
<div class="ttc" id="akernel_8h_html_a6d99dea8bccfef3e31549c53b4667d0d"><div class="ttname"><a href="kernel_8h.html#a6d99dea8bccfef3e31549c53b4667d0d">iReleaseWaitThread</a></div><div class="ttdeci">s32 iReleaseWaitThread(s32 thread_id)</div></div>
<div class="ttc" id="akernel_8h_html_a7a18aeb1b5e8cfb5e635e54cb737788a"><div class="ttname"><a href="kernel_8h.html#a7a18aeb1b5e8cfb5e635e54cb737788a">ReleaseWaitThread</a></div><div class="ttdeci">s32 ReleaseWaitThread(s32 thread_id)</div></div>
</div><!-- fragment --><p> Release a thread from THS_WAIT state. </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#a8f222e9c2c34c56f09827a2e13138a1a">WakeupThread</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>);</div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#a00fb0f646deb9cabd1770e10e51bd1d2">iWakeupThread</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>);</div>
<div class="ttc" id="akernel_8h_html_a00fb0f646deb9cabd1770e10e51bd1d2"><div class="ttname"><a href="kernel_8h.html#a00fb0f646deb9cabd1770e10e51bd1d2">iWakeupThread</a></div><div class="ttdeci">s32 iWakeupThread(s32 thread_id)</div></div>
<div class="ttc" id="akernel_8h_html_a8f222e9c2c34c56f09827a2e13138a1a"><div class="ttname"><a href="kernel_8h.html#a8f222e9c2c34c56f09827a2e13138a1a">WakeupThread</a></div><div class="ttdeci">s32 WakeupThread(s32 thread_id)</div></div>
</div><!-- fragment --><p> Removes THS_WAIT status from a thread. If the thread isn't in wait status, the wakeupCount is incremented. </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#ae35456715513beb729e35fc98b9e41d0">CancelWakeupThread</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>);</div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#abfe4973e133ea3a7446a22cb7679c723">iCancelWakeupThread</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>);</div>
<div class="ttc" id="akernel_8h_html_abfe4973e133ea3a7446a22cb7679c723"><div class="ttname"><a href="kernel_8h.html#abfe4973e133ea3a7446a22cb7679c723">iCancelWakeupThread</a></div><div class="ttdeci">s32 iCancelWakeupThread(s32 thread_id)</div></div>
<div class="ttc" id="akernel_8h_html_ae35456715513beb729e35fc98b9e41d0"><div class="ttname"><a href="kernel_8h.html#ae35456715513beb729e35fc98b9e41d0">CancelWakeupThread</a></div><div class="ttdeci">s32 CancelWakeupThread(s32 thread_id)</div></div>
</div><!-- fragment --><p> Set thread's wakeupCount to 0. </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#af3f396b5a81b66a0c0ff3d6c8e773643">SuspendThread</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>);</div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#a83313d887241fd0157f03b1667dffafd">iSuspendThread</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>);</div>
<div class="ttc" id="akernel_8h_html_a83313d887241fd0157f03b1667dffafd"><div class="ttname"><a href="kernel_8h.html#a83313d887241fd0157f03b1667dffafd">iSuspendThread</a></div><div class="ttdeci">s32 iSuspendThread(s32 thread_id)</div></div>
<div class="ttc" id="akernel_8h_html_af3f396b5a81b66a0c0ff3d6c8e773643"><div class="ttname"><a href="kernel_8h.html#af3f396b5a81b66a0c0ff3d6c8e773643">SuspendThread</a></div><div class="ttdeci">s32 SuspendThread(s32 thread_id)</div></div>
</div><!-- fragment --><p> Suspends a thread, adding THS_SUSPEND to its status. </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#a877ec5310bac4a3659159644bc9f8a90">ResumeThread</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>);</div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#a28afb886d74753c29e45b9b7a3abf594">iResumeThread</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>);</div>
<div class="ttc" id="akernel_8h_html_a28afb886d74753c29e45b9b7a3abf594"><div class="ttname"><a href="kernel_8h.html#a28afb886d74753c29e45b9b7a3abf594">iResumeThread</a></div><div class="ttdeci">s32 iResumeThread(s32 thread_id)</div></div>
<div class="ttc" id="akernel_8h_html_a877ec5310bac4a3659159644bc9f8a90"><div class="ttname"><a href="kernel_8h.html#a877ec5310bac4a3659159644bc9f8a90">ResumeThread</a></div><div class="ttdeci">s32 ResumeThread(s32 thread_id)</div></div>
</div><!-- fragment --><p> Removes THS_SUSPEND state from a thread. </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#a57c83fc9996f248665485a9e3f46e4cd">ReferThreadStatus</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>, <a class="code" href="structee__thread__status__t.html">ee_thread_status_t</a> *status);</div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="kernel_8h.html#acabd2f4762dcc0b4acfd02043a411cf6">iReferThreadStatus</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>, <a class="code" href="structee__thread__status__t.html">ee_thread_status_t</a> *status);</div>
<div class="ttc" id="akernel_8h_html_a57c83fc9996f248665485a9e3f46e4cd"><div class="ttname"><a href="kernel_8h.html#a57c83fc9996f248665485a9e3f46e4cd">ReferThreadStatus</a></div><div class="ttdeci">s32 ReferThreadStatus(s32 thread_id, ee_thread_status_t *info)</div></div>
<div class="ttc" id="akernel_8h_html_acabd2f4762dcc0b4acfd02043a411cf6"><div class="ttname"><a href="kernel_8h.html#acabd2f4762dcc0b4acfd02043a411cf6">iReferThreadStatus</a></div><div class="ttdeci">s32 iReferThreadStatus(s32 thread_id, ee_thread_status_t *info)</div></div>
<div class="ttc" id="astructee__thread__status__t_html"><div class="ttname"><a href="structee__thread__status__t.html">ee_thread_status_t</a></div><div class="ttdef"><b>Definition:</b> <a href="kernel_8h_source.html#l00252">kernel.h:253</a></div></div>
</div><!-- fragment --><p> Retrieve the status of a thread.</p>
<h1><a class="anchor" id="kernel_example"></a>
Example</h1>
<p>This example shows how to implement a preemptive schedule for a group of threads.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="tamtypes_8h.html">tamtypes.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="kernel_8h.html">kernel.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// I&#39;ve provided an alternative wakeup and sleep implementation using</span></div>
<div class="line"><span class="comment">// semaphores.</span></div>
<div class="line"><span class="comment">//#define USE_SEMA</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// The global offset pointer</span></div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">void</span> *<a class="code" href="kernel_8h.html#aa5b446173906c8e68694103114f775ed">_gp</a>;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define SECONDS_TO_RUN 10</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// A kilobyte of stack per thread</span></div>
<div class="line"><span class="preprocessor">#define THREAD_STACK_SIZE  1024</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">volatile</span> <span class="keywordtype">int</span> counter = 0;</div>
<div class="line"><span class="keyword">volatile</span> <span class="keywordtype">int</span> executing = 0;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Scheduler attributes</span></div>
<div class="line"><span class="preprocessor">#define SCHEDULER_PRIORITY 30</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Alarm intervals</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// NTSC Frames per second</span></div>
<div class="line"><span class="preprocessor">#define SCHEDULER_SECOND 30</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// HBlanks 1/29.96 second NTSC</span></div>
<div class="line"><span class="preprocessor">#define SCHEDULER_TIME 525</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// HBlanks 1/30 second NTSC</span></div>
<div class="line"><span class="comment">//#define SCHEDULER_TIME 524</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// HBlanks 1/25 second 576i</span></div>
<div class="line"><span class="comment">//#define SCHEDULER_TIME 625</span></div>
<div class="line"><span class="comment">//#define SCHEDULER_SECOND 25</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef USE_SEMA</span></div>
<div class="line"><span class="keyword">volatile</span> <span class="keywordtype">int</span>  scheduler_sema = 0;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> scheduler_stack[THREAD_STACK_SIZE] <a class="code" href="kernel_8h.html#a8e7a3bf6003d72a62606f343c2db6245">ALIGNED</a>(16);</div>
<div class="line"><span class="keywordtype">int</span>           scheduler_id;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Threads</span></div>
<div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>          thread_a_stack[THREAD_STACK_SIZE] <a class="code" href="kernel_8h.html#a8e7a3bf6003d72a62606f343c2db6245">ALIGNED</a>(16);</div>
<div class="line"><span class="keywordtype">int</span>                    thread_a_id;</div>
<div class="line"><span class="keyword">volatile</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  thread_a_cycles = 0;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>          thread_b_stack[THREAD_STACK_SIZE] <a class="code" href="kernel_8h.html#a8e7a3bf6003d72a62606f343c2db6245">ALIGNED</a>(16);</div>
<div class="line"><span class="keywordtype">int</span>                    thread_b_id;</div>
<div class="line"><span class="keyword">volatile</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  thread_b_cycles = 0;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> thread_a(<span class="keywordtype">void</span> *arg);</div>
<div class="line"><span class="keywordtype">void</span> thread_b(<span class="keywordtype">void</span> *arg);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// This scheduler thread could just be replaced with</span></div>
<div class="line"><span class="comment">// iRotateThreadReadyQueue() in the interrupt function.</span></div>
<div class="line"><span class="comment">// Using a thread allows for more flexibility and doesn&#39;t affect other threads</span></div>
<div class="line"><span class="comment">// since interrupts are enabled.</span></div>
<div class="line"><span class="keywordtype">void</span> scheduler(<span class="keywordtype">void</span>* a)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">while</span>(1)</div>
<div class="line">  {</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef USE_SEMA</span></div>
<div class="line">    <a class="code" href="kernel_8h.html#a9229c0a80194a094ab2c779ea00f7b5a">WaitSema</a>(scheduler_sema);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    <a class="code" href="kernel_8h.html#a9ace9207a2313dead9a46db9eff452f5">SleepThread</a>();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">    <a class="code" href="kernel_8h.html#ad300fac96b4ae0a7aa1df2e0c93ecd81">RotateThreadReadyQueue</a>(SCHEDULER_PRIORITY);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (counter &gt; SCHEDULER_SECOND * SECONDS_TO_RUN)</div>
<div class="line">      executing = 0;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef USE_SEMA</span></div>
<div class="line">    <a class="code" href="kernel_8h.html#a90b3032d244216ff9f19173d02c0de18">PollSema</a>(scheduler_sema);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> interrupt(<a class="code" href="tamtypes_8h.html#a0ce6887c26c1c49ad3be5710dd42bfd6">s32</a> <span class="keywordtype">id</span>, <a class="code" href="tamtypes_8h.html#a9e6c91d77e24643b888dbd1a1a590054">u16</a> <a class="code" href="libmouse_8c.html#ab842bdb7d02be824fb48613032b4ff36">time</a>, <span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line">  counter++;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef USE_SEMA</span></div>
<div class="line">  <a class="code" href="kernel_8h.html#a1fd7a2fbd593d43493e15e1b675009d5">iSignalSema</a>(scheduler_sema);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">  <a class="code" href="kernel_8h.html#a00fb0f646deb9cabd1770e10e51bd1d2">iWakeupThread</a>(scheduler_id);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">  <a class="code" href="kernel_8h.html#a809d31a90781764a1fbd2a060f19e115">iSetAlarm</a>(SCHEDULER_TIME, interrupt, <a class="code" href="tamtypes_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Calling this re-enables interrupts properly</span></div>
<div class="line">  <a class="code" href="kernel_8h.html#a1133e95851a77c473a573f32dab0f2c2">ExitHandler</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="callstacktest_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">volatile</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> main_cycles = 0;</div>
<div class="line">  <span class="keywordtype">int</span> interrupt_id = -1;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="structee__thread__t.html">ee_thread_t</a> thread;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef USE_SEMA</span></div>
<div class="line">  <a class="code" href="structee__sema__t.html">ee_sema_t</a>   sema;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Create a mutex for the scheduler and indicate that the resource</span></div>
<div class="line">  <span class="comment">// is already being used by setting init_count to 0.</span></div>
<div class="line">  sema.<a class="code" href="structee__sema__t.html#a7d273046bacce8339c6ec6f04151efe5">max_count</a> = 1;</div>
<div class="line">  sema.<a class="code" href="structee__sema__t.html#a00d15479d4b7a3b601ca45d9727d44e6">init_count</a> = 0;</div>
<div class="line">  sema.<a class="code" href="structee__sema__t.html#a7f56c55358951d2fccb5449201aadf76">option</a> = 0;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> ((scheduler_sema = <a class="code" href="kernel_8h.html#a003e696233a4735eb9994a2b491f62b1">CreateSema</a>(&amp;sema)) &lt; 0)</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Setup scheduler thread which will rotate the running threads</span></div>
<div class="line">  <span class="comment">// Give it a high priority</span></div>
<div class="line">  thread.<a class="code" href="structee__thread__t.html#aa86cdeac5c15b5b694f5d529e2ec2f44">func</a> = scheduler;</div>
<div class="line">  thread.<a class="code" href="structee__thread__t.html#ab5df3b18a1118223d7889d595cef0df9">stack</a> = scheduler_stack;</div>
<div class="line">  thread.<a class="code" href="structee__thread__t.html#a859ff290bbaccbf5c58e8c8a58d10287">stack_size</a> = THREAD_STACK_SIZE;</div>
<div class="line">  thread.<a class="code" href="structee__thread__t.html#a0032241c14e269cb1fb63ded9d6b5f14">gp_reg</a> = &amp;<a class="code" href="kernel_8h.html#aa5b446173906c8e68694103114f775ed">_gp</a>;</div>
<div class="line">  thread.<a class="code" href="structee__thread__t.html#afcdf4408f2bb28bb5c7a90dbee480983">initial_priority</a> = 1;</div>
<div class="line">  scheduler_id = <a class="code" href="kernel_8h.html#a59b879dd2406903437ca89da03fd3fbe">CreateThread</a>(&amp;thread);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (scheduler_id &lt; 0)</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Start the scheduler thread, it will go straight to wait status</span></div>
<div class="line">  <a class="code" href="kernel_8h.html#a953c03138db564d52015c4912f148226">StartThread</a>(scheduler_id, <a class="code" href="tamtypes_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Change the priority of the main thread so we know it&#39;s higher than</span></div>
<div class="line">  <span class="comment">// the threads we&#39;re about to start.</span></div>
<div class="line">  <a class="code" href="kernel_8h.html#af84ed779828ab1dd1e01aff9c82ea4e7">ChangeThreadPriority</a>(<a class="code" href="kernel_8h.html#affe1f95531f7255bd9bc1a6c6b60b37b">GetThreadId</a>(), SCHEDULER_PRIORITY-1);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Create 2 threads for the scheduler to rotate</span></div>
<div class="line">  thread.<a class="code" href="structee__thread__t.html#aa86cdeac5c15b5b694f5d529e2ec2f44">func</a> = thread_a;</div>
<div class="line">  thread.<a class="code" href="structee__thread__t.html#ab5df3b18a1118223d7889d595cef0df9">stack</a> = thread_a_stack;</div>
<div class="line">  thread.<a class="code" href="structee__thread__t.html#a859ff290bbaccbf5c58e8c8a58d10287">stack_size</a> = THREAD_STACK_SIZE;</div>
<div class="line">  thread.<a class="code" href="structee__thread__t.html#a0032241c14e269cb1fb63ded9d6b5f14">gp_reg</a> = &amp;<a class="code" href="kernel_8h.html#aa5b446173906c8e68694103114f775ed">_gp</a>;</div>
<div class="line">  thread.<a class="code" href="structee__thread__t.html#afcdf4408f2bb28bb5c7a90dbee480983">initial_priority</a> = SCHEDULER_PRIORITY;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> ((thread_a_id = <a class="code" href="kernel_8h.html#a59b879dd2406903437ca89da03fd3fbe">CreateThread</a>(&amp;thread)) &lt; 0)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="kernel_8h.html#ad691068f188bb2170bc9181010fe8dad">TerminateThread</a>(scheduler_id);</div>
<div class="line">    <a class="code" href="kernel_8h.html#ae853a3b5117773ac0e0cdc048b836a13">DeleteThread</a>(scheduler_id);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  thread.<a class="code" href="structee__thread__t.html#aa86cdeac5c15b5b694f5d529e2ec2f44">func</a> = thread_b;</div>
<div class="line">  thread.<a class="code" href="structee__thread__t.html#ab5df3b18a1118223d7889d595cef0df9">stack</a> = thread_b_stack;</div>
<div class="line">  thread.<a class="code" href="structee__thread__t.html#a859ff290bbaccbf5c58e8c8a58d10287">stack_size</a> = THREAD_STACK_SIZE;</div>
<div class="line">  thread.<a class="code" href="structee__thread__t.html#a0032241c14e269cb1fb63ded9d6b5f14">gp_reg</a> = &amp;<a class="code" href="kernel_8h.html#aa5b446173906c8e68694103114f775ed">_gp</a>;</div>
<div class="line">  thread.<a class="code" href="structee__thread__t.html#afcdf4408f2bb28bb5c7a90dbee480983">initial_priority</a> = SCHEDULER_PRIORITY;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> ((thread_b_id = <a class="code" href="kernel_8h.html#a59b879dd2406903437ca89da03fd3fbe">CreateThread</a>(&amp;thread)) &lt; 0)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="kernel_8h.html#ad691068f188bb2170bc9181010fe8dad">TerminateThread</a>(thread_a_id);</div>
<div class="line">    <a class="code" href="kernel_8h.html#ae853a3b5117773ac0e0cdc048b836a13">DeleteThread</a>(thread_a_id);</div>
<div class="line">    <a class="code" href="kernel_8h.html#ad691068f188bb2170bc9181010fe8dad">TerminateThread</a>(scheduler_id);</div>
<div class="line">    <a class="code" href="kernel_8h.html#ae853a3b5117773ac0e0cdc048b836a13">DeleteThread</a>(scheduler_id);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Use an interrupt to rotate a queue of threads to give each thread equal</span></div>
<div class="line">  <span class="comment">// slices of cpu time.</span></div>
<div class="line">  <span class="comment">// Use a hardware timer interrupt instead of an alarm for more finetuned</span></div>
<div class="line">  <span class="comment">// control and less overhead</span></div>
<div class="line">  interrupt_id = <a class="code" href="kernel_8h.html#aefa2ff547fe429f01cfcb801a19ee8a1">SetAlarm</a>(SCHEDULER_TIME, interrupt, <a class="code" href="tamtypes_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Indicate that we&#39;re about to execute parallel threads</span></div>
<div class="line">  executing = 1;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Start threads and change the main thread so it&#39;s on the same</span></div>
<div class="line">  <span class="comment">// schedule.</span></div>
<div class="line">  printf(<span class="stringliteral">&quot;Starting threads\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="kernel_8h.html#a953c03138db564d52015c4912f148226">StartThread</a>(thread_a_id, <a class="code" href="tamtypes_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line">  <a class="code" href="kernel_8h.html#a953c03138db564d52015c4912f148226">StartThread</a>(thread_b_id, <a class="code" href="tamtypes_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="kernel_8h.html#af84ed779828ab1dd1e01aff9c82ea4e7">ChangeThreadPriority</a>(<a class="code" href="kernel_8h.html#affe1f95531f7255bd9bc1a6c6b60b37b">GetThreadId</a>(),SCHEDULER_PRIORITY);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">while</span>(executing)</div>
<div class="line">  {</div>
<div class="line">    main_cycles++;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Threads are done so change the main thread back to a higher priority</span></div>
<div class="line">  <a class="code" href="kernel_8h.html#af84ed779828ab1dd1e01aff9c82ea4e7">ChangeThreadPriority</a>(<a class="code" href="kernel_8h.html#affe1f95531f7255bd9bc1a6c6b60b37b">GetThreadId</a>(),SCHEDULER_PRIORITY-1);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="kernel_8h.html#ad691068f188bb2170bc9181010fe8dad">TerminateThread</a>(thread_a_id);</div>
<div class="line">  <a class="code" href="kernel_8h.html#ad691068f188bb2170bc9181010fe8dad">TerminateThread</a>(thread_b_id);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="kernel_8h.html#ae853a3b5117773ac0e0cdc048b836a13">DeleteThread</a>(thread_a_id);</div>
<div class="line">  <a class="code" href="kernel_8h.html#ae853a3b5117773ac0e0cdc048b836a13">DeleteThread</a>(thread_b_id);</div>
<div class="line"> </div>
<div class="line">  printf(<span class="stringliteral">&quot;Threads done: Executed %d %d %d cycles in %d seconds\n&quot;</span>,</div>
<div class="line">          thread_a_cycles, thread_b_cycles, main_cycles,</div>
<div class="line">          counter/SCHEDULER_SECOND);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Releasing alarms does not work correctly on an unpatched kernel.</span></div>
<div class="line">  <a class="code" href="kernel_8h.html#afad1efd1fb9fc1c99d8587582cf9101f">ReleaseAlarm</a>(interrupt_id);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="kernel_8h.html#ad691068f188bb2170bc9181010fe8dad">TerminateThread</a>(scheduler_id);</div>
<div class="line">  <a class="code" href="kernel_8h.html#ae853a3b5117773ac0e0cdc048b836a13">DeleteThread</a>(scheduler_id);</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef USE_SEMA</span></div>
<div class="line">  <span class="comment">// Delete the semaphore after stopping the scheduler thread.</span></div>
<div class="line">  <a class="code" href="kernel_8h.html#a18758b3f3855b1d3f9362c10fb610c02">DeleteSema</a>(scheduler_sema);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Thread functions</span></div>
<div class="line"><span class="keywordtype">void</span> thread_a(<span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">while</span>(1)</div>
<div class="line">  {</div>
<div class="line">    thread_a_cycles++;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> thread_b(<span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">volatile</span> <span class="keywordtype">int</span> i;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">while</span>(1)</div>
<div class="line">  {</div>
<div class="line">    thread_b_cycles++;</div>
<div class="line">    <span class="comment">// Simulate a work load that gets heavier as time passes</span></div>
<div class="line">    <span class="comment">// Comment this out to see how thread_a isn&#39;t affected by</span></div>
<div class="line">    <span class="comment">// how long thread_b takes to run</span></div>
<div class="line"><span class="preprocessor">#if 1</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &gt; thread_b_cycles; i++)</div>
<div class="line">#endif</div>
<div class="line">    {</div>
<div class="line">      ;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="ttc" id="acallstacktest_8c_html_ae66f6b31b5ad750f1fe042a706a4e3d4"><div class="ttname"><a href="callstacktest_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a></div><div class="ttdeci">int main()</div><div class="ttdef"><b>Definition:</b> <a href="callstacktest_8c_source.html#l00045">callstacktest.c:45</a></div></div>
<div class="ttc" id="akernel_8h_html"><div class="ttname"><a href="kernel_8h.html">kernel.h</a></div></div>
<div class="ttc" id="akernel_8h_html_a1133e95851a77c473a573f32dab0f2c2"><div class="ttname"><a href="kernel_8h.html#a1133e95851a77c473a573f32dab0f2c2">ExitHandler</a></div><div class="ttdeci">#define ExitHandler()</div><div class="ttdef"><b>Definition:</b> <a href="kernel_8h_source.html#l00028">kernel.h:28</a></div></div>
<div class="ttc" id="akernel_8h_html_a809d31a90781764a1fbd2a060f19e115"><div class="ttname"><a href="kernel_8h.html#a809d31a90781764a1fbd2a060f19e115">iSetAlarm</a></div><div class="ttdeci">s32 iSetAlarm(u16 time, void(*callback)(s32 alarm_id, u16 time, void *common), void *common)</div></div>
<div class="ttc" id="akernel_8h_html_a8e7a3bf6003d72a62606f343c2db6245"><div class="ttname"><a href="kernel_8h.html#a8e7a3bf6003d72a62606f343c2db6245">ALIGNED</a></div><div class="ttdeci">#define ALIGNED(x)</div><div class="ttdef"><b>Definition:</b> <a href="kernel_8h_source.html#l00050">kernel.h:50</a></div></div>
<div class="ttc" id="akernel_8h_html_aa5b446173906c8e68694103114f775ed"><div class="ttname"><a href="kernel_8h.html#aa5b446173906c8e68694103114f775ed">_gp</a></div><div class="ttdeci">void * _gp</div></div>
<div class="ttc" id="akernel_8h_html_aefa2ff547fe429f01cfcb801a19ee8a1"><div class="ttname"><a href="kernel_8h.html#aefa2ff547fe429f01cfcb801a19ee8a1">SetAlarm</a></div><div class="ttdeci">s32 SetAlarm(u16 time, void(*callback)(s32 alarm_id, u16 time, void *common), void *common)</div></div>
<div class="ttc" id="akernel_8h_html_afad1efd1fb9fc1c99d8587582cf9101f"><div class="ttname"><a href="kernel_8h.html#afad1efd1fb9fc1c99d8587582cf9101f">ReleaseAlarm</a></div><div class="ttdeci">s32 ReleaseAlarm(s32 alarm_id)</div><div class="ttdef"><b>Definition:</b> <a href="srcfile_2src_2alarm_8c_source.html#l00110">alarm.c:110</a></div></div>
<div class="ttc" id="alibmouse_8c_html_ab842bdb7d02be824fb48613032b4ff36"><div class="ttname"><a href="libmouse_8c.html#ab842bdb7d02be824fb48613032b4ff36">time</a></div><div class="ttdeci">u32 time</div><div class="ttdef"><b>Definition:</b> <a href="libmouse_8c_source.html#l00037">libmouse.c:37</a></div></div>
<div class="ttc" id="astructee__sema__t_html_a00d15479d4b7a3b601ca45d9727d44e6"><div class="ttname"><a href="structee__sema__t.html#a00d15479d4b7a3b601ca45d9727d44e6">ee_sema_t::init_count</a></div><div class="ttdeci">int init_count</div><div class="ttdef"><b>Definition:</b> <a href="kernel_8h_source.html#l00218">kernel.h:218</a></div></div>
<div class="ttc" id="astructee__sema__t_html_a7d273046bacce8339c6ec6f04151efe5"><div class="ttname"><a href="structee__sema__t.html#a7d273046bacce8339c6ec6f04151efe5">ee_sema_t::max_count</a></div><div class="ttdeci">int max_count</div><div class="ttdef"><b>Definition:</b> <a href="kernel_8h_source.html#l00217">kernel.h:217</a></div></div>
<div class="ttc" id="astructee__sema__t_html_a7f56c55358951d2fccb5449201aadf76"><div class="ttname"><a href="structee__sema__t.html#a7f56c55358951d2fccb5449201aadf76">ee_sema_t::option</a></div><div class="ttdeci">u32 option</div><div class="ttdef"><b>Definition:</b> <a href="kernel_8h_source.html#l00221">kernel.h:221</a></div></div>
<div class="ttc" id="astructee__thread__t_html_a0032241c14e269cb1fb63ded9d6b5f14"><div class="ttname"><a href="structee__thread__t.html#a0032241c14e269cb1fb63ded9d6b5f14">ee_thread_t::gp_reg</a></div><div class="ttdeci">void * gp_reg</div><div class="ttdef"><b>Definition:</b> <a href="kernel_8h_source.html#l00230">kernel.h:230</a></div></div>
<div class="ttc" id="astructee__thread__t_html_a859ff290bbaccbf5c58e8c8a58d10287"><div class="ttname"><a href="structee__thread__t.html#a859ff290bbaccbf5c58e8c8a58d10287">ee_thread_t::stack_size</a></div><div class="ttdeci">int stack_size</div><div class="ttdef"><b>Definition:</b> <a href="kernel_8h_source.html#l00229">kernel.h:229</a></div></div>
<div class="ttc" id="astructee__thread__t_html_aa86cdeac5c15b5b694f5d529e2ec2f44"><div class="ttname"><a href="structee__thread__t.html#aa86cdeac5c15b5b694f5d529e2ec2f44">ee_thread_t::func</a></div><div class="ttdeci">void * func</div><div class="ttdef"><b>Definition:</b> <a href="kernel_8h_source.html#l00227">kernel.h:227</a></div></div>
<div class="ttc" id="astructee__thread__t_html_ab5df3b18a1118223d7889d595cef0df9"><div class="ttname"><a href="structee__thread__t.html#ab5df3b18a1118223d7889d595cef0df9">ee_thread_t::stack</a></div><div class="ttdeci">void * stack</div><div class="ttdef"><b>Definition:</b> <a href="kernel_8h_source.html#l00228">kernel.h:228</a></div></div>
<div class="ttc" id="astructee__thread__t_html_afcdf4408f2bb28bb5c7a90dbee480983"><div class="ttname"><a href="structee__thread__t.html#afcdf4408f2bb28bb5c7a90dbee480983">ee_thread_t::initial_priority</a></div><div class="ttdeci">int initial_priority</div><div class="ttdef"><b>Definition:</b> <a href="kernel_8h_source.html#l00231">kernel.h:231</a></div></div>
<div class="ttc" id="atamtypes_8h_html"><div class="ttname"><a href="tamtypes_8h.html">tamtypes.h</a></div></div>
<div class="ttc" id="atamtypes_8h_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="tamtypes_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="tamtypes_8h_source.html#l00091">tamtypes.h:91</a></div></div>
<div class="ttc" id="atamtypes_8h_html_a0ce6887c26c1c49ad3be5710dd42bfd6"><div class="ttname"><a href="tamtypes_8h.html#a0ce6887c26c1c49ad3be5710dd42bfd6">s32</a></div><div class="ttdeci">signed int s32</div><div class="ttdef"><b>Definition:</b> <a href="tamtypes_8h_source.html#l00058">tamtypes.h:58</a></div></div>
<div class="ttc" id="atamtypes_8h_html_a9e6c91d77e24643b888dbd1a1a590054"><div class="ttname"><a href="tamtypes_8h.html#a9e6c91d77e24643b888dbd1a1a590054">u16</a></div><div class="ttdeci">unsigned short u16</div><div class="ttdef"><b>Definition:</b> <a href="tamtypes_8h_source.html#l00024">tamtypes.h:24</a></div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Feb 11 2021 11:42:26 for ps2sdk by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
