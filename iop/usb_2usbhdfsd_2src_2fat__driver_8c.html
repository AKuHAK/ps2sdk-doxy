<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ps2sdk: iop/usb/usbhdfsd/src/fat_driver.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="code.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ps2sdk
   &#160;<span id="projectnumber">1.1</span>
   </div>
   <div id="projectbrief">A collection of Open Source libraries used for developing applications on Sony&#39;s PlayStation 2Â® (PS2).</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('usb_2usbhdfsd_2src_2fat__driver_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">fat_driver.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="stdio_8h_source.html">stdio.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="errno_8h_source.html">errno.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="limits_8h_source.html">limits.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="sysclib_8h_source.html">sysclib.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="thbase_8h_source.html">thbase.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="sysmem_8h_source.html">sysmem.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="usbhdfsd_8h_source.html">usbhdfsd.h</a>&gt;</code><br />
<code>#include &quot;usbhd_common.h&quot;</code><br />
<code>#include &quot;scache.h&quot;</code><br />
<code>#include &quot;fat_driver.h&quot;</code><br />
<code>#include &quot;fat.h&quot;</code><br />
<code>#include &quot;<a class="el" href="mass__stor_8h_source.html">mass_stor.h</a>&quot;</code><br />
<code>#include &quot;mass_debug.h&quot;</code><br />
</div><div class="textblock"><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Include dependency graph for fat_driver.c:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="usb_2usbhdfsd_2src_2fat__driver_8c__incl.svg" width="100%" height="563"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
</div>
<p><a href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ae328738f080a00611208ca42cb103e04"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ae328738f080a00611208ca42cb103e04">READ_SECTOR</a>(d,  a,  b)&#160;&#160;&#160;<a class="el" href="usb_2usbhdfsd_2src_2scache_8c.html#a310ca25517f35276bf091940890bdc1f">scache_readSector</a>((d)-&gt;cache, (a), (void **)&amp;b)</td></tr>
<tr class="separator:ae328738f080a00611208ca42cb103e04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a860a36d102edab0eef0d03304b981fdf"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a860a36d102edab0eef0d03304b981fdf">READ_SECTORS_RAW</a>(d,  a,  c,  b)&#160;&#160;&#160;<a class="el" href="usb__driver_8c.html#aad018ebccc3b00d1692c6d82f651a841">mass_stor_readSector</a>((d), a, b, c);</td></tr>
<tr class="separator:a860a36d102edab0eef0d03304b981fdf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad069d2c1ce77d9078affb2e5f23bcd0c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ad069d2c1ce77d9078affb2e5f23bcd0c">INVALIDATE_SECTORS</a>(d,  s,  c)&#160;&#160;&#160;<a class="el" href="usb_2usbhdfsd_2src_2scache_8c.html#a160e3237975e05d2e97fe288398cb816">scache_invalidate</a>((d)-&gt;cache, s, c)</td></tr>
<tr class="separator:ad069d2c1ce77d9078affb2e5f23bcd0c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2328493203f8da0a985673e0a369f196"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a2328493203f8da0a985673e0a369f196">NUM_DRIVES</a>&#160;&#160;&#160;10</td></tr>
<tr class="separator:a2328493203f8da0a985673e0a369f196"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a3a2036f7822d46473a88e7c707892b15"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a3a2036f7822d46473a88e7c707892b15">InitFAT</a> (void)</td></tr>
<tr class="separator:a3a2036f7822d46473a88e7c707892b15"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae21ac7e24598e16bdbd96bc2ab7114f0"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ae21ac7e24598e16bdbd96bc2ab7114f0">strEqual</a> (const char *<a class="el" href="as__reg__compat_8h.html#a09dff3d9a89874939fa7cc9d056b114c">s1</a>, const char *<a class="el" href="as__reg__compat_8h.html#a3ec77fc652b1787d9ace19f0f8fb6072">s2</a>)</td></tr>
<tr class="separator:ae21ac7e24598e16bdbd96bc2ab7114f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91611c48662c4306af936c2547e6d8a6"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a91611c48662c4306af936c2547e6d8a6">fat_getClusterRecord12</a> (unsigned char *buf, int type)</td></tr>
<tr class="separator:a91611c48662c4306af936c2547e6d8a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e4ff3437d1fa8ab754c7c5899382ac6"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a1e4ff3437d1fa8ab754c7c5899382ac6">fat_getClusterChain12</a> (<a class="el" href="structfat__driver.html">fat_driver</a> *fatd, unsigned int cluster, unsigned int *buf, unsigned int bufSize, int startFlag)</td></tr>
<tr class="separator:a1e4ff3437d1fa8ab754c7c5899382ac6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1adf8ed5f2eacce6c34bf17fece1c9d"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#af1adf8ed5f2eacce6c34bf17fece1c9d">fat_getClusterChain16</a> (<a class="el" href="structfat__driver.html">fat_driver</a> *fatd, unsigned int cluster, unsigned int *buf, unsigned int bufSize, int startFlag)</td></tr>
<tr class="separator:af1adf8ed5f2eacce6c34bf17fece1c9d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5d08af0585d47a3e2d508a5a9a98def2"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a5d08af0585d47a3e2d508a5a9a98def2">fat_getClusterChain32</a> (<a class="el" href="structfat__driver.html">fat_driver</a> *fatd, unsigned int cluster, unsigned int *buf, unsigned int bufSize, int startFlag)</td></tr>
<tr class="separator:a5d08af0585d47a3e2d508a5a9a98def2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a04f7d3056137a9a46fa5735e8a38f730"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a04f7d3056137a9a46fa5735e8a38f730">fat_getClusterChain</a> (<a class="el" href="structfat__driver.html">fat_driver</a> *fatd, unsigned int cluster, unsigned int *buf, unsigned int bufSize, int startFlag)</td></tr>
<tr class="separator:a04f7d3056137a9a46fa5735e8a38f730"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a15a7997a7342fca98bca9a4fcd7264a3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a15a7997a7342fca98bca9a4fcd7264a3">fat_invalidateLastChainResult</a> (<a class="el" href="structfat__driver.html">fat_driver</a> *fatd)</td></tr>
<tr class="separator:a15a7997a7342fca98bca9a4fcd7264a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa59206758be763177011abe1f87dc65"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#afa59206758be763177011abe1f87dc65">fat_determineFatType</a> (<a class="el" href="structfat__bpb.html">fat_bpb</a> *partBpb)</td></tr>
<tr class="separator:afa59206758be763177011abe1f87dc65"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a248495cc0e1147e1e467144b48f4d9b0"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a248495cc0e1147e1e467144b48f4d9b0">fat_getPartitionBootSector</a> (<a class="el" href="structmass__dev.html">mass_dev</a> *dev, unsigned int sector, <a class="el" href="structfat__bpb.html">fat_bpb</a> *partBpb)</td></tr>
<tr class="separator:a248495cc0e1147e1e467144b48f4d9b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7bb176f7870759d9c493606e0241f900"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a7bb176f7870759d9c493606e0241f900">fat_getDirentry</a> (unsigned char fatType, <a class="el" href="unionfat__direntry.html">fat_direntry</a> *dir_entry, <a class="el" href="structfat__direntry__summary.html">fat_direntry_summary</a> *dir)</td></tr>
<tr class="separator:a7bb176f7870759d9c493606e0241f900"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a0c248aa5373a0f923fdb9a87c43d1a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a5a0c248aa5373a0f923fdb9a87c43d1a">fat_setFatDirChain</a> (<a class="el" href="structfat__driver.html">fat_driver</a> *fatd, <a class="el" href="structfat__dir.html">fat_dir</a> *fatDir)</td></tr>
<tr class="separator:a5a0c248aa5373a0f923fdb9a87c43d1a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a201fa4870033ca4ecd729047edd05be4"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a201fa4870033ca4ecd729047edd05be4">fat_setFatDir</a> (<a class="el" href="structfat__driver.html">fat_driver</a> *fatd, <a class="el" href="structfat__dir.html">fat_dir</a> *fatDir, unsigned int parentDirCluster, <a class="el" href="structfat__direntry__sfn.html">fat_direntry_sfn</a> *dsfn, <a class="el" href="structfat__direntry__summary.html">fat_direntry_summary</a> *dir, int getClusterInfo)</td></tr>
<tr class="separator:a201fa4870033ca4ecd729047edd05be4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c34f9c163f391dacbc7153385f5e0e0"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a5c34f9c163f391dacbc7153385f5e0e0">fat_getDirentrySectorData</a> (<a class="el" href="structfat__driver.html">fat_driver</a> *fatd, unsigned int *startCluster, unsigned int *startSector, unsigned int *dirSector)</td></tr>
<tr class="separator:a5c34f9c163f391dacbc7153385f5e0e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5709f4818dc077b0d002f1a7f1854ca5"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a5709f4818dc077b0d002f1a7f1854ca5">fat_getDirentryStartCluster</a> (<a class="el" href="structfat__driver.html">fat_driver</a> *fatd, char *dirName, unsigned int *startCluster, <a class="el" href="structfat__dir.html">fat_dir</a> *fatDir)</td></tr>
<tr class="separator:a5709f4818dc077b0d002f1a7f1854ca5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44bbecfdac2bf504b9a992b24db27e5e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a44bbecfdac2bf504b9a992b24db27e5e">fat_getFileStartCluster</a> (<a class="el" href="structfat__driver.html">fat_driver</a> *fatd, const char *fname, unsigned int *startCluster, <a class="el" href="structfat__dir.html">fat_dir</a> *fatDir)</td></tr>
<tr class="separator:a44bbecfdac2bf504b9a992b24db27e5e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2132295b8b12475793629fcf9ae3f665"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a2132295b8b12475793629fcf9ae3f665">fat_getClusterAtFilePos</a> (<a class="el" href="structfat__driver.html">fat_driver</a> *fatd, <a class="el" href="structfat__dir.html">fat_dir</a> *fatDir, unsigned int filePos, unsigned int *cluster, unsigned int *clusterPos)</td></tr>
<tr class="separator:a2132295b8b12475793629fcf9ae3f665"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a309ac075dc146b705bad3872c73db72b"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a309ac075dc146b705bad3872c73db72b">fat_readSingleSector</a> (<a class="el" href="structmass__dev.html">mass_dev</a> *dev, unsigned int sector, void *<a class="el" href="ahx__irx_8c.html#a2e259c96eeae9c2c3832d3dd54fd26a3">buffer</a>, int size, int dataSkip)</td></tr>
<tr class="separator:a309ac075dc146b705bad3872c73db72b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe0ccd4a806f80183e8443df087b8f00"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#afe0ccd4a806f80183e8443df087b8f00">fat_readFile</a> (<a class="el" href="structfat__driver.html">fat_driver</a> *fatd, <a class="el" href="structfat__dir.html">fat_dir</a> *fatDir, unsigned int filePos, unsigned char *<a class="el" href="ahx__irx_8c.html#a2e259c96eeae9c2c3832d3dd54fd26a3">buffer</a>, unsigned int size)</td></tr>
<tr class="separator:afe0ccd4a806f80183e8443df087b8f00"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a153feaad587b7aea8176964d3ee5a1f2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a153feaad587b7aea8176964d3ee5a1f2">fat_getNextDirentry</a> (<a class="el" href="structfat__driver.html">fat_driver</a> *fatd, <a class="el" href="structfat__dir__list.html">fat_dir_list</a> *fatdlist, <a class="el" href="structfat__dir.html">fat_dir</a> *fatDir)</td></tr>
<tr class="separator:a153feaad587b7aea8176964d3ee5a1f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9fe6c9eb511c4a13a58cff64d7b7c317"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a9fe6c9eb511c4a13a58cff64d7b7c317">fat_getFirstDirentry</a> (<a class="el" href="structfat__driver.html">fat_driver</a> *fatd, const char *dirName, <a class="el" href="structfat__dir__list.html">fat_dir_list</a> *fatdlist, <a class="el" href="structfat__dir.html">fat_dir</a> *fatDir_host, <a class="el" href="structfat__dir.html">fat_dir</a> *fatDir)</td></tr>
<tr class="separator:a9fe6c9eb511c4a13a58cff64d7b7c317"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae1f0a2e4d5c649fe777ea081e780cc9"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#aae1f0a2e4d5c649fe777ea081e780cc9">fat_mount</a> (<a class="el" href="structmass__dev.html">mass_dev</a> *dev, unsigned int start, unsigned int count)</td></tr>
<tr class="separator:aae1f0a2e4d5c649fe777ea081e780cc9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a463085af8cb1ee46dde26a7bbdbe2d69"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a463085af8cb1ee46dde26a7bbdbe2d69">fat_forceUnmount</a> (<a class="el" href="structmass__dev.html">mass_dev</a> *dev)</td></tr>
<tr class="separator:a463085af8cb1ee46dde26a7bbdbe2d69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab641af05a1e1f21a1df4a3e3dd491c3b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structfat__driver.html">fat_driver</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ab641af05a1e1f21a1df4a3e3dd491c3b">fat_getData</a> (int device)</td></tr>
<tr class="separator:ab641af05a1e1f21a1df4a3e3dd491c3b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ad8fbcb13516683f060e6e83e33b046ee"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structfat__driver.html">fat_driver</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ad8fbcb13516683f060e6e83e33b046ee">g_fatd</a> [<a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a2328493203f8da0a985673e0a369f196">NUM_DRIVES</a>]</td></tr>
<tr class="separator:ad8fbcb13516683f060e6e83e33b046ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ad069d2c1ce77d9078affb2e5f23bcd0c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad069d2c1ce77d9078affb2e5f23bcd0c">&#9670;&nbsp;</a></span>INVALIDATE_SECTORS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define INVALIDATE_SECTORS</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">d, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">s, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">c&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;<a class="el" href="usb_2usbhdfsd_2src_2scache_8c.html#a160e3237975e05d2e97fe288398cb816">scache_invalidate</a>((d)-&gt;cache, s, c)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00033">33</a> of file <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html">fat_driver.c</a>.</p>

</div>
</div>
<a id="a2328493203f8da0a985673e0a369f196"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2328493203f8da0a985673e0a369f196">&#9670;&nbsp;</a></span>NUM_DRIVES</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NUM_DRIVES&#160;&#160;&#160;10</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00035">35</a> of file <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html">fat_driver.c</a>.</p>

</div>
</div>
<a id="ae328738f080a00611208ca42cb103e04"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae328738f080a00611208ca42cb103e04">&#9670;&nbsp;</a></span>READ_SECTOR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define READ_SECTOR</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">d, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">a, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">b&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;<a class="el" href="usb_2usbhdfsd_2src_2scache_8c.html#a310ca25517f35276bf091940890bdc1f">scache_readSector</a>((d)-&gt;cache, (a), (void **)&amp;b)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00031">31</a> of file <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html">fat_driver.c</a>.</p>

</div>
</div>
<a id="a860a36d102edab0eef0d03304b981fdf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a860a36d102edab0eef0d03304b981fdf">&#9670;&nbsp;</a></span>READ_SECTORS_RAW</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define READ_SECTORS_RAW</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">d, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">a, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">c, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">b&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;<a class="el" href="usb__driver_8c.html#aad018ebccc3b00d1692c6d82f651a841">mass_stor_readSector</a>((d), a, b, c);</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00032">32</a> of file <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html">fat_driver.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="afa59206758be763177011abe1f87dc65"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afa59206758be763177011abe1f87dc65">&#9670;&nbsp;</a></span>fat_determineFatType()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void fat_determineFatType </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfat__bpb.html">fat_bpb</a> *&#160;</td>
          <td class="paramname"><em>partBpb</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00254">254</a> of file <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html">fat_driver.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                                                   {</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sector, clusterCount;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160; </div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <span class="comment">//get sector of cluster 0</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        sector = <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat_8h.html#a7a0f69dcf37ca416800d90a7543e02ef">fat_cluster2sector</a>(partBpb, 0);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="comment">//remove partition start sector to get BR+FAT+ROOT_DIR sector count</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        sector -= partBpb-&gt;<a class="code" href="structfat__bpb.html#aec22fd0c89773a54180c3a5b3038e131">partStart</a>;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        sector = partBpb-&gt;<a class="code" href="structfat__bpb.html#a267bd7a9fd462c45f3c44e0bbb72fc55">sectorCount</a> - sector;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        clusterCount = sector / partBpb-&gt;<a class="code" href="structfat__bpb.html#a1cf892c4c80adcc3500ca90baab803b5">clusterSize</a>;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <span class="comment">//XPRINTF(&quot;USBHDFSD: Data cluster count = %u \n&quot;, clusterCount);</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160; </div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <span class="keywordflow">if</span> (clusterCount &lt; 4085) {</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                partBpb-&gt;<a class="code" href="structfat__bpb.html#ab661c72fc95b56a3ca635b817d3af54b">fatType</a> = <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat_8h.html#a9b302fb0c13ae8d5004cb7d1a6c4939a">FAT12</a>;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        } <span class="keywordflow">else</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        <span class="keywordflow">if</span> (clusterCount &lt; 65525) {</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                partBpb-&gt;<a class="code" href="structfat__bpb.html#ab661c72fc95b56a3ca635b817d3af54b">fatType</a> = <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat_8h.html#aa1a932d97a06f0de46f0d204c3c29d8f">FAT16</a>;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                partBpb-&gt;<a class="code" href="structfat__bpb.html#ab661c72fc95b56a3ca635b817d3af54b">fatType</a> = <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat_8h.html#a51cfb551f0270354f9115893b7f4339f">FAT32</a>;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        }</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;}</div>
<div class="ttc" id="afs_2bdmfs__vfat_2src_2include_2fat_8h_html_a51cfb551f0270354f9115893b7f4339f"><div class="ttname"><a href="fs_2bdmfs__vfat_2src_2include_2fat_8h.html#a51cfb551f0270354f9115893b7f4339f">FAT32</a></div><div class="ttdeci">#define FAT32</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00023">fat.h:23</a></div></div>
<div class="ttc" id="afs_2bdmfs__vfat_2src_2include_2fat_8h_html_a7a0f69dcf37ca416800d90a7543e02ef"><div class="ttname"><a href="fs_2bdmfs__vfat_2src_2include_2fat_8h.html#a7a0f69dcf37ca416800d90a7543e02ef">fat_cluster2sector</a></div><div class="ttdeci">static USBHD_INLINE unsigned int fat_cluster2sector(fat_bpb *partBpb, unsigned int cluster)</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00145">fat.h:145</a></div></div>
<div class="ttc" id="afs_2bdmfs__vfat_2src_2include_2fat_8h_html_a9b302fb0c13ae8d5004cb7d1a6c4939a"><div class="ttname"><a href="fs_2bdmfs__vfat_2src_2include_2fat_8h.html#a9b302fb0c13ae8d5004cb7d1a6c4939a">FAT12</a></div><div class="ttdeci">#define FAT12</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00021">fat.h:21</a></div></div>
<div class="ttc" id="afs_2bdmfs__vfat_2src_2include_2fat_8h_html_aa1a932d97a06f0de46f0d204c3c29d8f"><div class="ttname"><a href="fs_2bdmfs__vfat_2src_2include_2fat_8h.html#aa1a932d97a06f0de46f0d204c3c29d8f">FAT16</a></div><div class="ttdeci">#define FAT16</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00022">fat.h:22</a></div></div>
<div class="ttc" id="astructfat__bpb_html_a1cf892c4c80adcc3500ca90baab803b5"><div class="ttname"><a href="structfat__bpb.html#a1cf892c4c80adcc3500ca90baab803b5">fat_bpb::clusterSize</a></div><div class="ttdeci">unsigned char clusterSize</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00048">fat_driver.h:48</a></div></div>
<div class="ttc" id="astructfat__bpb_html_a267bd7a9fd462c45f3c44e0bbb72fc55"><div class="ttname"><a href="structfat__bpb.html#a267bd7a9fd462c45f3c44e0bbb72fc55">fat_bpb::sectorCount</a></div><div class="ttdeci">unsigned int sectorCount</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00055">fat_driver.h:55</a></div></div>
<div class="ttc" id="astructfat__bpb_html_ab661c72fc95b56a3ca635b817d3af54b"><div class="ttname"><a href="structfat__bpb.html#ab661c72fc95b56a3ca635b817d3af54b">fat_bpb::fatType</a></div><div class="ttdeci">unsigned char fatType</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00060">fat_driver.h:60</a></div></div>
<div class="ttc" id="astructfat__bpb_html_aec22fd0c89773a54180c3a5b3038e131"><div class="ttname"><a href="structfat__bpb.html#aec22fd0c89773a54180c3a5b3038e131">fat_bpb::partStart</a></div><div class="ttdeci">unsigned int partStart</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00056">fat_driver.h:56</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00048">fat_bpb::clusterSize</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00021">FAT12</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00022">FAT16</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00023">FAT32</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00145">fat_cluster2sector()</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00060">fat_bpb::fatType</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00056">fat_bpb::partStart</a>, and <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00055">fat_bpb::sectorCount</a>.</p>

<p class="reference">Referenced by <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00276">fat_getPartitionBootSector()</a>.</p>

</div>
</div>
<a id="a463085af8cb1ee46dde26a7bbdbe2d69"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a463085af8cb1ee46dde26a7bbdbe2d69">&#9670;&nbsp;</a></span>fat_forceUnmount()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fat_forceUnmount </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structmass__dev.html">mass_dev</a> *&#160;</td>
          <td class="paramname"><em>dev</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l01031">1031</a> of file <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html">fat_driver.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;{</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;        <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: usb fat: forceUnmount devId %i \n&quot;</span>, dev-&gt;<a class="code" href="structmass__dev.html#afe3c44bc7f3dace3dcb0c55df1ba5910">devId</a>);</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160; </div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;        <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a2328493203f8da0a985673e0a369f196">NUM_DRIVES</a>; ++i)</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;        {</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ad8fbcb13516683f060e6e83e33b046ee">g_fatd</a>[i] != <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ad8fbcb13516683f060e6e83e33b046ee">g_fatd</a>[i]-&gt;dev == dev)</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;                        <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ad8fbcb13516683f060e6e83e33b046ee">g_fatd</a>[i] = <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;        }</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;}</div>
<div class="ttc" id="adefs_8h_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="defs_8h_source.html#l00022">defs.h:22</a></div></div>
<div class="ttc" id="aiLink_2IEEE1394__disk_2src_2include_2mass__debug_8h_html_a730a51a001461c80e0268109f4bdf849"><div class="ttname"><a href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a></div><div class="ttdeci">#define XPRINTF(args...)</div><div class="ttdef"><b>Definition:</b> <a href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h_source.html#l00008">mass_debug.h:8</a></div></div>
<div class="ttc" id="astructmass__dev_html_afe3c44bc7f3dace3dcb0c55df1ba5910"><div class="ttname"><a href="structmass__dev.html#afe3c44bc7f3dace3dcb0c55df1ba5910">mass_dev::devId</a></div><div class="ttdeci">int devId</div><div class="ttdef"><b>Definition:</b> <a href="usb__mass_8c_source.html#l00043">usb_mass.c:43</a></div></div>
<div class="ttc" id="ausb_2usbhdfsd_2src_2fat__driver_8c_html_a2328493203f8da0a985673e0a369f196"><div class="ttname"><a href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a2328493203f8da0a985673e0a369f196">NUM_DRIVES</a></div><div class="ttdeci">#define NUM_DRIVES</div><div class="ttdef"><b>Definition:</b> <a href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00035">fat_driver.c:35</a></div></div>
<div class="ttc" id="ausb_2usbhdfsd_2src_2fat__driver_8c_html_ad8fbcb13516683f060e6e83e33b046ee"><div class="ttname"><a href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ad8fbcb13516683f060e6e83e33b046ee">g_fatd</a></div><div class="ttdeci">static fat_driver * g_fatd[NUM_DRIVES]</div><div class="ttdef"><b>Definition:</b> <a href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00036">fat_driver.c:36</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="usb__mass_8c_source.html#l00043">mass_dev::devId</a>, <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00036">g_fatd</a>, <a class="el" href="defs_8h_source.html#l00022">NULL</a>, <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00035">NUM_DRIVES</a>, and <a class="el" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h_source.html#l00008">XPRINTF</a>.</p>

</div>
</div>
<a id="a2132295b8b12475793629fcf9ae3f665"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2132295b8b12475793629fcf9ae3f665">&#9670;&nbsp;</a></span>fat_getClusterAtFilePos()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fat_getClusterAtFilePos </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfat__driver.html">fat_driver</a> *&#160;</td>
          <td class="paramname"><em>fatd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfat__dir.html">fat_dir</a> *&#160;</td>
          <td class="paramname"><em>fatDir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>filePos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&#160;</td>
          <td class="paramname"><em>cluster</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&#160;</td>
          <td class="paramname"><em>clusterPos</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00723">723</a> of file <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html">fat_driver.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                                                                                                                                       {</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, j, blockSize;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160; </div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        blockSize = fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#a1cf892c4c80adcc3500ca90baab803b5">clusterSize</a> * fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#aec6b3ab436f1855028e3564a5755dd69">sectorSize</a>;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160; </div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        <span class="keywordflow">for</span> (i = 0, j = (<a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a142dc81af7f167c205cf2328b1d4e5fa">DIR_CHAIN_SIZE</a>-1); i &lt; (<a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a142dc81af7f167c205cf2328b1d4e5fa">DIR_CHAIN_SIZE</a>-1); i++) {</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;                <span class="keywordflow">if</span> (fatDir-&gt;<a class="code" href="structfat__dir.html#aba046815960ef888c084fa51a24a5485">chain</a>[i].<a class="code" href="structfat__dir__chain__record.html#a0da35f7bf9611f26bc7300d74ca4270c">index</a>   * blockSize &lt;= filePos &amp;&amp;</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;                        fatDir-&gt;<a class="code" href="structfat__dir.html#aba046815960ef888c084fa51a24a5485">chain</a>[i+1].<a class="code" href="structfat__dir__chain__record.html#a0da35f7bf9611f26bc7300d74ca4270c">index</a> * blockSize &gt;  filePos) {</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;                                j = i;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                        }</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        }</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        *cluster    = fatDir-&gt;<a class="code" href="structfat__dir.html#aba046815960ef888c084fa51a24a5485">chain</a>[j].<a class="code" href="structfat__dir__chain__record.html#a7a11d0e531c6b1eb105301ba7e165a9c">cluster</a>;</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;        *clusterPos = (fatDir-&gt;<a class="code" href="structfat__dir.html#aba046815960ef888c084fa51a24a5485">chain</a>[j].<a class="code" href="structfat__dir__chain__record.html#a0da35f7bf9611f26bc7300d74ca4270c">index</a> * blockSize);</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;}</div>
<div class="ttc" id="afs_2bdmfs__vfat_2src_2include_2fat__driver_8h_html_a142dc81af7f167c205cf2328b1d4e5fa"><div class="ttname"><a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a142dc81af7f167c205cf2328b1d4e5fa">DIR_CHAIN_SIZE</a></div><div class="ttdeci">#define DIR_CHAIN_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00007">fat_driver.h:7</a></div></div>
<div class="ttc" id="astructfat__bpb_html_aec6b3ab436f1855028e3564a5755dd69"><div class="ttname"><a href="structfat__bpb.html#aec6b3ab436f1855028e3564a5755dd69">fat_bpb::sectorSize</a></div><div class="ttdeci">unsigned int sectorSize</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00047">fat_driver.h:47</a></div></div>
<div class="ttc" id="astructfat__dir__chain__record_html_a0da35f7bf9611f26bc7300d74ca4270c"><div class="ttname"><a href="structfat__dir__chain__record.html#a0da35f7bf9611f26bc7300d74ca4270c">fat_dir_chain_record::index</a></div><div class="ttdeci">unsigned int index</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00026">fat_driver.h:26</a></div></div>
<div class="ttc" id="astructfat__dir__chain__record_html_a7a11d0e531c6b1eb105301ba7e165a9c"><div class="ttname"><a href="structfat__dir__chain__record.html#a7a11d0e531c6b1eb105301ba7e165a9c">fat_dir_chain_record::cluster</a></div><div class="ttdeci">unsigned int cluster</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00025">fat_driver.h:25</a></div></div>
<div class="ttc" id="astructfat__dir_html_aba046815960ef888c084fa51a24a5485"><div class="ttname"><a href="structfat__dir.html#aba046815960ef888c084fa51a24a5485">fat_dir::chain</a></div><div class="ttdeci">fat_dir_chain_record chain[DIR_CHAIN_SIZE]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00043">fat_driver.h:43</a></div></div>
<div class="ttc" id="astructfat__driver_html_a11b132dd4e156c7a597339c0cef2cea6"><div class="ttname"><a href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">fat_driver::partBpb</a></div><div class="ttdeci">fat_bpb partBpb</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00068">fat_driver.h:68</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00043">fat_dir::chain</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00025">fat_dir_chain_record::cluster</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00048">fat_bpb::clusterSize</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00007">DIR_CHAIN_SIZE</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00026">fat_dir_chain_record::index</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00068">fat_driver::partBpb</a>, and <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00047">fat_bpb::sectorSize</a>.</p>

</div>
</div>
<a id="a04f7d3056137a9a46fa5735e8a38f730"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a04f7d3056137a9a46fa5735e8a38f730">&#9670;&nbsp;</a></span>fat_getClusterChain()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fat_getClusterChain </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfat__driver.html">fat_driver</a> *&#160;</td>
          <td class="paramname"><em>fatd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>cluster</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>bufSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>startFlag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00232">232</a> of file <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html">fat_driver.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                                                                                                                        {</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; </div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <span class="keywordflow">if</span> (cluster == fatd-&gt;<a class="code" href="structfat__driver.html#a438f62db8e07453da4c89443cd369e97">lastChainCluster</a>) {</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                <span class="keywordflow">return</span> fatd-&gt;<a class="code" href="structfat__driver.html#a56c4ca15f432dd40bb0deb924b342a9a">lastChainResult</a>;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        }</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160; </div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <span class="keywordflow">switch</span> (fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#ab661c72fc95b56a3ca635b817d3af54b">fatType</a>) {</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat_8h.html#a9b302fb0c13ae8d5004cb7d1a6c4939a">FAT12</a>: fatd-&gt;<a class="code" href="structfat__driver.html#a56c4ca15f432dd40bb0deb924b342a9a">lastChainResult</a> = <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a1e4ff3437d1fa8ab754c7c5899382ac6">fat_getClusterChain12</a>(fatd, cluster, buf, bufSize, startFlag); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat_8h.html#aa1a932d97a06f0de46f0d204c3c29d8f">FAT16</a>: fatd-&gt;<a class="code" href="structfat__driver.html#a56c4ca15f432dd40bb0deb924b342a9a">lastChainResult</a> = <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#af1adf8ed5f2eacce6c34bf17fece1c9d">fat_getClusterChain16</a>(fatd, cluster, buf, bufSize, startFlag); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat_8h.html#a51cfb551f0270354f9115893b7f4339f">FAT32</a>: fatd-&gt;<a class="code" href="structfat__driver.html#a56c4ca15f432dd40bb0deb924b342a9a">lastChainResult</a> = <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a5d08af0585d47a3e2d508a5a9a98def2">fat_getClusterChain32</a>(fatd, cluster, buf, bufSize, startFlag); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        }</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        fatd-&gt;<a class="code" href="structfat__driver.html#a438f62db8e07453da4c89443cd369e97">lastChainCluster</a> = cluster;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        <span class="keywordflow">return</span> fatd-&gt;<a class="code" href="structfat__driver.html#a56c4ca15f432dd40bb0deb924b342a9a">lastChainResult</a>;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;}</div>
<div class="ttc" id="astructfat__driver_html_a438f62db8e07453da4c89443cd369e97"><div class="ttname"><a href="structfat__driver.html#a438f62db8e07453da4c89443cd369e97">fat_driver::lastChainCluster</a></div><div class="ttdeci">unsigned int lastChainCluster</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00074">fat_driver.h:74</a></div></div>
<div class="ttc" id="astructfat__driver_html_a56c4ca15f432dd40bb0deb924b342a9a"><div class="ttname"><a href="structfat__driver.html#a56c4ca15f432dd40bb0deb924b342a9a">fat_driver::lastChainResult</a></div><div class="ttdeci">int lastChainResult</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00075">fat_driver.h:75</a></div></div>
<div class="ttc" id="ausb_2usbhdfsd_2src_2fat__driver_8c_html_a1e4ff3437d1fa8ab754c7c5899382ac6"><div class="ttname"><a href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a1e4ff3437d1fa8ab754c7c5899382ac6">fat_getClusterChain12</a></div><div class="ttdeci">static int fat_getClusterChain12(fat_driver *fatd, unsigned int cluster, unsigned int *buf, unsigned int bufSize, int startFlag)</div><div class="ttdef"><b>Definition:</b> <a href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00098">fat_driver.c:98</a></div></div>
<div class="ttc" id="ausb_2usbhdfsd_2src_2fat__driver_8c_html_a5d08af0585d47a3e2d508a5a9a98def2"><div class="ttname"><a href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a5d08af0585d47a3e2d508a5a9a98def2">fat_getClusterChain32</a></div><div class="ttdeci">static int fat_getClusterChain32(fat_driver *fatd, unsigned int cluster, unsigned int *buf, unsigned int bufSize, int startFlag)</div><div class="ttdef"><b>Definition:</b> <a href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00195">fat_driver.c:195</a></div></div>
<div class="ttc" id="ausb_2usbhdfsd_2src_2fat__driver_8c_html_af1adf8ed5f2eacce6c34bf17fece1c9d"><div class="ttname"><a href="usb_2usbhdfsd_2src_2fat__driver_8c.html#af1adf8ed5f2eacce6c34bf17fece1c9d">fat_getClusterChain16</a></div><div class="ttdeci">static int fat_getClusterChain16(fat_driver *fatd, unsigned int cluster, unsigned int *buf, unsigned int bufSize, int startFlag)</div><div class="ttdef"><b>Definition:</b> <a href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00157">fat_driver.c:157</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00021">FAT12</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00022">FAT16</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00023">FAT32</a>, <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00098">fat_getClusterChain12()</a>, <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00157">fat_getClusterChain16()</a>, <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00195">fat_getClusterChain32()</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00060">fat_bpb::fatType</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00074">fat_driver::lastChainCluster</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00075">fat_driver::lastChainResult</a>, and <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00068">fat_driver::partBpb</a>.</p>

</div>
</div>
<a id="a1e4ff3437d1fa8ab754c7c5899382ac6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1e4ff3437d1fa8ab754c7c5899382ac6">&#9670;&nbsp;</a></span>fat_getClusterChain12()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int fat_getClusterChain12 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfat__driver.html">fat_driver</a> *&#160;</td>
          <td class="paramname"><em>fatd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>cluster</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>bufSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>startFlag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00098">98</a> of file <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html">fat_driver.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                                                                                                                                 {</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        <span class="keywordtype">int</span> ret;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, recordOffset, fatSector, lastFatSector;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> xbuf[4], sectorSpan, cont;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* <a class="code" href="fs_2bdm_2src_2part__driver_8c.html#a6d4ae1f692b64a14d19895e323c7b853">sbuf</a> = <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; <span class="comment">//sector buffer</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160; </div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        cont = 1;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        lastFatSector = -1;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        i = 0;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        <span class="keywordflow">if</span> (startFlag) {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                buf[i] = cluster; <span class="comment">//store first cluster</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                i++;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        }</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <span class="keywordflow">while</span>(i &lt; bufSize &amp;&amp; cont) {</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                recordOffset = (cluster * 3) / 2; <span class="comment">//offset of the cluster record (in bytes) from the FAT start</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                fatSector = recordOffset / fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#aec6b3ab436f1855028e3564a5755dd69">sectorSize</a>;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                sectorSpan = 0;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                <span class="keywordflow">if</span> ((recordOffset % fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#aec6b3ab436f1855028e3564a5755dd69">sectorSize</a>) == (fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#aec6b3ab436f1855028e3564a5755dd69">sectorSize</a> - 1)) {</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                        sectorSpan = 1;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                }</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                <span class="keywordflow">if</span> (lastFatSector !=  fatSector || sectorSpan) {</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                        ret = <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ae328738f080a00611208ca42cb103e04">READ_SECTOR</a>(fatd-&gt;<a class="code" href="structfat__driver.html#aef714ddc28773eb0da5b91b99129834d">dev</a>, fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#aec22fd0c89773a54180c3a5b3038e131">partStart</a> + fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#acee894d1cf546aabbd22b3a22f5cb7ca">resSectors</a> + fatSector, <a class="code" href="fs_2bdm_2src_2part__driver_8c.html#a6d4ae1f692b64a14d19895e323c7b853">sbuf</a>);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                        <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                                <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: Read fat12 sector failed! sector=%u! \n&quot;</span>, fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#aec22fd0c89773a54180c3a5b3038e131">partStart</a> + fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#acee894d1cf546aabbd22b3a22f5cb7ca">resSectors</a> + fatSector );</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                                <span class="keywordflow">return</span> -<a class="code" href="errno_8h.html#a70979f50f9c83e5aebab3d6a1bd4cf35">EIO</a>;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                        }</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                        lastFatSector = fatSector;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160; </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                        <span class="keywordflow">if</span> (sectorSpan) {</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                                xbuf[0] = <a class="code" href="fs_2bdm_2src_2part__driver_8c.html#a6d4ae1f692b64a14d19895e323c7b853">sbuf</a>[fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#aec6b3ab436f1855028e3564a5755dd69">sectorSize</a> - 2];</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                                xbuf[1] = <a class="code" href="fs_2bdm_2src_2part__driver_8c.html#a6d4ae1f692b64a14d19895e323c7b853">sbuf</a>[fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#aec6b3ab436f1855028e3564a5755dd69">sectorSize</a> - 1];</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                                ret = <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ae328738f080a00611208ca42cb103e04">READ_SECTOR</a>(fatd-&gt;<a class="code" href="structfat__driver.html#aef714ddc28773eb0da5b91b99129834d">dev</a>, fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#aec22fd0c89773a54180c3a5b3038e131">partStart</a> + fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#acee894d1cf546aabbd22b3a22f5cb7ca">resSectors</a> + fatSector + 1, <a class="code" href="fs_2bdm_2src_2part__driver_8c.html#a6d4ae1f692b64a14d19895e323c7b853">sbuf</a>);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                                <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                                        <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: Read fat12 sector failed sector=%u! \n&quot;</span>, fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#aec22fd0c89773a54180c3a5b3038e131">partStart</a> + fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#acee894d1cf546aabbd22b3a22f5cb7ca">resSectors</a> + fatSector + 1);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                                        <span class="keywordflow">return</span> -<a class="code" href="errno_8h.html#a70979f50f9c83e5aebab3d6a1bd4cf35">EIO</a>;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                                }</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                                xbuf[2] = <a class="code" href="fs_2bdm_2src_2part__driver_8c.html#a6d4ae1f692b64a14d19895e323c7b853">sbuf</a>[0];</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                                xbuf[3] = <a class="code" href="fs_2bdm_2src_2part__driver_8c.html#a6d4ae1f692b64a14d19895e323c7b853">sbuf</a>[1];</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                        }</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                }</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                <span class="keywordflow">if</span> (sectorSpan) { <span class="comment">// use xbuf as source buffer</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                        cluster = <a class="code" href="fs_2bdmfs__vfat_2src_2fat__driver_8c.html#a91611c48662c4306af936c2547e6d8a6">fat_getClusterRecord12</a>(xbuf + (recordOffset % fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#aec6b3ab436f1855028e3564a5755dd69">sectorSize</a>) - (fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#aec6b3ab436f1855028e3564a5755dd69">sectorSize</a>-2), cluster % 2);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                } <span class="keywordflow">else</span> { <span class="comment">// use sector buffer as source buffer</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                        cluster = <a class="code" href="fs_2bdmfs__vfat_2src_2fat__driver_8c.html#a91611c48662c4306af936c2547e6d8a6">fat_getClusterRecord12</a>(<a class="code" href="fs_2bdm_2src_2part__driver_8c.html#a6d4ae1f692b64a14d19895e323c7b853">sbuf</a> + (recordOffset % fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#aec6b3ab436f1855028e3564a5755dd69">sectorSize</a>), cluster % 2);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                }</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160; </div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                <span class="keywordflow">if</span> ((cluster &amp; 0xFFF) &gt;= 0xFF8) {</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                        cont = 0; <span class="comment">//continue = false</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                        buf[i] = cluster &amp; 0xFFF;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                        i++;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                }</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        }</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="keywordflow">return</span> i;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;}</div>
<div class="ttc" id="aerrno_8h_html_a70979f50f9c83e5aebab3d6a1bd4cf35"><div class="ttname"><a href="errno_8h.html#a70979f50f9c83e5aebab3d6a1bd4cf35">EIO</a></div><div class="ttdeci">#define EIO</div><div class="ttdef"><b>Definition:</b> <a href="errno_8h_source.html#l00028">errno.h:28</a></div></div>
<div class="ttc" id="afs_2bdm_2src_2part__driver_8c_html_a6d4ae1f692b64a14d19895e323c7b853"><div class="ttname"><a href="fs_2bdm_2src_2part__driver_8c.html#a6d4ae1f692b64a14d19895e323c7b853">sbuf</a></div><div class="ttdeci">static unsigned char sbuf[512]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdm_2src_2part__driver_8c_source.html#l00064">part_driver.c:64</a></div></div>
<div class="ttc" id="afs_2bdmfs__vfat_2src_2fat__driver_8c_html_a91611c48662c4306af936c2547e6d8a6"><div class="ttname"><a href="fs_2bdmfs__vfat_2src_2fat__driver_8c.html#a91611c48662c4306af936c2547e6d8a6">fat_getClusterRecord12</a></div><div class="ttdeci">unsigned int fat_getClusterRecord12(unsigned char *buf, int type)</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2fat__driver_8c_source.html#l00071">fat_driver.c:71</a></div></div>
<div class="ttc" id="astructfat__bpb_html_acee894d1cf546aabbd22b3a22f5cb7ca"><div class="ttname"><a href="structfat__bpb.html#acee894d1cf546aabbd22b3a22f5cb7ca">fat_bpb::resSectors</a></div><div class="ttdeci">unsigned int resSectors</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00049">fat_driver.h:49</a></div></div>
<div class="ttc" id="astructfat__driver_html_aef714ddc28773eb0da5b91b99129834d"><div class="ttname"><a href="structfat__driver.html#aef714ddc28773eb0da5b91b99129834d">fat_driver::dev</a></div><div class="ttdeci">struct SBP2Device * dev</div><div class="ttdef"><b>Definition:</b> <a href="iLink_2IEEE1394__disk_2src_2include_2fat__driver_8h_source.html#l00036">fat_driver.h:36</a></div></div>
<div class="ttc" id="ausb_2usbhdfsd_2src_2fat__driver_8c_html_ae328738f080a00611208ca42cb103e04"><div class="ttname"><a href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ae328738f080a00611208ca42cb103e04">READ_SECTOR</a></div><div class="ttdeci">#define READ_SECTOR(d, a, b)</div><div class="ttdef"><b>Definition:</b> <a href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00031">fat_driver.c:31</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="iLink_2IEEE1394__disk_2src_2include_2fat__driver_8h_source.html#l00036">fat_driver::dev</a>, <a class="el" href="errno_8h_source.html#l00028">EIO</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2fat__driver_8c_source.html#l00071">fat_getClusterRecord12()</a>, <a class="el" href="defs_8h_source.html#l00022">NULL</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00068">fat_driver::partBpb</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00056">fat_bpb::partStart</a>, <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00031">READ_SECTOR</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00049">fat_bpb::resSectors</a>, <a class="el" href="fs_2bdm_2src_2part__driver_8c_source.html#l00064">sbuf</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00047">fat_bpb::sectorSize</a>, and <a class="el" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h_source.html#l00008">XPRINTF</a>.</p>

<p class="reference">Referenced by <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00232">fat_getClusterChain()</a>.</p>

</div>
</div>
<a id="af1adf8ed5f2eacce6c34bf17fece1c9d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af1adf8ed5f2eacce6c34bf17fece1c9d">&#9670;&nbsp;</a></span>fat_getClusterChain16()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int fat_getClusterChain16 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfat__driver.html">fat_driver</a> *&#160;</td>
          <td class="paramname"><em>fatd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>cluster</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>bufSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>startFlag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00157">157</a> of file <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html">fat_driver.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                                                                                                                                 {</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <span class="keywordtype">int</span> ret;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, indexCount, fatSector, lastFatSector;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> cont;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* <a class="code" href="fs_2bdm_2src_2part__driver_8c.html#a6d4ae1f692b64a14d19895e323c7b853">sbuf</a> = <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; <span class="comment">//sector buffer</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160; </div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        cont = 1;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        indexCount = fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#aec6b3ab436f1855028e3564a5755dd69">sectorSize</a> / 2; <span class="comment">//FAT16-&gt;2, FAT32-&gt;4</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        lastFatSector = -1;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        i = 0;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <span class="keywordflow">if</span> (startFlag) {</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                buf[i] = cluster; <span class="comment">//store first cluster</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                i++;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        }</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <span class="keywordflow">while</span>(i &lt; bufSize &amp;&amp; cont) {</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                fatSector = cluster / indexCount;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                <span class="keywordflow">if</span> (lastFatSector !=  fatSector) {</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                        ret = <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ae328738f080a00611208ca42cb103e04">READ_SECTOR</a>(fatd-&gt;<a class="code" href="structfat__driver.html#aef714ddc28773eb0da5b91b99129834d">dev</a>, fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#aec22fd0c89773a54180c3a5b3038e131">partStart</a> + fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#acee894d1cf546aabbd22b3a22f5cb7ca">resSectors</a> + fatSector,  <a class="code" href="fs_2bdm_2src_2part__driver_8c.html#a6d4ae1f692b64a14d19895e323c7b853">sbuf</a>);</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                        <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                                <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: Read fat16 sector failed! sector=%u! \n&quot;</span>, fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#aec22fd0c89773a54180c3a5b3038e131">partStart</a> + fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#acee894d1cf546aabbd22b3a22f5cb7ca">resSectors</a> + fatSector );</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                                <span class="keywordflow">return</span> -<a class="code" href="errno_8h.html#a70979f50f9c83e5aebab3d6a1bd4cf35">EIO</a>;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                        }</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160; </div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                        lastFatSector = fatSector;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                }</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                cluster = <a class="code" href="fs_2bdmfs__vfat_2src_2include_2common_8h.html#a98122f7798bea6dd7cb0862431e0408e">getI16</a>(<a class="code" href="fs_2bdm_2src_2part__driver_8c.html#a6d4ae1f692b64a14d19895e323c7b853">sbuf</a> + ((cluster % indexCount) * 2));</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                <span class="keywordflow">if</span> ((cluster &amp; 0xFFFF) &gt;= 0xFFF8) {</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                        cont = 0; <span class="comment">//continue = false</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                        buf[i] = cluster &amp; 0xFFFF;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                        i++;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                }</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        }</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="keywordflow">return</span> i;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;}</div>
<div class="ttc" id="afs_2bdmfs__vfat_2src_2include_2common_8h_html_a98122f7798bea6dd7cb0862431e0408e"><div class="ttname"><a href="fs_2bdmfs__vfat_2src_2include_2common_8h.html#a98122f7798bea6dd7cb0862431e0408e">getI16</a></div><div class="ttdeci">#define getI16(buf)</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2common_8h_source.html#l00016">common.h:16</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="iLink_2IEEE1394__disk_2src_2include_2fat__driver_8h_source.html#l00036">fat_driver::dev</a>, <a class="el" href="errno_8h_source.html#l00028">EIO</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2common_8h_source.html#l00016">getI16</a>, <a class="el" href="defs_8h_source.html#l00022">NULL</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00068">fat_driver::partBpb</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00056">fat_bpb::partStart</a>, <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00031">READ_SECTOR</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00049">fat_bpb::resSectors</a>, <a class="el" href="fs_2bdm_2src_2part__driver_8c_source.html#l00064">sbuf</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00047">fat_bpb::sectorSize</a>, and <a class="el" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h_source.html#l00008">XPRINTF</a>.</p>

<p class="reference">Referenced by <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00232">fat_getClusterChain()</a>.</p>

</div>
</div>
<a id="a5d08af0585d47a3e2d508a5a9a98def2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5d08af0585d47a3e2d508a5a9a98def2">&#9670;&nbsp;</a></span>fat_getClusterChain32()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int fat_getClusterChain32 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfat__driver.html">fat_driver</a> *&#160;</td>
          <td class="paramname"><em>fatd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>cluster</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>bufSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>startFlag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00195">195</a> of file <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html">fat_driver.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                                                                                                                                 {</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <span class="keywordtype">int</span> ret;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, indexCount, fatSector, lastFatSector;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> cont;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* <a class="code" href="fs_2bdm_2src_2part__driver_8c.html#a6d4ae1f692b64a14d19895e323c7b853">sbuf</a> = <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; <span class="comment">//sector buffer</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160; </div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        cont = 1;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        indexCount = fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#aec6b3ab436f1855028e3564a5755dd69">sectorSize</a> / 4; <span class="comment">//FAT16-&gt;2, FAT32-&gt;4</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        lastFatSector = -1;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        i = 0;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <span class="keywordflow">if</span> (startFlag) {</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                buf[i] = cluster; <span class="comment">//store first cluster</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                i++;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        }</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <span class="keywordflow">while</span>(i &lt; bufSize &amp;&amp; cont) {</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                fatSector = cluster / indexCount;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                <span class="keywordflow">if</span> (lastFatSector !=  fatSector) {</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                        ret = <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ae328738f080a00611208ca42cb103e04">READ_SECTOR</a>(fatd-&gt;<a class="code" href="structfat__driver.html#aef714ddc28773eb0da5b91b99129834d">dev</a>, fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#aec22fd0c89773a54180c3a5b3038e131">partStart</a> + fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#acee894d1cf546aabbd22b3a22f5cb7ca">resSectors</a> + fatSector,  <a class="code" href="fs_2bdm_2src_2part__driver_8c.html#a6d4ae1f692b64a14d19895e323c7b853">sbuf</a>);</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                        <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                                <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: Read fat32 sector failed sector=%u! \n&quot;</span>, fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#aec22fd0c89773a54180c3a5b3038e131">partStart</a> + fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#acee894d1cf546aabbd22b3a22f5cb7ca">resSectors</a> + fatSector );</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                                <span class="keywordflow">return</span> -<a class="code" href="errno_8h.html#a70979f50f9c83e5aebab3d6a1bd4cf35">EIO</a>;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                        }</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160; </div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                        lastFatSector = fatSector;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                }</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                cluster = <a class="code" href="fs_2bdm_2src_2part__driver_8c.html#acdf30bdc458302252ad1c28906727cbd">getI32</a>(<a class="code" href="fs_2bdm_2src_2part__driver_8c.html#a6d4ae1f692b64a14d19895e323c7b853">sbuf</a> + ((cluster % indexCount) * 4));</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                <span class="keywordflow">if</span> ((cluster &amp; 0xFFFFFFF) &gt;= 0xFFFFFF8) {</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                        cont = 0; <span class="comment">//continue = false</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                        buf[i] = cluster &amp; 0xFFFFFFF;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                        i++;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                }</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        }</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <span class="keywordflow">return</span> i;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;}</div>
<div class="ttc" id="afs_2bdm_2src_2part__driver_8c_html_acdf30bdc458302252ad1c28906727cbd"><div class="ttname"><a href="fs_2bdm_2src_2part__driver_8c.html#acdf30bdc458302252ad1c28906727cbd">getI32</a></div><div class="ttdeci">#define getI32(buf)</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdm_2src_2part__driver_8c_source.html#l00009">part_driver.c:9</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="iLink_2IEEE1394__disk_2src_2include_2fat__driver_8h_source.html#l00036">fat_driver::dev</a>, <a class="el" href="errno_8h_source.html#l00028">EIO</a>, <a class="el" href="fs_2bdm_2src_2part__driver_8c_source.html#l00009">getI32</a>, <a class="el" href="defs_8h_source.html#l00022">NULL</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00068">fat_driver::partBpb</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00056">fat_bpb::partStart</a>, <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00031">READ_SECTOR</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00049">fat_bpb::resSectors</a>, <a class="el" href="fs_2bdm_2src_2part__driver_8c_source.html#l00064">sbuf</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00047">fat_bpb::sectorSize</a>, and <a class="el" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h_source.html#l00008">XPRINTF</a>.</p>

<p class="reference">Referenced by <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00232">fat_getClusterChain()</a>.</p>

</div>
</div>
<a id="a91611c48662c4306af936c2547e6d8a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a91611c48662c4306af936c2547e6d8a6">&#9670;&nbsp;</a></span>fat_getClusterRecord12()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int fat_getClusterRecord12 </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00079">79</a> of file <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html">fat_driver.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                                                                  {</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <span class="keywordflow">if</span> (type) { <span class="comment">//1</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                <span class="keywordflow">return</span> ((buf[1]&lt;&lt; 4) + (buf[0] &gt;&gt;4));</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        } <span class="keywordflow">else</span> { <span class="comment">// 0</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                <span class="keywordflow">return</span> (((buf[1] &amp; 0x0F) &lt;&lt; 8) + buf[0]);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        }</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ab641af05a1e1f21a1df4a3e3dd491c3b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab641af05a1e1f21a1df4a3e3dd491c3b">&#9670;&nbsp;</a></span>fat_getData()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structfat__driver.html">fat_driver</a>* fat_getData </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>device</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l01044">1044</a> of file <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html">fat_driver.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;{</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;        <span class="keywordflow">if</span> (device &gt;= <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a2328493203f8da0a985673e0a369f196">NUM_DRIVES</a>)</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160; </div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;        <span class="keywordflow">while</span> (<a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ad8fbcb13516683f060e6e83e33b046ee">g_fatd</a>[device] == <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ad8fbcb13516683f060e6e83e33b046ee">g_fatd</a>[device]-&gt;dev == <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;        {</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="mass__stor_8h.html#ad87a0650abc4dc2c1104e1a57e141c52">mass_stor_configureNextDevice</a>() &lt;= 0)</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;                <span class="comment">//Do not block USBD by busy-looping here, if the device is not ready. This function call will carry the priority of the calling thread.</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;                <a class="code" href="thbase_8h.html#a9e662b5867cf57e38015ced97ae413b6">DelayThread</a>(5000);</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;        }</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160; </div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ad8fbcb13516683f060e6e83e33b046ee">g_fatd</a>[device] == <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ad8fbcb13516683f060e6e83e33b046ee">g_fatd</a>[device]-&gt;dev == <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ad8fbcb13516683f060e6e83e33b046ee">g_fatd</a>[device];</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;}</div>
<div class="ttc" id="amass__stor_8h_html_ad87a0650abc4dc2c1104e1a57e141c52"><div class="ttname"><a href="mass__stor_8h.html#ad87a0650abc4dc2c1104e1a57e141c52">mass_stor_configureNextDevice</a></div><div class="ttdeci">int mass_stor_configureNextDevice(void)</div><div class="ttdef"><b>Definition:</b> <a href="usb__driver_8c_source.html#l01081">usb_driver.c:1081</a></div></div>
<div class="ttc" id="athbase_8h_html_a9e662b5867cf57e38015ced97ae413b6"><div class="ttname"><a href="thbase_8h.html#a9e662b5867cf57e38015ced97ae413b6">DelayThread</a></div><div class="ttdeci">int DelayThread(int usec)</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="thbase_8h.html#a9e662b5867cf57e38015ced97ae413b6">DelayThread()</a>, <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00036">g_fatd</a>, <a class="el" href="usb__driver_8c_source.html#l01081">mass_stor_configureNextDevice()</a>, <a class="el" href="defs_8h_source.html#l00022">NULL</a>, and <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00035">NUM_DRIVES</a>.</p>

</div>
</div>
<a id="a7bb176f7870759d9c493606e0241f900"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7bb176f7870759d9c493606e0241f900">&#9670;&nbsp;</a></span>fat_getDirentry()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fat_getDirentry </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>fatType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="unionfat__direntry.html">fat_direntry</a> *&#160;</td>
          <td class="paramname"><em>dir_entry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfat__direntry__summary.html">fat_direntry_summary</a> *&#160;</td>
          <td class="paramname"><em>dir</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00345">345</a> of file <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html">fat_driver.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                                                                                                {</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        <span class="keywordtype">int</span> i, j;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> offset;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> cont;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <a class="code" href="tamtypes_8h.html#a9e6c91d77e24643b888dbd1a1a590054">u16</a> character;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160; </div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        <span class="comment">//detect last entry - all zeros (slight modification by radad)</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        <span class="keywordflow">if</span> (dir_entry-&gt;<a class="code" href="unionfat__direntry.html#ae848e0643536c9ec991ad7fdc183e855">sfn</a>.<a class="code" href="structfat__direntry__sfn.html#a5afebcc9960a4f846cc82a14bea2d314">name</a>[0] == 0) {</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        }</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        <span class="comment">//detect deleted entry - it will be ignored</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        <span class="keywordflow">if</span> (dir_entry-&gt;<a class="code" href="unionfat__direntry.html#ae848e0643536c9ec991ad7fdc183e855">sfn</a>.<a class="code" href="structfat__direntry__sfn.html#a5afebcc9960a4f846cc82a14bea2d314">name</a>[0] == 0xE5) {</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                <span class="keywordflow">return</span> 3;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        }</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160; </div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        <span class="comment">//detect long filename</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        <span class="keywordflow">if</span> (dir_entry-&gt;<a class="code" href="unionfat__direntry.html#a8b7776b246b0dc345275e9df4bb9bb04">lfn</a>.<a class="code" href="structfat__direntry__lfn.html#af7e40247c35c0aa2918d1500b9ce72d8">rshv</a> == 0x0F &amp;&amp; dir_entry-&gt;<a class="code" href="unionfat__direntry.html#a8b7776b246b0dc345275e9df4bb9bb04">lfn</a>.<a class="code" href="structfat__direntry__lfn.html#a8c3039615cb9dce89dc0e9bb3351f935">reserved1</a> == 0x00 &amp;&amp; dir_entry-&gt;<a class="code" href="unionfat__direntry.html#a8b7776b246b0dc345275e9df4bb9bb04">lfn</a>.<a class="code" href="structfat__direntry__lfn.html#aea7e850d420d60992f103c6bbf91ade8">reserved2</a>[0] == 0x00) {</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                <span class="comment">//long filename - almost whole direntry is unicode string - extract it</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                offset = dir_entry-&gt;<a class="code" href="unionfat__direntry.html#a8b7776b246b0dc345275e9df4bb9bb04">lfn</a>.<a class="code" href="structfat__direntry__lfn.html#ae2261ab111fc74d895945c8894696b77">entrySeq</a> &amp; 0x3f;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                offset--;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                offset = offset * 13;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                <span class="comment">//name - 1st part</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                cont = 1;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                <span class="keywordflow">for</span> (i = 0; i &lt; 10 &amp;&amp; cont; i+=2) {</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                        character = dir_entry-&gt;<a class="code" href="unionfat__direntry.html#a8b7776b246b0dc345275e9df4bb9bb04">lfn</a>.<a class="code" href="structfat__direntry__lfn.html#a9a11b610e4be7311ccf9ece74fbaf4f2">name1</a>[i] | (dir_entry-&gt;<a class="code" href="unionfat__direntry.html#a8b7776b246b0dc345275e9df4bb9bb04">lfn</a>.<a class="code" href="structfat__direntry__lfn.html#a9a11b610e4be7311ccf9ece74fbaf4f2">name1</a>[i+1] &lt;&lt; 8);</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160; </div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                        <span class="keywordflow">if</span> (character == 0 || offset &gt;= (<a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a54463534a10589cec097624945983344">FAT_MAX_NAME</a> - 1)) {</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                                dir-&gt;<a class="code" href="structfat__direntry__summary.html#a731c27293c20abff15634b96aa625d8b">name</a>[offset] = 0; <span class="comment">//terminate</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                                cont = 0; <span class="comment">//stop</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                                <span class="comment">// Handle characters that we don&#39;t support.</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                                dir-&gt;<a class="code" href="structfat__direntry__summary.html#a731c27293c20abff15634b96aa625d8b">name</a>[offset] = character &lt;= <a class="code" href="limits_8h.html#a4066e640ee269d5d8f83ff6643b7af5f">UCHAR_MAX</a> ? dir_entry-&gt;<a class="code" href="unionfat__direntry.html#a8b7776b246b0dc345275e9df4bb9bb04">lfn</a>.<a class="code" href="structfat__direntry__lfn.html#a9a11b610e4be7311ccf9ece74fbaf4f2">name1</a>[i] : <span class="charliteral">&#39;?&#39;</span>;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                                offset++;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                        }</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                }</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                <span class="comment">//name - 2nd part</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                <span class="keywordflow">for</span> (i = 0; i &lt; 12 &amp;&amp; cont; i+=2) {</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                        character = dir_entry-&gt;<a class="code" href="unionfat__direntry.html#a8b7776b246b0dc345275e9df4bb9bb04">lfn</a>.<a class="code" href="structfat__direntry__lfn.html#a2fb0f85a9b2daced57050f1eeb247668">name2</a>[i] | (dir_entry-&gt;<a class="code" href="unionfat__direntry.html#a8b7776b246b0dc345275e9df4bb9bb04">lfn</a>.<a class="code" href="structfat__direntry__lfn.html#a2fb0f85a9b2daced57050f1eeb247668">name2</a>[i+1] &lt;&lt; 8);</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160; </div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                        <span class="keywordflow">if</span> (character == 0 || offset &gt;= (<a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a54463534a10589cec097624945983344">FAT_MAX_NAME</a> - 1)) {</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                                dir-&gt;<a class="code" href="structfat__direntry__summary.html#a731c27293c20abff15634b96aa625d8b">name</a>[offset] = 0; <span class="comment">//terminate</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                                cont = 0; <span class="comment">//stop</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                                <span class="comment">// Handle characters that we don&#39;t support.</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                                dir-&gt;<a class="code" href="structfat__direntry__summary.html#a731c27293c20abff15634b96aa625d8b">name</a>[offset] = character &lt;= <a class="code" href="limits_8h.html#a4066e640ee269d5d8f83ff6643b7af5f">UCHAR_MAX</a> ? dir_entry-&gt;<a class="code" href="unionfat__direntry.html#a8b7776b246b0dc345275e9df4bb9bb04">lfn</a>.<a class="code" href="structfat__direntry__lfn.html#a2fb0f85a9b2daced57050f1eeb247668">name2</a>[i] : <span class="charliteral">&#39;?&#39;</span>;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                                offset++;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                        }</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                }</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                <span class="comment">//name - 3rd part</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                <span class="keywordflow">for</span> (i = 0; i &lt; 4 &amp;&amp; cont; i+=2) {</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                        character = dir_entry-&gt;<a class="code" href="unionfat__direntry.html#a8b7776b246b0dc345275e9df4bb9bb04">lfn</a>.<a class="code" href="structfat__direntry__lfn.html#af96209c08660ee362a65978e6af8fb93">name3</a>[i] | (dir_entry-&gt;<a class="code" href="unionfat__direntry.html#a8b7776b246b0dc345275e9df4bb9bb04">lfn</a>.<a class="code" href="structfat__direntry__lfn.html#af96209c08660ee362a65978e6af8fb93">name3</a>[i+1] &lt;&lt; 8);</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160; </div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                        <span class="keywordflow">if</span> (character == 0 || offset &gt;= (<a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a54463534a10589cec097624945983344">FAT_MAX_NAME</a> - 1)) {</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                                dir-&gt;<a class="code" href="structfat__direntry__summary.html#a731c27293c20abff15634b96aa625d8b">name</a>[offset] = 0; <span class="comment">//terminate</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                                cont = 0; <span class="comment">//stop</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                                <span class="comment">// Handle characters that we don&#39;t support.</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                                dir-&gt;<a class="code" href="structfat__direntry__summary.html#a731c27293c20abff15634b96aa625d8b">name</a>[offset] = character &lt;= <a class="code" href="limits_8h.html#a4066e640ee269d5d8f83ff6643b7af5f">UCHAR_MAX</a> ? dir_entry-&gt;<a class="code" href="unionfat__direntry.html#a8b7776b246b0dc345275e9df4bb9bb04">lfn</a>.<a class="code" href="structfat__direntry__lfn.html#af96209c08660ee362a65978e6af8fb93">name3</a>[i] : <span class="charliteral">&#39;?&#39;</span>;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                                offset++;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                        }</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                }</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                <span class="keywordflow">if</span> ((dir_entry-&gt;<a class="code" href="unionfat__direntry.html#a8b7776b246b0dc345275e9df4bb9bb04">lfn</a>.<a class="code" href="structfat__direntry__lfn.html#ae2261ab111fc74d895945c8894696b77">entrySeq</a> &amp; 0x40)) { <span class="comment">//terminate string flag</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                        dir-&gt;<a class="code" href="structfat__direntry__summary.html#a731c27293c20abff15634b96aa625d8b">name</a>[offset] = 0;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                }</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                <span class="keywordflow">return</span> 2;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                <span class="comment">//short filename</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                <span class="comment">//copy name</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                <span class="keywordflow">for</span> (i = 0; i &lt; 8 &amp;&amp; dir_entry-&gt;<a class="code" href="unionfat__direntry.html#ae848e0643536c9ec991ad7fdc183e855">sfn</a>.<a class="code" href="structfat__direntry__sfn.html#a5afebcc9960a4f846cc82a14bea2d314">name</a>[i]!= <span class="charliteral">&#39; &#39;</span>; i++) {</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                        dir-&gt;<a class="code" href="structfat__direntry__summary.html#a612974fb21a07051bdef981810d07efc">sname</a>[i] = dir_entry-&gt;<a class="code" href="unionfat__direntry.html#ae848e0643536c9ec991ad7fdc183e855">sfn</a>.<a class="code" href="structfat__direntry__sfn.html#a5afebcc9960a4f846cc82a14bea2d314">name</a>[i];</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                        <span class="comment">// NT-adaption for LaunchELF</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                        <span class="keywordflow">if</span> (dir_entry-&gt;<a class="code" href="unionfat__direntry.html#ae848e0643536c9ec991ad7fdc183e855">sfn</a>.<a class="code" href="structfat__direntry__sfn.html#a55d132f6e9ed0709940437f71991387d">reservedNT</a> &amp; 0x08 &amp;&amp;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                          dir-&gt;<a class="code" href="structfat__direntry__summary.html#a612974fb21a07051bdef981810d07efc">sname</a>[i] &gt;= <span class="charliteral">&#39;A&#39;</span> &amp;&amp; dir-&gt;<a class="code" href="structfat__direntry__summary.html#a612974fb21a07051bdef981810d07efc">sname</a>[i] &lt;= <span class="charliteral">&#39;Z&#39;</span>) {</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                                dir-&gt;<a class="code" href="structfat__direntry__summary.html#a612974fb21a07051bdef981810d07efc">sname</a>[i] += 0x20;  <span class="comment">//Force standard letters in name to lower case</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                        }</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                }</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                <span class="keywordflow">for</span> (j=0; j &lt; 3 &amp;&amp; dir_entry-&gt;<a class="code" href="unionfat__direntry.html#ae848e0643536c9ec991ad7fdc183e855">sfn</a>.<a class="code" href="structfat__direntry__sfn.html#ad7700748e3924378c6f34acdac6550cf">ext</a>[j] != <span class="charliteral">&#39; &#39;</span>; j++) {</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                        <span class="keywordflow">if</span> (j == 0) {</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                                dir-&gt;<a class="code" href="structfat__direntry__summary.html#a612974fb21a07051bdef981810d07efc">sname</a>[i] = <span class="charliteral">&#39;.&#39;</span>;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                                i++;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                        }</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                        dir-&gt;<a class="code" href="structfat__direntry__summary.html#a612974fb21a07051bdef981810d07efc">sname</a>[i+j] = dir_entry-&gt;<a class="code" href="unionfat__direntry.html#ae848e0643536c9ec991ad7fdc183e855">sfn</a>.<a class="code" href="structfat__direntry__sfn.html#ad7700748e3924378c6f34acdac6550cf">ext</a>[j];</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                        <span class="comment">// NT-adaption for LaunchELF</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                        <span class="keywordflow">if</span> (dir_entry-&gt;<a class="code" href="unionfat__direntry.html#ae848e0643536c9ec991ad7fdc183e855">sfn</a>.<a class="code" href="structfat__direntry__sfn.html#a55d132f6e9ed0709940437f71991387d">reservedNT</a> &amp; 0x10 &amp;&amp;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                          dir-&gt;<a class="code" href="structfat__direntry__summary.html#a612974fb21a07051bdef981810d07efc">sname</a>[i+j] &gt;= <span class="charliteral">&#39;A&#39;</span> &amp;&amp; dir-&gt;<a class="code" href="structfat__direntry__summary.html#a612974fb21a07051bdef981810d07efc">sname</a>[i+j] &lt;= <span class="charliteral">&#39;Z&#39;</span>) {</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                                dir-&gt;<a class="code" href="structfat__direntry__summary.html#a612974fb21a07051bdef981810d07efc">sname</a>[i+j] += 0x20;        <span class="comment">//Force standard letters in ext to lower case</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                        }</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                }</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                dir-&gt;<a class="code" href="structfat__direntry__summary.html#a612974fb21a07051bdef981810d07efc">sname</a>[i+j] = 0; <span class="comment">//terminate</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                <span class="keywordflow">if</span> (dir-&gt;<a class="code" href="structfat__direntry__summary.html#a731c27293c20abff15634b96aa625d8b">name</a>[0] == 0) { <span class="comment">//long name desn&#39;t exit</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                        <span class="keywordflow">for</span> (i =0 ; dir-&gt;<a class="code" href="structfat__direntry__summary.html#a612974fb21a07051bdef981810d07efc">sname</a>[i] !=0; i++) dir-&gt;<a class="code" href="structfat__direntry__summary.html#a731c27293c20abff15634b96aa625d8b">name</a>[i] = dir-&gt;<a class="code" href="structfat__direntry__summary.html#a612974fb21a07051bdef981810d07efc">sname</a>[i];</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                        dir-&gt;<a class="code" href="structfat__direntry__summary.html#a731c27293c20abff15634b96aa625d8b">name</a>[i] = 0;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                }</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                dir-&gt;<a class="code" href="structfat__direntry__summary.html#a47299e884846ba00bef7ec883483ff3a">attr</a> = dir_entry-&gt;<a class="code" href="unionfat__direntry.html#ae848e0643536c9ec991ad7fdc183e855">sfn</a>.<a class="code" href="structfat__direntry__sfn.html#a3e4c6af46c3ba3f83a01bcba62adee15">attr</a>;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                dir-&gt;<a class="code" href="structfat__direntry__summary.html#ac0088c089e563801a1c4171b79522e77">size</a> = <a class="code" href="fs_2bdm_2src_2part__driver_8c.html#acdf30bdc458302252ad1c28906727cbd">getI32</a>(dir_entry-&gt;<a class="code" href="unionfat__direntry.html#ae848e0643536c9ec991ad7fdc183e855">sfn</a>.<a class="code" href="structfat__direntry__sfn.html#aecd84c7701daa097a3f4095253ab90b1">size</a>);</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                dir-&gt;<a class="code" href="structfat__direntry__summary.html#afa7836ddc180210650db2f456f6da285">cluster</a> = (fatType == <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat_8h.html#a51cfb551f0270354f9115893b7f4339f">FAT32</a>) ? <a class="code" href="fs_2bdmfs__vfat_2src_2include_2common_8h.html#aa4d54e55a974621a9fa295c3fe7ce469">getI32_2</a>(dir_entry-&gt;<a class="code" href="unionfat__direntry.html#ae848e0643536c9ec991ad7fdc183e855">sfn</a>.<a class="code" href="structfat__direntry__sfn.html#ad032d5bb1f568f8341b6eb86f95b8c11">clusterL</a>, dir_entry-&gt;<a class="code" href="unionfat__direntry.html#ae848e0643536c9ec991ad7fdc183e855">sfn</a>.<a class="code" href="structfat__direntry__sfn.html#a4b209cfc15db02e0eb057ac042fe1cfb">clusterH</a>) : <a class="code" href="fs_2bdmfs__vfat_2src_2include_2common_8h.html#a98122f7798bea6dd7cb0862431e0408e">getI16</a>(dir_entry-&gt;<a class="code" href="unionfat__direntry.html#ae848e0643536c9ec991ad7fdc183e855">sfn</a>.<a class="code" href="structfat__direntry__sfn.html#ad032d5bb1f568f8341b6eb86f95b8c11">clusterL</a>);</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160; </div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        }</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;}</div>
<div class="ttc" id="afs_2bdmfs__vfat_2src_2include_2common_8h_html_aa4d54e55a974621a9fa295c3fe7ce469"><div class="ttname"><a href="fs_2bdmfs__vfat_2src_2include_2common_8h.html#aa4d54e55a974621a9fa295c3fe7ce469">getI32_2</a></div><div class="ttdeci">#define getI32_2(buf1, buf2)</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2common_8h_source.html#l00015">common.h:15</a></div></div>
<div class="ttc" id="afs_2bdmfs__vfat_2src_2include_2fat__driver_8h_html_a54463534a10589cec097624945983344"><div class="ttname"><a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a54463534a10589cec097624945983344">FAT_MAX_NAME</a></div><div class="ttdeci">#define FAT_MAX_NAME</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00009">fat_driver.h:9</a></div></div>
<div class="ttc" id="alimits_8h_html_a4066e640ee269d5d8f83ff6643b7af5f"><div class="ttname"><a href="limits_8h.html#a4066e640ee269d5d8f83ff6643b7af5f">UCHAR_MAX</a></div><div class="ttdeci">#define UCHAR_MAX</div><div class="ttdef"><b>Definition:</b> <a href="limits_8h_source.html#l00026">limits.h:26</a></div></div>
<div class="ttc" id="astructfat__direntry__lfn_html_a2fb0f85a9b2daced57050f1eeb247668"><div class="ttname"><a href="structfat__direntry__lfn.html#a2fb0f85a9b2daced57050f1eeb247668">fat_direntry_lfn::name2</a></div><div class="ttdeci">unsigned char name2[12]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00125">fat.h:125</a></div></div>
<div class="ttc" id="astructfat__direntry__lfn_html_a8c3039615cb9dce89dc0e9bb3351f935"><div class="ttname"><a href="structfat__direntry__lfn.html#a8c3039615cb9dce89dc0e9bb3351f935">fat_direntry_lfn::reserved1</a></div><div class="ttdeci">unsigned char reserved1</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00123">fat.h:123</a></div></div>
<div class="ttc" id="astructfat__direntry__lfn_html_a9a11b610e4be7311ccf9ece74fbaf4f2"><div class="ttname"><a href="structfat__direntry__lfn.html#a9a11b610e4be7311ccf9ece74fbaf4f2">fat_direntry_lfn::name1</a></div><div class="ttdeci">unsigned char name1[10]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00120">fat.h:120</a></div></div>
<div class="ttc" id="astructfat__direntry__lfn_html_ae2261ab111fc74d895945c8894696b77"><div class="ttname"><a href="structfat__direntry__lfn.html#ae2261ab111fc74d895945c8894696b77">fat_direntry_lfn::entrySeq</a></div><div class="ttdeci">unsigned char entrySeq</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00119">fat.h:119</a></div></div>
<div class="ttc" id="astructfat__direntry__lfn_html_aea7e850d420d60992f103c6bbf91ade8"><div class="ttname"><a href="structfat__direntry__lfn.html#aea7e850d420d60992f103c6bbf91ade8">fat_direntry_lfn::reserved2</a></div><div class="ttdeci">unsigned char reserved2[2]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00127">fat.h:127</a></div></div>
<div class="ttc" id="astructfat__direntry__lfn_html_af7e40247c35c0aa2918d1500b9ce72d8"><div class="ttname"><a href="structfat__direntry__lfn.html#af7e40247c35c0aa2918d1500b9ce72d8">fat_direntry_lfn::rshv</a></div><div class="ttdeci">unsigned char rshv</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00121">fat.h:121</a></div></div>
<div class="ttc" id="astructfat__direntry__lfn_html_af96209c08660ee362a65978e6af8fb93"><div class="ttname"><a href="structfat__direntry__lfn.html#af96209c08660ee362a65978e6af8fb93">fat_direntry_lfn::name3</a></div><div class="ttdeci">unsigned char name3[4]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00128">fat.h:128</a></div></div>
<div class="ttc" id="astructfat__direntry__sfn_html_a3e4c6af46c3ba3f83a01bcba62adee15"><div class="ttname"><a href="structfat__direntry__sfn.html#a3e4c6af46c3ba3f83a01bcba62adee15">fat_direntry_sfn::attr</a></div><div class="ttdeci">unsigned char attr</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00099">fat.h:99</a></div></div>
<div class="ttc" id="astructfat__direntry__sfn_html_a4b209cfc15db02e0eb057ac042fe1cfb"><div class="ttname"><a href="structfat__direntry__sfn.html#a4b209cfc15db02e0eb057ac042fe1cfb">fat_direntry_sfn::clusterH</a></div><div class="ttdeci">unsigned char clusterH[2]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00106">fat.h:106</a></div></div>
<div class="ttc" id="astructfat__direntry__sfn_html_a55d132f6e9ed0709940437f71991387d"><div class="ttname"><a href="structfat__direntry__sfn.html#a55d132f6e9ed0709940437f71991387d">fat_direntry_sfn::reservedNT</a></div><div class="ttdeci">unsigned char reservedNT</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00101">fat.h:101</a></div></div>
<div class="ttc" id="astructfat__direntry__sfn_html_a5afebcc9960a4f846cc82a14bea2d314"><div class="ttname"><a href="structfat__direntry__sfn.html#a5afebcc9960a4f846cc82a14bea2d314">fat_direntry_sfn::name</a></div><div class="ttdeci">unsigned char name[8]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00097">fat.h:97</a></div></div>
<div class="ttc" id="astructfat__direntry__sfn_html_ad032d5bb1f568f8341b6eb86f95b8c11"><div class="ttname"><a href="structfat__direntry__sfn.html#ad032d5bb1f568f8341b6eb86f95b8c11">fat_direntry_sfn::clusterL</a></div><div class="ttdeci">unsigned char clusterL[2]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00110">fat.h:110</a></div></div>
<div class="ttc" id="astructfat__direntry__sfn_html_ad7700748e3924378c6f34acdac6550cf"><div class="ttname"><a href="structfat__direntry__sfn.html#ad7700748e3924378c6f34acdac6550cf">fat_direntry_sfn::ext</a></div><div class="ttdeci">unsigned char ext[3]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00098">fat.h:98</a></div></div>
<div class="ttc" id="astructfat__direntry__sfn_html_aecd84c7701daa097a3f4095253ab90b1"><div class="ttname"><a href="structfat__direntry__sfn.html#aecd84c7701daa097a3f4095253ab90b1">fat_direntry_sfn::size</a></div><div class="ttdeci">unsigned char size[4]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00111">fat.h:111</a></div></div>
<div class="ttc" id="astructfat__direntry__summary_html_a47299e884846ba00bef7ec883483ff3a"><div class="ttname"><a href="structfat__direntry__summary.html#a47299e884846ba00bef7ec883483ff3a">fat_direntry_summary::attr</a></div><div class="ttdeci">unsigned char attr</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00137">fat.h:137</a></div></div>
<div class="ttc" id="astructfat__direntry__summary_html_a612974fb21a07051bdef981810d07efc"><div class="ttname"><a href="structfat__direntry__summary.html#a612974fb21a07051bdef981810d07efc">fat_direntry_summary::sname</a></div><div class="ttdeci">char sname[13]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00139">fat.h:139</a></div></div>
<div class="ttc" id="astructfat__direntry__summary_html_a731c27293c20abff15634b96aa625d8b"><div class="ttname"><a href="structfat__direntry__summary.html#a731c27293c20abff15634b96aa625d8b">fat_direntry_summary::name</a></div><div class="ttdeci">char name[FAT_MAX_NAME]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00138">fat.h:138</a></div></div>
<div class="ttc" id="astructfat__direntry__summary_html_ac0088c089e563801a1c4171b79522e77"><div class="ttname"><a href="structfat__direntry__summary.html#ac0088c089e563801a1c4171b79522e77">fat_direntry_summary::size</a></div><div class="ttdeci">unsigned int size</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00140">fat.h:140</a></div></div>
<div class="ttc" id="astructfat__direntry__summary_html_afa7836ddc180210650db2f456f6da285"><div class="ttname"><a href="structfat__direntry__summary.html#afa7836ddc180210650db2f456f6da285">fat_direntry_summary::cluster</a></div><div class="ttdeci">unsigned int cluster</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00141">fat.h:141</a></div></div>
<div class="ttc" id="atamtypes_8h_html_a9e6c91d77e24643b888dbd1a1a590054"><div class="ttname"><a href="tamtypes_8h.html#a9e6c91d77e24643b888dbd1a1a590054">u16</a></div><div class="ttdeci">unsigned short u16</div><div class="ttdef"><b>Definition:</b> <a href="tamtypes_8h_source.html#l00024">tamtypes.h:24</a></div></div>
<div class="ttc" id="aunionfat__direntry_html_a8b7776b246b0dc345275e9df4bb9bb04"><div class="ttname"><a href="unionfat__direntry.html#a8b7776b246b0dc345275e9df4bb9bb04">fat_direntry::lfn</a></div><div class="ttdeci">fat_direntry_lfn lfn</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00133">fat.h:133</a></div></div>
<div class="ttc" id="aunionfat__direntry_html_ae848e0643536c9ec991ad7fdc183e855"><div class="ttname"><a href="unionfat__direntry.html#ae848e0643536c9ec991ad7fdc183e855">fat_direntry::sfn</a></div><div class="ttdeci">fat_direntry_sfn sfn</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00132">fat.h:132</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00099">fat_direntry_sfn::attr</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00137">fat_direntry_summary::attr</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00141">fat_direntry_summary::cluster</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00106">fat_direntry_sfn::clusterH</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00110">fat_direntry_sfn::clusterL</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00119">fat_direntry_lfn::entrySeq</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00098">fat_direntry_sfn::ext</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00023">FAT32</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00009">FAT_MAX_NAME</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2common_8h_source.html#l00016">getI16</a>, <a class="el" href="fs_2bdm_2src_2part__driver_8c_source.html#l00009">getI32</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2common_8h_source.html#l00015">getI32_2</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00133">fat_direntry::lfn</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00097">fat_direntry_sfn::name</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00138">fat_direntry_summary::name</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00120">fat_direntry_lfn::name1</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00125">fat_direntry_lfn::name2</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00128">fat_direntry_lfn::name3</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00123">fat_direntry_lfn::reserved1</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00127">fat_direntry_lfn::reserved2</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00101">fat_direntry_sfn::reservedNT</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00121">fat_direntry_lfn::rshv</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00132">fat_direntry::sfn</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00111">fat_direntry_sfn::size</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00140">fat_direntry_summary::size</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00139">fat_direntry_summary::sname</a>, and <a class="el" href="limits_8h_source.html#l00026">UCHAR_MAX</a>.</p>

</div>
</div>
<a id="a5c34f9c163f391dacbc7153385f5e0e0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5c34f9c163f391dacbc7153385f5e0e0">&#9670;&nbsp;</a></span>fat_getDirentrySectorData()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fat_getDirentrySectorData </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfat__driver.html">fat_driver</a> *&#160;</td>
          <td class="paramname"><em>fatd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&#160;</td>
          <td class="paramname"><em>startCluster</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&#160;</td>
          <td class="paramname"><em>startSector</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&#160;</td>
          <td class="paramname"><em>dirSector</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00571">571</a> of file <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html">fat_driver.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                                                                                                                                {</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> chainSize;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160; </div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;        <span class="keywordflow">if</span> (*startCluster == 0 &amp;&amp; fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#ab661c72fc95b56a3ca635b817d3af54b">fatType</a> &lt; <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat_8h.html#a51cfb551f0270354f9115893b7f4339f">FAT32</a>) { <span class="comment">//Root directory</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                *startSector = fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#acfc55af344e0b4d42e691e9dfa729668">rootDirStart</a>;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                *dirSector =  fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#ad81080068bad0ff3fffe57049f39aee4">rootSize</a> / (fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#aec6b3ab436f1855028e3564a5755dd69">sectorSize</a> / 32);</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        }</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;         <span class="comment">//other directory or fat 32</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        <span class="keywordflow">if</span> (*startCluster == 0 &amp;&amp; fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#ab661c72fc95b56a3ca635b817d3af54b">fatType</a> == <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat_8h.html#a51cfb551f0270354f9115893b7f4339f">FAT32</a>) {</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;                *startCluster = fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#a44140339beb655a17e59b51e8405a862">rootDirCluster</a>;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        }</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        *startSector = <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat_8h.html#a7a0f69dcf37ca416800d90a7543e02ef">fat_cluster2sector</a>(&amp;fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>, *startCluster);</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        chainSize = <a class="code" href="fs_2bdmfs__vfat_2src_2fat__driver_8c.html#a04f7d3056137a9a46fa5735e8a38f730">fat_getClusterChain</a>(fatd, *startCluster, fatd-&gt;<a class="code" href="structfat__driver.html#a62c4794e13845244b324409ebfb71919">cbuf</a>, <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a8f3ada716b434a6f52c4cfbb919d3be4">MAX_DIR_CLUSTER</a>, 1);</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        <span class="keywordflow">if</span> (chainSize &gt;= <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a8f3ada716b434a6f52c4cfbb919d3be4">MAX_DIR_CLUSTER</a>) {</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: Chain too large\n&quot;</span>);</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                <span class="keywordflow">return</span> -<a class="code" href="errno_8h.html#a3f317946e043623f9d6b93dbf60e6316">EFAULT</a>;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (chainSize &gt; 0) {</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                *dirSector = chainSize * fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#a1cf892c4c80adcc3500ca90baab803b5">clusterSize</a>;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: Error getting cluster chain! startCluster=%u \n&quot;</span>, *startCluster);</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                <span class="keywordflow">return</span> -<a class="code" href="errno_8h.html#a3f317946e043623f9d6b93dbf60e6316">EFAULT</a>;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        }</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160; </div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        <span class="keywordflow">return</span> chainSize;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;}</div>
<div class="ttc" id="aerrno_8h_html_a3f317946e043623f9d6b93dbf60e6316"><div class="ttname"><a href="errno_8h.html#a3f317946e043623f9d6b93dbf60e6316">EFAULT</a></div><div class="ttdeci">#define EFAULT</div><div class="ttdef"><b>Definition:</b> <a href="errno_8h_source.html#l00046">errno.h:46</a></div></div>
<div class="ttc" id="afs_2bdmfs__vfat_2src_2fat__driver_8c_html_a04f7d3056137a9a46fa5735e8a38f730"><div class="ttname"><a href="fs_2bdmfs__vfat_2src_2fat__driver_8c.html#a04f7d3056137a9a46fa5735e8a38f730">fat_getClusterChain</a></div><div class="ttdeci">int fat_getClusterChain(fat_driver *fatd, unsigned int cluster, unsigned int *buf, unsigned int bufSize, int startFlag)</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2fat__driver_8c_source.html#l00235">fat_driver.c:235</a></div></div>
<div class="ttc" id="afs_2bdmfs__vfat_2src_2include_2fat__driver_8h_html_a8f3ada716b434a6f52c4cfbb919d3be4"><div class="ttname"><a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a8f3ada716b434a6f52c4cfbb919d3be4">MAX_DIR_CLUSTER</a></div><div class="ttdeci">#define MAX_DIR_CLUSTER</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00071">fat_driver.h:71</a></div></div>
<div class="ttc" id="astructfat__bpb_html_a44140339beb655a17e59b51e8405a862"><div class="ttname"><a href="structfat__bpb.html#a44140339beb655a17e59b51e8405a862">fat_bpb::rootDirCluster</a></div><div class="ttdeci">unsigned int rootDirCluster</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00058">fat_driver.h:58</a></div></div>
<div class="ttc" id="astructfat__bpb_html_acfc55af344e0b4d42e691e9dfa729668"><div class="ttname"><a href="structfat__bpb.html#acfc55af344e0b4d42e691e9dfa729668">fat_bpb::rootDirStart</a></div><div class="ttdeci">unsigned int rootDirStart</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00057">fat_driver.h:57</a></div></div>
<div class="ttc" id="astructfat__bpb_html_ad81080068bad0ff3fffe57049f39aee4"><div class="ttname"><a href="structfat__bpb.html#ad81080068bad0ff3fffe57049f39aee4">fat_bpb::rootSize</a></div><div class="ttdeci">unsigned int rootSize</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00051">fat_driver.h:51</a></div></div>
<div class="ttc" id="astructfat__driver_html_a62c4794e13845244b324409ebfb71919"><div class="ttname"><a href="structfat__driver.html#a62c4794e13845244b324409ebfb71919">fat_driver::cbuf</a></div><div class="ttdeci">unsigned int cbuf[MAX_DIR_CLUSTER]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00072">fat_driver.h:72</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00072">fat_driver::cbuf</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00048">fat_bpb::clusterSize</a>, <a class="el" href="errno_8h_source.html#l00046">EFAULT</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00023">FAT32</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00145">fat_cluster2sector()</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2fat__driver_8c_source.html#l00235">fat_getClusterChain()</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00060">fat_bpb::fatType</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00071">MAX_DIR_CLUSTER</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00068">fat_driver::partBpb</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00058">fat_bpb::rootDirCluster</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00057">fat_bpb::rootDirStart</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00051">fat_bpb::rootSize</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00047">fat_bpb::sectorSize</a>, and <a class="el" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h_source.html#l00008">XPRINTF</a>.</p>

</div>
</div>
<a id="a5709f4818dc077b0d002f1a7f1854ca5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5709f4818dc077b0d002f1a7f1854ca5">&#9670;&nbsp;</a></span>fat_getDirentryStartCluster()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int fat_getDirentryStartCluster </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfat__driver.html">fat_driver</a> *&#160;</td>
          <td class="paramname"><em>fatd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>dirName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&#160;</td>
          <td class="paramname"><em>startCluster</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfat__dir.html">fat_dir</a> *&#160;</td>
          <td class="paramname"><em>fatDir</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00599">599</a> of file <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html">fat_driver.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                                                                                                                     {</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        <a class="code" href="structfat__direntry__summary.html">fat_direntry_summary</a> dir;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, dirSector, startSector, dirPos;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> cont;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        <span class="keywordtype">int</span> ret;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        <a class="code" href="structmass__dev.html">mass_dev</a>* mass_device = fatd-&gt;<a class="code" href="structfat__driver.html#aef714ddc28773eb0da5b91b99129834d">dev</a>;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160; </div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        cont = 1;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: getting cluster for dir entry: %s \n&quot;</span>, dirName);</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="comment">//clear name strings</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        dir.<a class="code" href="structfat__direntry__summary.html#a612974fb21a07051bdef981810d07efc">sname</a>[0] = 0;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        dir.<a class="code" href="structfat__direntry__summary.html#a731c27293c20abff15634b96aa625d8b">name</a>[0] = 0;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160; </div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        ret = <a class="code" href="fs_2bdmfs__vfat_2src_2fat__driver_8c.html#a5c34f9c163f391dacbc7153385f5e0e0">fat_getDirentrySectorData</a>(fatd, startCluster, &amp;startSector, &amp;dirSector);</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160; </div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: dirCluster=%u startSector=%u (%u) dirSector=%u \n&quot;</span>, *startCluster, startSector, startSector * mass_device-&gt;sectorSize, dirSector);</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160; </div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        <span class="comment">//go through first directory sector till the max number of directory sectors</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        <span class="comment">//or stop when no more direntries detected</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        <span class="keywordflow">for</span> (i = 0; i &lt; dirSector &amp;&amp; cont; i++) {</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* <a class="code" href="fs_2bdm_2src_2part__driver_8c.html#a6d4ae1f692b64a14d19895e323c7b853">sbuf</a> = <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; <span class="comment">//sector buffer</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160; </div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                <span class="comment">//At cluster borders, get correct sector from cluster chain buffer</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                <span class="keywordflow">if</span> ((*startCluster != 0) &amp;&amp; (i % fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#a1cf892c4c80adcc3500ca90baab803b5">clusterSize</a> == 0)) {</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                        startSector = <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat_8h.html#a7a0f69dcf37ca416800d90a7543e02ef">fat_cluster2sector</a>(&amp;fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>, fatd-&gt;<a class="code" href="structfat__driver.html#a62c4794e13845244b324409ebfb71919">cbuf</a>[(i / fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#a1cf892c4c80adcc3500ca90baab803b5">clusterSize</a>)]) -i;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                }</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160; </div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                ret = <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ae328738f080a00611208ca42cb103e04">READ_SECTOR</a>(fatd-&gt;<a class="code" href="structfat__driver.html#aef714ddc28773eb0da5b91b99129834d">dev</a>, startSector + i, <a class="code" href="fs_2bdm_2src_2part__driver_8c.html#a6d4ae1f692b64a14d19895e323c7b853">sbuf</a>);</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                        <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: read directory sector failed ! sector=%u\n&quot;</span>, startSector + i);</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                        <span class="keywordflow">return</span> -<a class="code" href="errno_8h.html#a70979f50f9c83e5aebab3d6a1bd4cf35">EIO</a>;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                }</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: read sector ok, scanning sector for direntries...\n&quot;</span>);</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                dirPos = 0;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160; </div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                <span class="comment">// go through start of the sector till the end of sector</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                <span class="keywordflow">while</span> (cont &amp;&amp;  dirPos &lt; fatd-&gt;partBpb.sectorSize) {</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                        <a class="code" href="unionfat__direntry.html">fat_direntry</a>* dir_entry = (<a class="code" href="unionfat__direntry.html">fat_direntry</a>*) (<a class="code" href="fs_2bdm_2src_2part__driver_8c.html#a6d4ae1f692b64a14d19895e323c7b853">sbuf</a> + dirPos);</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                        cont = <a class="code" href="fs_2bdmfs__vfat_2src_2fat__driver_8c.html#a7bb176f7870759d9c493606e0241f900">fat_getDirentry</a>(fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#ab661c72fc95b56a3ca635b817d3af54b">fatType</a>, dir_entry, &amp;dir); <span class="comment">//get single directory entry from sector buffer</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                        <span class="keywordflow">if</span> (cont == 1) { <span class="comment">//when short file name entry detected</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                                <span class="keywordflow">if</span> (!(dir.<a class="code" href="structfat__direntry__summary.html#a47299e884846ba00bef7ec883483ff3a">attr</a> &amp; <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a3ce8e4822ed18e7e3dd92ea67aa8ffcf">FAT_ATTR_VOLUME_LABEL</a>)) { <span class="comment">//not volume label</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                                        <span class="keywordflow">if</span> ((<a class="code" href="fs_2bdmfs__vfat_2src_2fat__driver_8c.html#ae21ac7e24598e16bdbd96bc2ab7114f0">strEqual</a>(dir.<a class="code" href="structfat__direntry__summary.html#a612974fb21a07051bdef981810d07efc">sname</a>, dirName) == 0) ||</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                                                (<a class="code" href="fs_2bdmfs__vfat_2src_2fat__driver_8c.html#ae21ac7e24598e16bdbd96bc2ab7114f0">strEqual</a>(dir.<a class="code" href="structfat__direntry__summary.html#a731c27293c20abff15634b96aa625d8b">name</a>, dirName) == 0) ) {</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                                                        <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: found! %s\n&quot;</span>, dir.<a class="code" href="structfat__direntry__summary.html#a731c27293c20abff15634b96aa625d8b">name</a>);</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                                                        <span class="keywordflow">if</span> (fatDir != <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) { <span class="comment">//fill the directory properties</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                                                                <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a201fa4870033ca4ecd729047edd05be4">fat_setFatDir</a>(fatd, fatDir, *startCluster, &amp;dir_entry-&gt;<a class="code" href="unionfat__direntry.html#ae848e0643536c9ec991ad7fdc183e855">sfn</a>, &amp;dir, 1);</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                                                        }</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                                                        *startCluster = dir.<a class="code" href="structfat__direntry__summary.html#afa7836ddc180210650db2f456f6da285">cluster</a>;</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                                                        <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: direntry %s found at cluster: %u \n&quot;</span>, dirName, dir.<a class="code" href="structfat__direntry__summary.html#afa7836ddc180210650db2f456f6da285">cluster</a>);</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                                                        <span class="keywordflow">return</span> dir.<a class="code" href="structfat__direntry__summary.html#a47299e884846ba00bef7ec883483ff3a">attr</a>; <span class="comment">//returns file or directory attr</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                                                }</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                                }<span class="comment">//ends &quot;if(!(dir.attr &amp; FAT_ATTR_VOLUME_LABEL))&quot;</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                                <span class="comment">//clear name strings</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                                dir.<a class="code" href="structfat__direntry__summary.html#a612974fb21a07051bdef981810d07efc">sname</a>[0] = 0;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                                dir.<a class="code" href="structfat__direntry__summary.html#a731c27293c20abff15634b96aa625d8b">name</a>[0] = 0;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                        }<span class="comment">//ends &quot;if (cont == 1)&quot;</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                        dirPos += <span class="keyword">sizeof</span>(<a class="code" href="unionfat__direntry.html">fat_direntry</a>);</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                }<span class="comment">//ends &quot;while&quot;</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        }<span class="comment">//ends &quot;for&quot;</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: direntry %s not found! \n&quot;</span>, dirName);</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        <span class="keywordflow">return</span> -<a class="code" href="errno_8h.html#a03e689f378f643d16ea7537918528a48">ENOENT</a>;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;}</div>
<div class="ttc" id="aerrno_8h_html_a03e689f378f643d16ea7537918528a48"><div class="ttname"><a href="errno_8h.html#a03e689f378f643d16ea7537918528a48">ENOENT</a></div><div class="ttdeci">#define ENOENT</div><div class="ttdef"><b>Definition:</b> <a href="errno_8h_source.html#l00022">errno.h:22</a></div></div>
<div class="ttc" id="afs_2bdmfs__vfat_2src_2fat__driver_8c_html_a5c34f9c163f391dacbc7153385f5e0e0"><div class="ttname"><a href="fs_2bdmfs__vfat_2src_2fat__driver_8c.html#a5c34f9c163f391dacbc7153385f5e0e0">fat_getDirentrySectorData</a></div><div class="ttdeci">int fat_getDirentrySectorData(fat_driver *fatd, unsigned int *startCluster, unsigned int *startSector, unsigned int *dirSector)</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2fat__driver_8c_source.html#l00602">fat_driver.c:602</a></div></div>
<div class="ttc" id="afs_2bdmfs__vfat_2src_2fat__driver_8c_html_a7bb176f7870759d9c493606e0241f900"><div class="ttname"><a href="fs_2bdmfs__vfat_2src_2fat__driver_8c.html#a7bb176f7870759d9c493606e0241f900">fat_getDirentry</a></div><div class="ttdeci">int fat_getDirentry(unsigned char fatType, fat_direntry *dir_entry, fat_direntry_summary *dir)</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2fat__driver_8c_source.html#l00369">fat_driver.c:369</a></div></div>
<div class="ttc" id="afs_2bdmfs__vfat_2src_2fat__driver_8c_html_ae21ac7e24598e16bdbd96bc2ab7114f0"><div class="ttname"><a href="fs_2bdmfs__vfat_2src_2fat__driver_8c.html#ae21ac7e24598e16bdbd96bc2ab7114f0">strEqual</a></div><div class="ttdeci">int strEqual(const char *s1, const char *s2)</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2fat__driver_8c_source.html#l00036">fat_driver.c:36</a></div></div>
<div class="ttc" id="afs_2bdmfs__vfat_2src_2include_2fat__driver_8h_html_a3ce8e4822ed18e7e3dd92ea67aa8ffcf"><div class="ttname"><a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a3ce8e4822ed18e7e3dd92ea67aa8ffcf">FAT_ATTR_VOLUME_LABEL</a></div><div class="ttdeci">#define FAT_ATTR_VOLUME_LABEL</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00015">fat_driver.h:15</a></div></div>
<div class="ttc" id="astructfat__direntry__summary_html"><div class="ttname"><a href="structfat__direntry__summary.html">fat_direntry_summary</a></div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00136">fat.h:136</a></div></div>
<div class="ttc" id="astructmass__dev_html"><div class="ttname"><a href="structmass__dev.html">mass_dev</a></div><div class="ttdef"><b>Definition:</b> <a href="usb__mass_8c_source.html#l00039">usb_mass.c:39</a></div></div>
<div class="ttc" id="aunionfat__direntry_html"><div class="ttname"><a href="unionfat__direntry.html">fat_direntry</a></div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00131">fat.h:131</a></div></div>
<div class="ttc" id="ausb_2usbhdfsd_2src_2fat__driver_8c_html_a201fa4870033ca4ecd729047edd05be4"><div class="ttname"><a href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a201fa4870033ca4ecd729047edd05be4">fat_setFatDir</a></div><div class="ttdeci">static void fat_setFatDir(fat_driver *fatd, fat_dir *fatDir, unsigned int parentDirCluster, fat_direntry_sfn *dsfn, fat_direntry_summary *dir, int getClusterInfo)</div><div class="ttdef"><b>Definition:</b> <a href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00513">fat_driver.c:513</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00137">fat_direntry_summary::attr</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00072">fat_driver::cbuf</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00141">fat_direntry_summary::cluster</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00048">fat_bpb::clusterSize</a>, <a class="el" href="iLink_2IEEE1394__disk_2src_2include_2fat__driver_8h_source.html#l00036">fat_driver::dev</a>, <a class="el" href="errno_8h_source.html#l00028">EIO</a>, <a class="el" href="errno_8h_source.html#l00022">ENOENT</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00015">FAT_ATTR_VOLUME_LABEL</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00145">fat_cluster2sector()</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2fat__driver_8c_source.html#l00369">fat_getDirentry()</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2fat__driver_8c_source.html#l00602">fat_getDirentrySectorData()</a>, <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00513">fat_setFatDir()</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00060">fat_bpb::fatType</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00138">fat_direntry_summary::name</a>, <a class="el" href="defs_8h_source.html#l00022">NULL</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00068">fat_driver::partBpb</a>, <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00031">READ_SECTOR</a>, <a class="el" href="fs_2bdm_2src_2part__driver_8c_source.html#l00064">sbuf</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00132">fat_direntry::sfn</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00139">fat_direntry_summary::sname</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2fat__driver_8c_source.html#l00036">strEqual()</a>, and <a class="el" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h_source.html#l00008">XPRINTF</a>.</p>

<p class="reference">Referenced by <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00670">fat_getFileStartCluster()</a>.</p>

</div>
</div>
<a id="a44bbecfdac2bf504b9a992b24db27e5e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a44bbecfdac2bf504b9a992b24db27e5e">&#9670;&nbsp;</a></span>fat_getFileStartCluster()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fat_getFileStartCluster </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfat__driver.html">fat_driver</a> *&#160;</td>
          <td class="paramname"><em>fatd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&#160;</td>
          <td class="paramname"><em>startCluster</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfat__dir.html">fat_dir</a> *&#160;</td>
          <td class="paramname"><em>fatDir</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00670">670</a> of file <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html">fat_driver.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                                                                                                              {</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="keywordtype">char</span> tmpName[<a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a54463534a10589cec097624945983344">FAT_MAX_NAME</a>+1];</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, offset;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        <span class="keywordtype">int</span> ret;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160; </div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: Entering fat_getFileStartCluster\n&quot;</span>);</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160; </div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        offset = 0;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        i=0;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160; </div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        *startCluster = 0;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        <span class="keywordflow">if</span> (fatDir != <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;                <a class="code" href="sysclib_8h.html#ab8dce9c192324f0fd191fd5b85c7bb60">memset</a>(fatDir, 0, <span class="keyword">sizeof</span>(<a class="code" href="structfat__dir.html">fat_dir</a>));</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                fatDir-&gt;<a class="code" href="structfat__dir.html#aaba9fc8582badd71d8403274f8e65030">attr</a> = <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#ad50209b5b697d61e976905db4a9a1964">FAT_ATTR_DIRECTORY</a>;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        }</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        <span class="keywordflow">if</span> (fname[i] == <span class="charliteral">&#39;/&#39;</span>) {</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;                i++;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        }</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160; </div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        <span class="keywordflow">for</span> ( ; fname[i] !=0; i++) {</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                <span class="keywordflow">if</span> (fname[i] == <span class="charliteral">&#39;/&#39;</span>) { <span class="comment">//directory separator</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                        tmpName[offset] = 0; <span class="comment">//terminate string</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                        ret = <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a5709f4818dc077b0d002f1a7f1854ca5">fat_getDirentryStartCluster</a>(fatd, tmpName, startCluster, fatDir);</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                        <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                                <span class="keywordflow">return</span> -<a class="code" href="errno_8h.html#a03e689f378f643d16ea7537918528a48">ENOENT</a>;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                        }</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                        offset = 0;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                } <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                        tmpName[offset] = fname[i];</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                        offset++;</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                }</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        }<span class="comment">//ends &quot;for&quot;</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        <span class="comment">//and the final file</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        tmpName[offset] = 0; <span class="comment">//terminate string</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: Ready to get cluster for file \&quot;%s\&quot;\n&quot;</span>, tmpName);</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        <span class="keywordflow">if</span> (fatDir != <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                <span class="comment">//if the last char of the name was slash - the name was already found -exit</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;                <span class="keywordflow">if</span> (offset == 0) {</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;                        <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: Exiting from fat_getFileStartCluster with a folder\n&quot;</span>);</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                        <span class="keywordflow">return</span> 2;</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                }</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;                ret = <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a5709f4818dc077b0d002f1a7f1854ca5">fat_getDirentryStartCluster</a>(fatd, tmpName, startCluster, fatDir);</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;                <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;                        <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: Exiting from fat_getFileStartCluster with error %i\n&quot;</span>, ret);</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;                        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                }</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: file&#39;s startCluster found. Name=%s, cluster=%u \n&quot;</span>, fname, *startCluster);</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        }</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: Exiting from fat_getFileStartCluster with no error.\n&quot;</span>);</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;}</div>
<div class="ttc" id="afs_2bdmfs__vfat_2src_2include_2fat__driver_8h_html_ad50209b5b697d61e976905db4a9a1964"><div class="ttname"><a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#ad50209b5b697d61e976905db4a9a1964">FAT_ATTR_DIRECTORY</a></div><div class="ttdeci">#define FAT_ATTR_DIRECTORY</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00016">fat_driver.h:16</a></div></div>
<div class="ttc" id="astructfat__dir_html"><div class="ttname"><a href="structfat__dir.html">fat_dir</a></div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00029">fat_driver.h:29</a></div></div>
<div class="ttc" id="astructfat__dir_html_aaba9fc8582badd71d8403274f8e65030"><div class="ttname"><a href="structfat__dir.html#aaba9fc8582badd71d8403274f8e65030">fat_dir::attr</a></div><div class="ttdeci">unsigned char attr</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00030">fat_driver.h:30</a></div></div>
<div class="ttc" id="asysclib_8h_html_ab8dce9c192324f0fd191fd5b85c7bb60"><div class="ttname"><a href="sysclib_8h.html#ab8dce9c192324f0fd191fd5b85c7bb60">memset</a></div><div class="ttdeci">void * memset(void *ptr, int c, size_t size)</div></div>
<div class="ttc" id="ausb_2usbhdfsd_2src_2fat__driver_8c_html_a5709f4818dc077b0d002f1a7f1854ca5"><div class="ttname"><a href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a5709f4818dc077b0d002f1a7f1854ca5">fat_getDirentryStartCluster</a></div><div class="ttdeci">static int fat_getDirentryStartCluster(fat_driver *fatd, char *dirName, unsigned int *startCluster, fat_dir *fatDir)</div><div class="ttdef"><b>Definition:</b> <a href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00599">fat_driver.c:599</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00030">fat_dir::attr</a>, <a class="el" href="errno_8h_source.html#l00022">ENOENT</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00016">FAT_ATTR_DIRECTORY</a>, <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00599">fat_getDirentryStartCluster()</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00009">FAT_MAX_NAME</a>, <a class="el" href="sysclib_8h.html#ab8dce9c192324f0fd191fd5b85c7bb60">memset()</a>, <a class="el" href="defs_8h_source.html#l00022">NULL</a>, and <a class="el" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h_source.html#l00008">XPRINTF</a>.</p>

</div>
</div>
<a id="a9fe6c9eb511c4a13a58cff64d7b7c317"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9fe6c9eb511c4a13a58cff64d7b7c317">&#9670;&nbsp;</a></span>fat_getFirstDirentry()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fat_getFirstDirentry </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfat__driver.html">fat_driver</a> *&#160;</td>
          <td class="paramname"><em>fatd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>dirName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfat__dir__list.html">fat_dir_list</a> *&#160;</td>
          <td class="paramname"><em>fatdlist</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfat__dir.html">fat_dir</a> *&#160;</td>
          <td class="paramname"><em>fatDir_host</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfat__dir.html">fat_dir</a> *&#160;</td>
          <td class="paramname"><em>fatDir</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00966">966</a> of file <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html">fat_driver.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;                                                                                                                               {</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;        <span class="keywordtype">int</span> ret;</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> startCluster = 0;</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160; </div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;        ret = <a class="code" href="fs_2bdmfs__vfat_2src_2fat__driver_8c.html#a44bbecfdac2bf504b9a992b24db27e5e">fat_getFileStartCluster</a>(fatd, dirName, &amp;startCluster, fatDir_host);</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;        <span class="keywordflow">if</span> (ret &lt; 0) { <span class="comment">//dir name not found</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;                <span class="keywordflow">return</span> -<a class="code" href="errno_8h.html#a03e689f378f643d16ea7537918528a48">ENOENT</a>;</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;        }</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;        <span class="comment">//check that direntry is directory</span></div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;        <span class="keywordflow">if</span> (!(fatDir_host-&gt;<a class="code" href="structfat__dir.html#aaba9fc8582badd71d8403274f8e65030">attr</a> &amp; <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#ad50209b5b697d61e976905db4a9a1964">FAT_ATTR_DIRECTORY</a>)) {</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;                <span class="keywordflow">return</span> -<a class="code" href="errno_8h.html#a9262fb92f7ef662d0bdd577912a5b101">ENOTDIR</a>; <span class="comment">//it&#39;s a file - exit</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;        }</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;        fatdlist-&gt;<a class="code" href="structfat__dir__list.html#a43ab8f2a2938c81af88f085d7fcbdaec">direntryCluster</a> = startCluster;</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;        fatdlist-&gt;<a class="code" href="structfat__dir__list.html#ab6b7d84ead9e7e77f0ba927fa135d2ee">direntryIndex</a> = 0;</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="fs_2bdmfs__vfat_2src_2fat__driver_8c.html#a153feaad587b7aea8176964d3ee5a1f2">fat_getNextDirentry</a>(fatd, fatdlist, fatDir);</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;}</div>
<div class="ttc" id="aerrno_8h_html_a9262fb92f7ef662d0bdd577912a5b101"><div class="ttname"><a href="errno_8h.html#a9262fb92f7ef662d0bdd577912a5b101">ENOTDIR</a></div><div class="ttdeci">#define ENOTDIR</div><div class="ttdef"><b>Definition:</b> <a href="errno_8h_source.html#l00058">errno.h:58</a></div></div>
<div class="ttc" id="afs_2bdmfs__vfat_2src_2fat__driver_8c_html_a153feaad587b7aea8176964d3ee5a1f2"><div class="ttname"><a href="fs_2bdmfs__vfat_2src_2fat__driver_8c.html#a153feaad587b7aea8176964d3ee5a1f2">fat_getNextDirentry</a></div><div class="ttdeci">int fat_getNextDirentry(fat_driver *fatd, fat_dir_list *fatdlist, fat_dir *fatDir)</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2fat__driver_8c_source.html#l00861">fat_driver.c:861</a></div></div>
<div class="ttc" id="afs_2bdmfs__vfat_2src_2fat__driver_8c_html_a44bbecfdac2bf504b9a992b24db27e5e"><div class="ttname"><a href="fs_2bdmfs__vfat_2src_2fat__driver_8c.html#a44bbecfdac2bf504b9a992b24db27e5e">fat_getFileStartCluster</a></div><div class="ttdeci">int fat_getFileStartCluster(fat_driver *fatd, const char *fname, unsigned int *startCluster, fat_dir *fatDir)</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2fat__driver_8c_source.html#l00702">fat_driver.c:702</a></div></div>
<div class="ttc" id="astructfat__dir__list_html_a43ab8f2a2938c81af88f085d7fcbdaec"><div class="ttname"><a href="structfat__dir__list.html#a43ab8f2a2938c81af88f085d7fcbdaec">fat_dir_list::direntryCluster</a></div><div class="ttdeci">unsigned int direntryCluster</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00020">fat_driver.h:20</a></div></div>
<div class="ttc" id="astructfat__dir__list_html_ab6b7d84ead9e7e77f0ba927fa135d2ee"><div class="ttname"><a href="structfat__dir__list.html#ab6b7d84ead9e7e77f0ba927fa135d2ee">fat_dir_list::direntryIndex</a></div><div class="ttdeci">int direntryIndex</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00021">fat_driver.h:21</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00030">fat_dir::attr</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00020">fat_dir_list::direntryCluster</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00021">fat_dir_list::direntryIndex</a>, <a class="el" href="errno_8h_source.html#l00022">ENOENT</a>, <a class="el" href="errno_8h_source.html#l00058">ENOTDIR</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00016">FAT_ATTR_DIRECTORY</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2fat__driver_8c_source.html#l00702">fat_getFileStartCluster()</a>, and <a class="el" href="fs_2bdmfs__vfat_2src_2fat__driver_8c_source.html#l00861">fat_getNextDirentry()</a>.</p>

</div>
</div>
<a id="a153feaad587b7aea8176964d3ee5a1f2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a153feaad587b7aea8176964d3ee5a1f2">&#9670;&nbsp;</a></span>fat_getNextDirentry()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fat_getNextDirentry </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfat__driver.html">fat_driver</a> *&#160;</td>
          <td class="paramname"><em>fatd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfat__dir__list.html">fat_dir_list</a> *&#160;</td>
          <td class="paramname"><em>fatdlist</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfat__dir.html">fat_dir</a> *&#160;</td>
          <td class="paramname"><em>fatDir</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00888">888</a> of file <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html">fat_driver.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;                                                                                   {</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        <a class="code" href="structfat__direntry__summary.html">fat_direntry_summary</a> dir;</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;        <span class="keywordtype">int</span> i, ret;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> startSector, dirSector, dirPos, dirCluster;</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> cont, new_entry;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;        <a class="code" href="structmass__dev.html">mass_dev</a>* mass_device = fatd-&gt;<a class="code" href="structfat__driver.html#aef714ddc28773eb0da5b91b99129834d">dev</a>;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160; </div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;        <span class="comment">//the getFirst function was not called</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        <span class="keywordflow">if</span> (fatdlist-&gt;<a class="code" href="structfat__dir__list.html#a43ab8f2a2938c81af88f085d7fcbdaec">direntryCluster</a> == 0xFFFFFFFF || fatDir == <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;                <span class="keywordflow">return</span> -<a class="code" href="errno_8h.html#a3f317946e043623f9d6b93dbf60e6316">EFAULT</a>;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;        }</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160; </div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        dirCluster = fatdlist-&gt;<a class="code" href="structfat__dir__list.html#a43ab8f2a2938c81af88f085d7fcbdaec">direntryCluster</a>;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160; </div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        <span class="comment">//clear name strings</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        dir.<a class="code" href="structfat__direntry__summary.html#a612974fb21a07051bdef981810d07efc">sname</a>[0] = 0;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        dir.<a class="code" href="structfat__direntry__summary.html#a731c27293c20abff15634b96aa625d8b">name</a>[0] = 0;</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160; </div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        ret = <a class="code" href="fs_2bdmfs__vfat_2src_2fat__driver_8c.html#a5c34f9c163f391dacbc7153385f5e0e0">fat_getDirentrySectorData</a>(fatd, &amp;dirCluster, &amp;startSector, &amp;dirSector);</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;                <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160; </div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: dirCluster=%u startSector=%u (%u) dirSector=%u \n&quot;</span>, dirCluster, startSector, startSector * mass_device-&gt;sectorSize, dirSector);</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160; </div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;        <span class="comment">//go through first directory sector till the max number of directory sectors</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        <span class="comment">//or stop when no more direntries detected</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;        <span class="comment">//dlanor: but avoid rescanning same areas redundantly (if possible)</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        cont = 1;</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        new_entry = 1;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        dirPos = (fatdlist-&gt;<a class="code" href="structfat__dir__list.html#ab6b7d84ead9e7e77f0ba927fa135d2ee">direntryIndex</a>*32) % fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#aec6b3ab436f1855028e3564a5755dd69">sectorSize</a>;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;        for (i = ((fatdlist-&gt;<a class="code" href="structfat__dir__list.html#ab6b7d84ead9e7e77f0ba927fa135d2ee">direntryIndex</a>*32) / fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#aec6b3ab436f1855028e3564a5755dd69">sectorSize</a>); (i &lt; dirSector) &amp;&amp; cont; i++) {</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;                <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* <a class="code" href="fs_2bdm_2src_2part__driver_8c.html#a6d4ae1f692b64a14d19895e323c7b853">sbuf</a> = <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; <span class="comment">//sector buffer</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160; </div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                <span class="comment">//At cluster borders, get correct sector from cluster chain buffer</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;                <span class="keywordflow">if</span> ((dirCluster != 0) &amp;&amp; (new_entry || (i % fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#a1cf892c4c80adcc3500ca90baab803b5">clusterSize</a> == 0))) {</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;                        startSector = <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat_8h.html#a7a0f69dcf37ca416800d90a7543e02ef">fat_cluster2sector</a>(&amp;fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>, fatd-&gt;<a class="code" href="structfat__driver.html#a62c4794e13845244b324409ebfb71919">cbuf</a>[(i / fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#a1cf892c4c80adcc3500ca90baab803b5">clusterSize</a>)])</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;                                -i + (i % fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#a1cf892c4c80adcc3500ca90baab803b5">clusterSize</a>);</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                        new_entry = 0;</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;                }</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                ret = <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ae328738f080a00611208ca42cb103e04">READ_SECTOR</a>(fatd-&gt;<a class="code" href="structfat__driver.html#aef714ddc28773eb0da5b91b99129834d">dev</a>, startSector + i, <a class="code" href="fs_2bdm_2src_2part__driver_8c.html#a6d4ae1f692b64a14d19895e323c7b853">sbuf</a>);</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;                <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;                        <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: Read directory  sector failed ! sector=%u\n&quot;</span>, startSector + i);</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;                        <span class="keywordflow">return</span> -<a class="code" href="errno_8h.html#a70979f50f9c83e5aebab3d6a1bd4cf35">EIO</a>;</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;                }</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160; </div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;                <span class="comment">// go through sector from current pos till its end</span></div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;                <span class="keywordflow">while</span> (cont &amp;&amp;  (dirPos &lt; fatd-&gt;partBpb.sectorSize)) {</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;                        <a class="code" href="unionfat__direntry.html">fat_direntry</a>* dir_entry = (<a class="code" href="unionfat__direntry.html">fat_direntry</a>*) (<a class="code" href="fs_2bdm_2src_2part__driver_8c.html#a6d4ae1f692b64a14d19895e323c7b853">sbuf</a> + dirPos);</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;                        cont = <a class="code" href="fs_2bdmfs__vfat_2src_2fat__driver_8c.html#a7bb176f7870759d9c493606e0241f900">fat_getDirentry</a>(fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#ab661c72fc95b56a3ca635b817d3af54b">fatType</a>, dir_entry, &amp;dir); <span class="comment">//get a directory entry from sector</span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;                        fatdlist-&gt;<a class="code" href="structfat__dir__list.html#ab6b7d84ead9e7e77f0ba927fa135d2ee">direntryIndex</a>++; <span class="comment">//Note current entry processed</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;                        <span class="keywordflow">if</span> (cont == 1) { <span class="comment">//when short file name entry detected</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;                                <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a201fa4870033ca4ecd729047edd05be4">fat_setFatDir</a>(fatd, fatDir, dirCluster, &amp;dir_entry-&gt;<a class="code" href="unionfat__direntry.html#ae848e0643536c9ec991ad7fdc183e855">sfn</a>, &amp;dir, 0);</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="preprocessor">#if 0</span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;                        <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: fat_getNextDirentry %c%c%c%c%c%c %x %s %s\n&quot;</span>,</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;                                (dir.<a class="code" href="structfat__direntry__summary.html#a47299e884846ba00bef7ec883483ff3a">attr</a> &amp; <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a3ce8e4822ed18e7e3dd92ea67aa8ffcf">FAT_ATTR_VOLUME_LABEL</a>) ? <span class="charliteral">&#39;v&#39;</span> : <span class="charliteral">&#39;-&#39;</span>,</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;                                (dir.<a class="code" href="structfat__direntry__summary.html#a47299e884846ba00bef7ec883483ff3a">attr</a> &amp; <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#ad50209b5b697d61e976905db4a9a1964">FAT_ATTR_DIRECTORY</a>) ? <span class="charliteral">&#39;d&#39;</span> : <span class="charliteral">&#39;-&#39;</span>,</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;                                (dir.<a class="code" href="structfat__direntry__summary.html#a47299e884846ba00bef7ec883483ff3a">attr</a> &amp; <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a7199c8123417884e88fc0165b49e6e37">FAT_ATTR_READONLY</a>) ? <span class="charliteral">&#39;r&#39;</span> : <span class="charliteral">&#39;-&#39;</span>,</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;                                (dir.<a class="code" href="structfat__direntry__summary.html#a47299e884846ba00bef7ec883483ff3a">attr</a> &amp; <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#ab54ffa4780ab4a1bb1d79d6db569c096">FAT_ATTR_ARCHIVE</a>) ? <span class="charliteral">&#39;a&#39;</span> : <span class="charliteral">&#39;-&#39;</span>,</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;                                (dir.<a class="code" href="structfat__direntry__summary.html#a47299e884846ba00bef7ec883483ff3a">attr</a> &amp; <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a5df5f5eb50b97d421d5df34b90cacf30">FAT_ATTR_SYSTEM</a>) ? <span class="charliteral">&#39;s&#39;</span> : <span class="charliteral">&#39;-&#39;</span>,</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;                                (dir.<a class="code" href="structfat__direntry__summary.html#a47299e884846ba00bef7ec883483ff3a">attr</a> &amp; <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a7417c17b6e1c3d6f9bcc6f84c125ccc1">FAT_ATTR_HIDDEN</a>) ? <span class="charliteral">&#39;h&#39;</span> : <span class="charliteral">&#39;-&#39;</span>,</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;                                dir.<a class="code" href="structfat__direntry__summary.html#a47299e884846ba00bef7ec883483ff3a">attr</a>,</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;                                dir.<a class="code" href="structfat__direntry__summary.html#a612974fb21a07051bdef981810d07efc">sname</a>,</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;                                dir.<a class="code" href="structfat__direntry__summary.html#a731c27293c20abff15634b96aa625d8b">name</a>);</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;                                <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;                        }</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;                        dirPos += <span class="keyword">sizeof</span>(<a class="code" href="unionfat__direntry.html">fat_direntry</a>);</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;                }<span class="comment">//ends &quot;while&quot;</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;                dirPos = 0;</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;        }<span class="comment">//ends &quot;for&quot;</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;        <span class="comment">// when we get this far - reset the direntry cluster</span></div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;        fatdlist-&gt;<a class="code" href="structfat__dir__list.html#a43ab8f2a2938c81af88f085d7fcbdaec">direntryCluster</a> = 0xFFFFFFFF; <span class="comment">//no more files</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;        <span class="keywordflow">return</span> 0; <span class="comment">//indicate that no direntry is avalable</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;}</div>
<div class="ttc" id="afs_2bdmfs__vfat_2src_2include_2fat__driver_8h_html_a5df5f5eb50b97d421d5df34b90cacf30"><div class="ttname"><a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a5df5f5eb50b97d421d5df34b90cacf30">FAT_ATTR_SYSTEM</a></div><div class="ttdeci">#define FAT_ATTR_SYSTEM</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00014">fat_driver.h:14</a></div></div>
<div class="ttc" id="afs_2bdmfs__vfat_2src_2include_2fat__driver_8h_html_a7199c8123417884e88fc0165b49e6e37"><div class="ttname"><a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a7199c8123417884e88fc0165b49e6e37">FAT_ATTR_READONLY</a></div><div class="ttdeci">#define FAT_ATTR_READONLY</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00012">fat_driver.h:12</a></div></div>
<div class="ttc" id="afs_2bdmfs__vfat_2src_2include_2fat__driver_8h_html_a7417c17b6e1c3d6f9bcc6f84c125ccc1"><div class="ttname"><a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a7417c17b6e1c3d6f9bcc6f84c125ccc1">FAT_ATTR_HIDDEN</a></div><div class="ttdeci">#define FAT_ATTR_HIDDEN</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00013">fat_driver.h:13</a></div></div>
<div class="ttc" id="afs_2bdmfs__vfat_2src_2include_2fat__driver_8h_html_ab54ffa4780ab4a1bb1d79d6db569c096"><div class="ttname"><a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#ab54ffa4780ab4a1bb1d79d6db569c096">FAT_ATTR_ARCHIVE</a></div><div class="ttdeci">#define FAT_ATTR_ARCHIVE</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00017">fat_driver.h:17</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00137">fat_direntry_summary::attr</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00072">fat_driver::cbuf</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00048">fat_bpb::clusterSize</a>, <a class="el" href="iLink_2IEEE1394__disk_2src_2include_2fat__driver_8h_source.html#l00036">fat_driver::dev</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00020">fat_dir_list::direntryCluster</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00021">fat_dir_list::direntryIndex</a>, <a class="el" href="errno_8h_source.html#l00046">EFAULT</a>, <a class="el" href="errno_8h_source.html#l00028">EIO</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00017">FAT_ATTR_ARCHIVE</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00016">FAT_ATTR_DIRECTORY</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00013">FAT_ATTR_HIDDEN</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00012">FAT_ATTR_READONLY</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00014">FAT_ATTR_SYSTEM</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00015">FAT_ATTR_VOLUME_LABEL</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00145">fat_cluster2sector()</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2fat__driver_8c_source.html#l00369">fat_getDirentry()</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2fat__driver_8c_source.html#l00602">fat_getDirentrySectorData()</a>, <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00513">fat_setFatDir()</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00060">fat_bpb::fatType</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00138">fat_direntry_summary::name</a>, <a class="el" href="defs_8h_source.html#l00022">NULL</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00068">fat_driver::partBpb</a>, <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00031">READ_SECTOR</a>, <a class="el" href="fs_2bdm_2src_2part__driver_8c_source.html#l00064">sbuf</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00047">fat_bpb::sectorSize</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00132">fat_direntry::sfn</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00139">fat_direntry_summary::sname</a>, and <a class="el" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h_source.html#l00008">XPRINTF</a>.</p>

</div>
</div>
<a id="a248495cc0e1147e1e467144b48f4d9b0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a248495cc0e1147e1e467144b48f4d9b0">&#9670;&nbsp;</a></span>fat_getPartitionBootSector()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int fat_getPartitionBootSector </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structmass__dev.html">mass_dev</a> *&#160;</td>
          <td class="paramname"><em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>sector</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfat__bpb.html">fat_bpb</a> *&#160;</td>
          <td class="paramname"><em>partBpb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00276">276</a> of file <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html">fat_driver.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                                                                                            {</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        <a class="code" href="structfat__raw__bpb.html">fat_raw_bpb</a>* bpb_raw; <span class="comment">//fat16, fat12</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        <a class="code" href="structfat32__raw__bpb.html">fat32_raw_bpb</a>* bpb32_raw; <span class="comment">//fat32</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <span class="keywordtype">int</span> ret;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* <a class="code" href="fs_2bdm_2src_2part__driver_8c.html#a6d4ae1f692b64a14d19895e323c7b853">sbuf</a> = <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; <span class="comment">//sector buffer</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160; </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        ret = <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ae328738f080a00611208ca42cb103e04">READ_SECTOR</a>(dev, sector, <a class="code" href="fs_2bdm_2src_2part__driver_8c.html#a6d4ae1f692b64a14d19895e323c7b853">sbuf</a>); <span class="comment">//read partition boot sector (first sector on partition)</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: Read partition boot sector failed sector=%u! \n&quot;</span>, sector);</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                <span class="keywordflow">return</span> -<a class="code" href="errno_8h.html#a70979f50f9c83e5aebab3d6a1bd4cf35">EIO</a>;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        }</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160; </div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        bpb_raw = (<a class="code" href="structfat__raw__bpb.html">fat_raw_bpb</a>*) <a class="code" href="fs_2bdm_2src_2part__driver_8c.html#a6d4ae1f692b64a14d19895e323c7b853">sbuf</a>;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        bpb32_raw = (<a class="code" href="structfat32__raw__bpb.html">fat32_raw_bpb</a>*) <a class="code" href="fs_2bdm_2src_2part__driver_8c.html#a6d4ae1f692b64a14d19895e323c7b853">sbuf</a>;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160; </div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <span class="comment">//set fat common properties</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        partBpb-&gt;<a class="code" href="structfat__bpb.html#aec6b3ab436f1855028e3564a5755dd69">sectorSize</a> = <a class="code" href="fs_2bdmfs__vfat_2src_2include_2common_8h.html#a98122f7798bea6dd7cb0862431e0408e">getI16</a>(bpb_raw-&gt;<a class="code" href="structfat__raw__bpb.html#a61678ce0dee578cb69adba3647d06917">sectorSize</a>);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        partBpb-&gt;<a class="code" href="structfat__bpb.html#a1cf892c4c80adcc3500ca90baab803b5">clusterSize</a> = bpb_raw-&gt;<a class="code" href="structfat__raw__bpb.html#aa4e19646ec2ac59a1e95ee8482ae7e8f">clusterSize</a>;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        partBpb-&gt;<a class="code" href="structfat__bpb.html#acee894d1cf546aabbd22b3a22f5cb7ca">resSectors</a> = <a class="code" href="fs_2bdmfs__vfat_2src_2include_2common_8h.html#a98122f7798bea6dd7cb0862431e0408e">getI16</a>(bpb_raw-&gt;<a class="code" href="structfat__raw__bpb.html#a3ffdfacee66df2cab605fb331bf49819">resSectors</a>);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        partBpb-&gt;<a class="code" href="structfat__bpb.html#a9030be9f8fd3ee8b29bd59652ffc6f51">fatCount</a> = bpb_raw-&gt;<a class="code" href="structfat__raw__bpb.html#a5e9ffe5c6da8a4ce1274d0194a7f56e8">fatCount</a>;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        partBpb-&gt;<a class="code" href="structfat__bpb.html#ad81080068bad0ff3fffe57049f39aee4">rootSize</a> = <a class="code" href="fs_2bdmfs__vfat_2src_2include_2common_8h.html#a98122f7798bea6dd7cb0862431e0408e">getI16</a>(bpb_raw-&gt;<a class="code" href="structfat__raw__bpb.html#a230b96cdf95865a8d5581d6744f487bd">rootSize</a>);</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        partBpb-&gt;<a class="code" href="structfat__bpb.html#a6cc5babb45910d4523f3cc238c5048d9">fatSize</a> = <a class="code" href="fs_2bdmfs__vfat_2src_2include_2common_8h.html#a98122f7798bea6dd7cb0862431e0408e">getI16</a>(bpb_raw-&gt;<a class="code" href="structfat__raw__bpb.html#a0f2ad56ab76bd1f15b31783dd5933e1f">fatSize</a>);</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        partBpb-&gt;<a class="code" href="structfat__bpb.html#aa0169f8e8ce90f1cf914da692f5338e2">trackSize</a> = <a class="code" href="fs_2bdmfs__vfat_2src_2include_2common_8h.html#a98122f7798bea6dd7cb0862431e0408e">getI16</a>(bpb_raw-&gt;<a class="code" href="structfat__raw__bpb.html#a6982107a492b341429828f13f68baa07">trackSize</a>);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        partBpb-&gt;<a class="code" href="structfat__bpb.html#a2f0550038498a638c8475efafefdf8d9">headCount</a> = <a class="code" href="fs_2bdmfs__vfat_2src_2include_2common_8h.html#a98122f7798bea6dd7cb0862431e0408e">getI16</a>(bpb_raw-&gt;<a class="code" href="structfat__raw__bpb.html#a8952283fa60f90a7a5f6a883764e23b3">headCount</a>);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        partBpb-&gt;<a class="code" href="structfat__bpb.html#a267bd7a9fd462c45f3c44e0bbb72fc55">sectorCount</a> = <a class="code" href="fs_2bdmfs__vfat_2src_2include_2common_8h.html#a98122f7798bea6dd7cb0862431e0408e">getI16</a>(bpb_raw-&gt;<a class="code" href="structfat__raw__bpb.html#a571d86ac41aa37ef5d0bb852a630b9f9">sectorCountO</a>);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        <span class="keywordflow">if</span> (partBpb-&gt;<a class="code" href="structfat__bpb.html#a267bd7a9fd462c45f3c44e0bbb72fc55">sectorCount</a> == 0) {</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                partBpb-&gt;<a class="code" href="structfat__bpb.html#a267bd7a9fd462c45f3c44e0bbb72fc55">sectorCount</a> = <a class="code" href="fs_2bdm_2src_2part__driver_8c.html#acdf30bdc458302252ad1c28906727cbd">getI32</a>(bpb_raw-&gt;<a class="code" href="structfat__raw__bpb.html#a43cf5114da75b101b3cfeeb08e68337c">sectorCount</a>); <span class="comment">// large partition</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        }</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        partBpb-&gt;<a class="code" href="structfat__bpb.html#aec22fd0c89773a54180c3a5b3038e131">partStart</a> = sector;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        partBpb-&gt;<a class="code" href="structfat__bpb.html#acfc55af344e0b4d42e691e9dfa729668">rootDirStart</a> = partBpb-&gt;<a class="code" href="structfat__bpb.html#aec22fd0c89773a54180c3a5b3038e131">partStart</a> + (partBpb-&gt;<a class="code" href="structfat__bpb.html#a9030be9f8fd3ee8b29bd59652ffc6f51">fatCount</a> * partBpb-&gt;<a class="code" href="structfat__bpb.html#a6cc5babb45910d4523f3cc238c5048d9">fatSize</a>) + partBpb-&gt;<a class="code" href="structfat__bpb.html#acee894d1cf546aabbd22b3a22f5cb7ca">resSectors</a>;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        for (ret = 0; ret &lt; 8; ret++) {</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                partBpb-&gt;<a class="code" href="structfat__bpb.html#a9c74b228f914bbfc26e7f46df0f7fb74">fatId</a>[ret] = bpb_raw-&gt;<a class="code" href="structfat__raw__bpb.html#a6442ca1f41925f5d74c6f9b65fb96651">fatId</a>[ret];</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        }</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        partBpb-&gt;<a class="code" href="structfat__bpb.html#a9c74b228f914bbfc26e7f46df0f7fb74">fatId</a>[ret] = 0;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        partBpb-&gt;<a class="code" href="structfat__bpb.html#a44140339beb655a17e59b51e8405a862">rootDirCluster</a> = 0;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        partBpb-&gt;<a class="code" href="structfat__bpb.html#a2bcf6660ce624990ed0325b4bf235042">dataStart</a> = partBpb-&gt;<a class="code" href="structfat__bpb.html#acfc55af344e0b4d42e691e9dfa729668">rootDirStart</a> + (partBpb-&gt;<a class="code" href="structfat__bpb.html#ad81080068bad0ff3fffe57049f39aee4">rootSize</a> / (partBpb-&gt;<a class="code" href="structfat__bpb.html#aec6b3ab436f1855028e3564a5755dd69">sectorSize</a> &gt;&gt; 5));</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160; </div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#afa59206758be763177011abe1f87dc65">fat_determineFatType</a>(partBpb);</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160; </div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <span class="comment">//fat32 specific info</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        <span class="keywordflow">if</span> (partBpb-&gt;<a class="code" href="structfat__bpb.html#ab661c72fc95b56a3ca635b817d3af54b">fatType</a> == <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat_8h.html#a51cfb551f0270354f9115893b7f4339f">FAT32</a> &amp;&amp; partBpb-&gt;<a class="code" href="structfat__bpb.html#a6cc5babb45910d4523f3cc238c5048d9">fatSize</a> == 0) {</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                partBpb-&gt;<a class="code" href="structfat__bpb.html#a6cc5babb45910d4523f3cc238c5048d9">fatSize</a> = <a class="code" href="fs_2bdm_2src_2part__driver_8c.html#acdf30bdc458302252ad1c28906727cbd">getI32</a>(bpb32_raw-&gt;<a class="code" href="structfat32__raw__bpb.html#ab492e6c64eacc8cc350f930db00822d4">fatSize32</a>);</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                partBpb-&gt;<a class="code" href="structfat__bpb.html#ac572a17a150223d21a5260a45e9a9c6a">activeFat</a> = <a class="code" href="fs_2bdmfs__vfat_2src_2include_2common_8h.html#a98122f7798bea6dd7cb0862431e0408e">getI16</a>(bpb32_raw-&gt;<a class="code" href="structfat32__raw__bpb.html#a63bbf482af79d68acbedf2b9bcc5b5d5">fatStatus</a>);</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                <span class="keywordflow">if</span> (partBpb-&gt;<a class="code" href="structfat__bpb.html#ac572a17a150223d21a5260a45e9a9c6a">activeFat</a> &amp; 0x80) { <span class="comment">//fat not synced</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                        partBpb-&gt;<a class="code" href="structfat__bpb.html#ac572a17a150223d21a5260a45e9a9c6a">activeFat</a> = (partBpb-&gt;<a class="code" href="structfat__bpb.html#ac572a17a150223d21a5260a45e9a9c6a">activeFat</a> &amp; 0xF);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                        partBpb-&gt;<a class="code" href="structfat__bpb.html#ac572a17a150223d21a5260a45e9a9c6a">activeFat</a> = 0;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                }</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                partBpb-&gt;<a class="code" href="structfat__bpb.html#acfc55af344e0b4d42e691e9dfa729668">rootDirStart</a> = partBpb-&gt;<a class="code" href="structfat__bpb.html#aec22fd0c89773a54180c3a5b3038e131">partStart</a> + (partBpb-&gt;<a class="code" href="structfat__bpb.html#a9030be9f8fd3ee8b29bd59652ffc6f51">fatCount</a> * partBpb-&gt;<a class="code" href="structfat__bpb.html#a6cc5babb45910d4523f3cc238c5048d9">fatSize</a>) + partBpb-&gt;<a class="code" href="structfat__bpb.html#acee894d1cf546aabbd22b3a22f5cb7ca">resSectors</a>;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                partBpb-&gt;<a class="code" href="structfat__bpb.html#a44140339beb655a17e59b51e8405a862">rootDirCluster</a> = <a class="code" href="fs_2bdm_2src_2part__driver_8c.html#acdf30bdc458302252ad1c28906727cbd">getI32</a>(bpb32_raw-&gt;<a class="code" href="structfat32__raw__bpb.html#a95cfa5106186843c4d802eb8218a249b">rootDirCluster</a>);</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                <span class="keywordflow">for</span> (ret = 0; ret &lt; 8; ret++) {</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                        partBpb-&gt;<a class="code" href="structfat__bpb.html#a9c74b228f914bbfc26e7f46df0f7fb74">fatId</a>[ret] = bpb32_raw-&gt;<a class="code" href="structfat32__raw__bpb.html#a8065cbb69f470cb2fa464fbc61fb77ea">fatId</a>[ret];</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                }</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                partBpb-&gt;<a class="code" href="structfat__bpb.html#a9c74b228f914bbfc26e7f46df0f7fb74">fatId</a>[ret] = 0;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                partBpb-&gt;<a class="code" href="structfat__bpb.html#a2bcf6660ce624990ed0325b4bf235042">dataStart</a> = partBpb-&gt;<a class="code" href="structfat__bpb.html#acfc55af344e0b4d42e691e9dfa729668">rootDirStart</a>;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        }</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160; </div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <a class="code" href="stdio_8h.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;USBHDFSD: Fat type %u Id %s \n&quot;</span>, partBpb-&gt;<a class="code" href="structfat__bpb.html#ab661c72fc95b56a3ca635b817d3af54b">fatType</a>, partBpb-&gt;<a class="code" href="structfat__bpb.html#a9c74b228f914bbfc26e7f46df0f7fb74">fatId</a>);</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;}</div>
<div class="ttc" id="astdio_8h_html_a98631211a4a8aee62f572375d5b637be"><div class="ttname"><a href="stdio_8h.html#a98631211a4a8aee62f572375d5b637be">printf</a></div><div class="ttdeci">int printf(const char *format,...)</div></div>
<div class="ttc" id="astructfat32__raw__bpb_html"><div class="ttname"><a href="structfat32__raw__bpb.html">fat32_raw_bpb</a></div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00057">fat.h:57</a></div></div>
<div class="ttc" id="astructfat32__raw__bpb_html_a63bbf482af79d68acbedf2b9bcc5b5d5"><div class="ttname"><a href="structfat32__raw__bpb.html#a63bbf482af79d68acbedf2b9bcc5b5d5">fat32_raw_bpb::fatStatus</a></div><div class="ttdeci">unsigned char fatStatus[2]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00077">fat.h:77</a></div></div>
<div class="ttc" id="astructfat32__raw__bpb_html_a8065cbb69f470cb2fa464fbc61fb77ea"><div class="ttname"><a href="structfat32__raw__bpb.html#a8065cbb69f470cb2fa464fbc61fb77ea">fat32_raw_bpb::fatId</a></div><div class="ttdeci">unsigned char fatId[8]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00090">fat.h:90</a></div></div>
<div class="ttc" id="astructfat32__raw__bpb_html_a95cfa5106186843c4d802eb8218a249b"><div class="ttname"><a href="structfat32__raw__bpb.html#a95cfa5106186843c4d802eb8218a249b">fat32_raw_bpb::rootDirCluster</a></div><div class="ttdeci">unsigned char rootDirCluster[4]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00080">fat.h:80</a></div></div>
<div class="ttc" id="astructfat32__raw__bpb_html_ab492e6c64eacc8cc350f930db00822d4"><div class="ttname"><a href="structfat32__raw__bpb.html#ab492e6c64eacc8cc350f930db00822d4">fat32_raw_bpb::fatSize32</a></div><div class="ttdeci">unsigned char fatSize32[4]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00076">fat.h:76</a></div></div>
<div class="ttc" id="astructfat__bpb_html_a2bcf6660ce624990ed0325b4bf235042"><div class="ttname"><a href="structfat__bpb.html#a2bcf6660ce624990ed0325b4bf235042">fat_bpb::dataStart</a></div><div class="ttdeci">unsigned int dataStart</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00062">fat_driver.h:62</a></div></div>
<div class="ttc" id="astructfat__bpb_html_a2f0550038498a638c8475efafefdf8d9"><div class="ttname"><a href="structfat__bpb.html#a2f0550038498a638c8475efafefdf8d9">fat_bpb::headCount</a></div><div class="ttdeci">unsigned int headCount</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00054">fat_driver.h:54</a></div></div>
<div class="ttc" id="astructfat__bpb_html_a6cc5babb45910d4523f3cc238c5048d9"><div class="ttname"><a href="structfat__bpb.html#a6cc5babb45910d4523f3cc238c5048d9">fat_bpb::fatSize</a></div><div class="ttdeci">unsigned int fatSize</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00052">fat_driver.h:52</a></div></div>
<div class="ttc" id="astructfat__bpb_html_a9030be9f8fd3ee8b29bd59652ffc6f51"><div class="ttname"><a href="structfat__bpb.html#a9030be9f8fd3ee8b29bd59652ffc6f51">fat_bpb::fatCount</a></div><div class="ttdeci">unsigned char fatCount</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00050">fat_driver.h:50</a></div></div>
<div class="ttc" id="astructfat__bpb_html_a9c74b228f914bbfc26e7f46df0f7fb74"><div class="ttname"><a href="structfat__bpb.html#a9c74b228f914bbfc26e7f46df0f7fb74">fat_bpb::fatId</a></div><div class="ttdeci">unsigned char fatId[9]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00061">fat_driver.h:61</a></div></div>
<div class="ttc" id="astructfat__bpb_html_aa0169f8e8ce90f1cf914da692f5338e2"><div class="ttname"><a href="structfat__bpb.html#aa0169f8e8ce90f1cf914da692f5338e2">fat_bpb::trackSize</a></div><div class="ttdeci">unsigned int trackSize</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00053">fat_driver.h:53</a></div></div>
<div class="ttc" id="astructfat__bpb_html_ac572a17a150223d21a5260a45e9a9c6a"><div class="ttname"><a href="structfat__bpb.html#ac572a17a150223d21a5260a45e9a9c6a">fat_bpb::activeFat</a></div><div class="ttdeci">unsigned int activeFat</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00059">fat_driver.h:59</a></div></div>
<div class="ttc" id="astructfat__raw__bpb_html"><div class="ttname"><a href="structfat__raw__bpb.html">fat_raw_bpb</a></div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00028">fat.h:28</a></div></div>
<div class="ttc" id="astructfat__raw__bpb_html_a0f2ad56ab76bd1f15b31783dd5933e1f"><div class="ttname"><a href="structfat__raw__bpb.html#a0f2ad56ab76bd1f15b31783dd5933e1f">fat_raw_bpb::fatSize</a></div><div class="ttdeci">unsigned char fatSize[2]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00038">fat.h:38</a></div></div>
<div class="ttc" id="astructfat__raw__bpb_html_a230b96cdf95865a8d5581d6744f487bd"><div class="ttname"><a href="structfat__raw__bpb.html#a230b96cdf95865a8d5581d6744f487bd">fat_raw_bpb::rootSize</a></div><div class="ttdeci">unsigned char rootSize[2]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00035">fat.h:35</a></div></div>
<div class="ttc" id="astructfat__raw__bpb_html_a3ffdfacee66df2cab605fb331bf49819"><div class="ttname"><a href="structfat__raw__bpb.html#a3ffdfacee66df2cab605fb331bf49819">fat_raw_bpb::resSectors</a></div><div class="ttdeci">unsigned char resSectors[2]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00033">fat.h:33</a></div></div>
<div class="ttc" id="astructfat__raw__bpb_html_a43cf5114da75b101b3cfeeb08e68337c"><div class="ttname"><a href="structfat__raw__bpb.html#a43cf5114da75b101b3cfeeb08e68337c">fat_raw_bpb::sectorCount</a></div><div class="ttdeci">unsigned char sectorCount[4]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00044">fat.h:44</a></div></div>
<div class="ttc" id="astructfat__raw__bpb_html_a571d86ac41aa37ef5d0bb852a630b9f9"><div class="ttname"><a href="structfat__raw__bpb.html#a571d86ac41aa37ef5d0bb852a630b9f9">fat_raw_bpb::sectorCountO</a></div><div class="ttdeci">unsigned char sectorCountO[2]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00036">fat.h:36</a></div></div>
<div class="ttc" id="astructfat__raw__bpb_html_a5e9ffe5c6da8a4ce1274d0194a7f56e8"><div class="ttname"><a href="structfat__raw__bpb.html#a5e9ffe5c6da8a4ce1274d0194a7f56e8">fat_raw_bpb::fatCount</a></div><div class="ttdeci">unsigned char fatCount</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00034">fat.h:34</a></div></div>
<div class="ttc" id="astructfat__raw__bpb_html_a61678ce0dee578cb69adba3647d06917"><div class="ttname"><a href="structfat__raw__bpb.html#a61678ce0dee578cb69adba3647d06917">fat_raw_bpb::sectorSize</a></div><div class="ttdeci">unsigned char sectorSize[2]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00031">fat.h:31</a></div></div>
<div class="ttc" id="astructfat__raw__bpb_html_a6442ca1f41925f5d74c6f9b65fb96651"><div class="ttname"><a href="structfat__raw__bpb.html#a6442ca1f41925f5d74c6f9b65fb96651">fat_raw_bpb::fatId</a></div><div class="ttdeci">unsigned char fatId[8]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00053">fat.h:53</a></div></div>
<div class="ttc" id="astructfat__raw__bpb_html_a6982107a492b341429828f13f68baa07"><div class="ttname"><a href="structfat__raw__bpb.html#a6982107a492b341429828f13f68baa07">fat_raw_bpb::trackSize</a></div><div class="ttdeci">unsigned char trackSize[2]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00039">fat.h:39</a></div></div>
<div class="ttc" id="astructfat__raw__bpb_html_a8952283fa60f90a7a5f6a883764e23b3"><div class="ttname"><a href="structfat__raw__bpb.html#a8952283fa60f90a7a5f6a883764e23b3">fat_raw_bpb::headCount</a></div><div class="ttdeci">unsigned char headCount[2]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00040">fat.h:40</a></div></div>
<div class="ttc" id="astructfat__raw__bpb_html_aa4e19646ec2ac59a1e95ee8482ae7e8f"><div class="ttname"><a href="structfat__raw__bpb.html#aa4e19646ec2ac59a1e95ee8482ae7e8f">fat_raw_bpb::clusterSize</a></div><div class="ttdeci">unsigned char clusterSize</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00032">fat.h:32</a></div></div>
<div class="ttc" id="ausb_2usbhdfsd_2src_2fat__driver_8c_html_afa59206758be763177011abe1f87dc65"><div class="ttname"><a href="usb_2usbhdfsd_2src_2fat__driver_8c.html#afa59206758be763177011abe1f87dc65">fat_determineFatType</a></div><div class="ttdeci">static void fat_determineFatType(fat_bpb *partBpb)</div><div class="ttdef"><b>Definition:</b> <a href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00254">fat_driver.c:254</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00059">fat_bpb::activeFat</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00032">fat_raw_bpb::clusterSize</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00048">fat_bpb::clusterSize</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00062">fat_bpb::dataStart</a>, <a class="el" href="errno_8h_source.html#l00028">EIO</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00023">FAT32</a>, <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00254">fat_determineFatType()</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00034">fat_raw_bpb::fatCount</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00050">fat_bpb::fatCount</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00053">fat_raw_bpb::fatId</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00090">fat32_raw_bpb::fatId</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00061">fat_bpb::fatId</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00038">fat_raw_bpb::fatSize</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00052">fat_bpb::fatSize</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00076">fat32_raw_bpb::fatSize32</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00077">fat32_raw_bpb::fatStatus</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00060">fat_bpb::fatType</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2common_8h_source.html#l00016">getI16</a>, <a class="el" href="fs_2bdm_2src_2part__driver_8c_source.html#l00009">getI32</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00040">fat_raw_bpb::headCount</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00054">fat_bpb::headCount</a>, <a class="el" href="defs_8h_source.html#l00022">NULL</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00056">fat_bpb::partStart</a>, <a class="el" href="stdio_8h.html#a98631211a4a8aee62f572375d5b637be">printf()</a>, <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00031">READ_SECTOR</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00033">fat_raw_bpb::resSectors</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00049">fat_bpb::resSectors</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00080">fat32_raw_bpb::rootDirCluster</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00058">fat_bpb::rootDirCluster</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00057">fat_bpb::rootDirStart</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00035">fat_raw_bpb::rootSize</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00051">fat_bpb::rootSize</a>, <a class="el" href="fs_2bdm_2src_2part__driver_8c_source.html#l00064">sbuf</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00044">fat_raw_bpb::sectorCount</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00055">fat_bpb::sectorCount</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00036">fat_raw_bpb::sectorCountO</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00031">fat_raw_bpb::sectorSize</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00047">fat_bpb::sectorSize</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00039">fat_raw_bpb::trackSize</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00053">fat_bpb::trackSize</a>, and <a class="el" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h_source.html#l00008">XPRINTF</a>.</p>

<p class="reference">Referenced by <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00984">fat_mount()</a>.</p>

</div>
</div>
<a id="a15a7997a7342fca98bca9a4fcd7264a3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a15a7997a7342fca98bca9a4fcd7264a3">&#9670;&nbsp;</a></span>fat_invalidateLastChainResult()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fat_invalidateLastChainResult </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfat__driver.html">fat_driver</a> *&#160;</td>
          <td class="paramname"><em>fatd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00248">248</a> of file <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html">fat_driver.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;{</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        fatd-&gt;<a class="code" href="structfat__driver.html#a438f62db8e07453da4c89443cd369e97">lastChainCluster</a>  = 0;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00074">fat_driver::lastChainCluster</a>.</p>

</div>
</div>
<a id="aae1f0a2e4d5c649fe777ea081e780cc9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aae1f0a2e4d5c649fe777ea081e780cc9">&#9670;&nbsp;</a></span>fat_mount()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fat_mount </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structmass__dev.html">mass_dev</a> *&#160;</td>
          <td class="paramname"><em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>count</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00984">984</a> of file <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html">fat_driver.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;{</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        <a class="code" href="structfat__driver.html">fat_driver</a>* fatd = <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;        <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a2328493203f8da0a985673e0a369f196">NUM_DRIVES</a> &amp;&amp; fatd == <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; ++i)</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;        {</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ad8fbcb13516683f060e6e83e33b046ee">g_fatd</a>[i] == <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;                {</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;                        <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: usb fat: allocate fat_driver %d!\n&quot;</span>, <span class="keyword">sizeof</span>(<a class="code" href="structfat__driver.html">fat_driver</a>));</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;                        <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ad8fbcb13516683f060e6e83e33b046ee">g_fatd</a>[i] = <a class="code" href="AHX_8c.html#a2eb0b03d1a9de9615a291b1205969069">malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structfat__driver.html">fat_driver</a>));</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;                        <span class="keywordflow">if</span> (<a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ad8fbcb13516683f060e6e83e33b046ee">g_fatd</a>[i] != <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;                        {</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;                                <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ad8fbcb13516683f060e6e83e33b046ee">g_fatd</a>[i]-&gt;<a class="code" href="structfat__driver.html#aef714ddc28773eb0da5b91b99129834d">dev</a> = <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;                        }</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;                        fatd = <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ad8fbcb13516683f060e6e83e33b046ee">g_fatd</a>[i];</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;                }</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ad8fbcb13516683f060e6e83e33b046ee">g_fatd</a>[i]-&gt;dev == <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;                {</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;                        fatd = <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ad8fbcb13516683f060e6e83e33b046ee">g_fatd</a>[i];</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;                }</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;        }</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160; </div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;        <span class="keywordflow">if</span> (fatd == <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        {</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;                <a class="code" href="stdio_8h.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;USBHDFSD: usb fat: unable to allocate drive!\n&quot;</span>);</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;                <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;        }</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160; </div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;        <span class="keywordflow">if</span> (fatd-&gt;dev != <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        {</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;                <a class="code" href="stdio_8h.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;USBHDFSD: usb fat: mount ERROR: alread mounted\n&quot;</span>);</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;                <a class="code" href="fs_2bdmfs__vfat_2src_2fat__driver_8c.html#a2541aa2d23ecfadf0e4850e6fa245ed7">fat_forceUnmount</a>(fatd-&gt;dev);</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        }</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160; </div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a248495cc0e1147e1e467144b48f4d9b0">fat_getPartitionBootSector</a>(dev, start, &amp;fatd-&gt;partBpb) &lt; 0)</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;                <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160; </div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;        fatd-&gt;dev = dev;</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;        fatd-&gt;deIdx = 0;</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;        fatd-&gt;clStackIndex = 0;</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;        fatd-&gt;clStackLast = 0;</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;        fatd-&gt;lastChainCluster = 0xFFFFFFFF;</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;        fatd-&gt;lastChainResult = -1;</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;}</div>
<div class="ttc" id="aAHX_8c_html_a2eb0b03d1a9de9615a291b1205969069"><div class="ttname"><a href="AHX_8c.html#a2eb0b03d1a9de9615a291b1205969069">malloc</a></div><div class="ttdeci">#define malloc(size)</div><div class="ttdef"><b>Definition:</b> <a href="AHX_8c_source.html#l00019">AHX.c:19</a></div></div>
<div class="ttc" id="afs_2bdmfs__vfat_2src_2fat__driver_8c_html_a2541aa2d23ecfadf0e4850e6fa245ed7"><div class="ttname"><a href="fs_2bdmfs__vfat_2src_2fat__driver_8c.html#a2541aa2d23ecfadf0e4850e6fa245ed7">fat_forceUnmount</a></div><div class="ttdeci">void fat_forceUnmount(struct block_device *bd)</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2fat__driver_8c_source.html#l01016">fat_driver.c:1016</a></div></div>
<div class="ttc" id="astructfat__driver_html"><div class="ttname"><a href="structfat__driver.html">fat_driver</a></div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00065">fat_driver.h:65</a></div></div>
<div class="ttc" id="ausb_2usbhdfsd_2src_2fat__driver_8c_html_a248495cc0e1147e1e467144b48f4d9b0"><div class="ttname"><a href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a248495cc0e1147e1e467144b48f4d9b0">fat_getPartitionBootSector</a></div><div class="ttdeci">static int fat_getPartitionBootSector(mass_dev *dev, unsigned int sector, fat_bpb *partBpb)</div><div class="ttdef"><b>Definition:</b> <a href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00276">fat_driver.c:276</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00090">fat_driver::clStackIndex</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00091">fat_driver::clStackLast</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00081">fat_driver::deIdx</a>, <a class="el" href="iLink_2IEEE1394__disk_2src_2include_2fat__driver_8h_source.html#l00036">fat_driver::dev</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2fat__driver_8c_source.html#l01016">fat_forceUnmount()</a>, <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00276">fat_getPartitionBootSector()</a>, <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00036">g_fatd</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00074">fat_driver::lastChainCluster</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00075">fat_driver::lastChainResult</a>, <a class="el" href="AHX_8c_source.html#l00019">malloc</a>, <a class="el" href="defs_8h_source.html#l00022">NULL</a>, <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00035">NUM_DRIVES</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00068">fat_driver::partBpb</a>, <a class="el" href="stdio_8h.html#a98631211a4a8aee62f572375d5b637be">printf()</a>, and <a class="el" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h_source.html#l00008">XPRINTF</a>.</p>

</div>
</div>
<a id="afe0ccd4a806f80183e8443df087b8f00"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afe0ccd4a806f80183e8443df087b8f00">&#9670;&nbsp;</a></span>fat_readFile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fat_readFile </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfat__driver.html">fat_driver</a> *&#160;</td>
          <td class="paramname"><em>fatd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfat__dir.html">fat_dir</a> *&#160;</td>
          <td class="paramname"><em>fatDir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>filePos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00755">755</a> of file <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html">fat_driver.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;                                                                                                                    {</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        <span class="keywordtype">int</span> ret, chainSize;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, j, startSector, clusterChainStart, bufSize, sectorSkip, clusterSkip, dataSkip, toRead;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> nextChain;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        <a class="code" href="structmass__dev.html">mass_dev</a>* mass_device = fatd-&gt;<a class="code" href="structfat__driver.html#aef714ddc28773eb0da5b91b99129834d">dev</a>;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160; </div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bufferPos, fileCluster, clusterPos;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160; </div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        <a class="code" href="fs_2bdmfs__vfat_2src_2fat__driver_8c.html#a2132295b8b12475793629fcf9ae3f665">fat_getClusterAtFilePos</a>(fatd, fatDir, filePos, &amp;fileCluster, &amp;clusterPos);</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;        sectorSkip = (filePos - clusterPos) / fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#aec6b3ab436f1855028e3564a5755dd69">sectorSize</a>;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        clusterSkip = sectorSkip / fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#a1cf892c4c80adcc3500ca90baab803b5">clusterSize</a>;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        sectorSkip %= fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#a1cf892c4c80adcc3500ca90baab803b5">clusterSize</a>;</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        dataSkip  = filePos  % fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#aec6b3ab436f1855028e3564a5755dd69">sectorSize</a>;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        bufferPos = 0;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160; </div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: fileCluster = %u,  clusterPos= %u clusterSkip=%u, sectorSkip=%u dataSkip=%u \n&quot;</span>,</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;                fileCluster, clusterPos, clusterSkip, sectorSkip, dataSkip);</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160; </div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        <span class="keywordflow">if</span> (fileCluster &lt; 2) {</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;                <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        }</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160; </div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        nextChain = 1;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        clusterChainStart = 1;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160; </div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        <span class="keywordflow">while</span> (nextChain &amp;&amp; size &gt; 0 ) {</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;                <span class="keywordflow">if</span>((chainSize = <a class="code" href="fs_2bdmfs__vfat_2src_2fat__driver_8c.html#a04f7d3056137a9a46fa5735e8a38f730">fat_getClusterChain</a>(fatd, fileCluster, fatd-&gt;<a class="code" href="structfat__driver.html#a62c4794e13845244b324409ebfb71919">cbuf</a>, <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a8f3ada716b434a6f52c4cfbb919d3be4">MAX_DIR_CLUSTER</a>, clusterChainStart))&lt;0){</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;                        <span class="keywordflow">return</span> chainSize;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;                }</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160; </div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;                clusterChainStart = 0;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;                <span class="keywordflow">if</span> (chainSize &gt;= <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a8f3ada716b434a6f52c4cfbb919d3be4">MAX_DIR_CLUSTER</a>) { <span class="comment">//the chain is full, but more chain parts exist</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;                        fileCluster = fatd-&gt;<a class="code" href="structfat__driver.html#a62c4794e13845244b324409ebfb71919">cbuf</a>[<a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a8f3ada716b434a6f52c4cfbb919d3be4">MAX_DIR_CLUSTER</a> - 1];</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;                }<span class="keywordflow">else</span> { <span class="comment">//chain fits in the chain buffer completely - no next chain needed</span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;                        nextChain = 0;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;                }</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;                <span class="keywordflow">while</span> (clusterSkip &gt;= <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a8f3ada716b434a6f52c4cfbb919d3be4">MAX_DIR_CLUSTER</a>) {</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;                        chainSize = <a class="code" href="fs_2bdmfs__vfat_2src_2fat__driver_8c.html#a04f7d3056137a9a46fa5735e8a38f730">fat_getClusterChain</a>(fatd, fileCluster, fatd-&gt;<a class="code" href="structfat__driver.html#a62c4794e13845244b324409ebfb71919">cbuf</a>, <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a8f3ada716b434a6f52c4cfbb919d3be4">MAX_DIR_CLUSTER</a>, clusterChainStart);</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;                        clusterChainStart = 0;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;                        <span class="keywordflow">if</span> (chainSize &gt;= <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a8f3ada716b434a6f52c4cfbb919d3be4">MAX_DIR_CLUSTER</a>) { <span class="comment">//the chain is full, but more chain parts exist</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;                                fileCluster = fatd-&gt;<a class="code" href="structfat__driver.html#a62c4794e13845244b324409ebfb71919">cbuf</a>[<a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a8f3ada716b434a6f52c4cfbb919d3be4">MAX_DIR_CLUSTER</a> - 1];</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;                        }<span class="keywordflow">else</span> { <span class="comment">//chain fits in the chain buffer completely - no next chain needed</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;                                nextChain = 0;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;                        }</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;                        clusterSkip -= <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a8f3ada716b434a6f52c4cfbb919d3be4">MAX_DIR_CLUSTER</a>;</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;                }</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160; </div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;                <span class="comment">//process the cluster chain (fatd-&gt;cbuf) and skip leading clusters if needed</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;                <span class="keywordflow">for</span> (i = 0 + clusterSkip; i &lt; chainSize &amp;&amp; size &gt; 0; i++) {</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;                        <span class="comment">//read cluster and save cluster content</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;                        startSector = <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat_8h.html#a7a0f69dcf37ca416800d90a7543e02ef">fat_cluster2sector</a>(&amp;fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>, fatd-&gt;<a class="code" href="structfat__driver.html#a62c4794e13845244b324409ebfb71919">cbuf</a>[i]);</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160; </div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;                        <span class="comment">//Calculate how long we can continuously read for.</span></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;                        j = (size + dataSkip) / fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#aec6b3ab436f1855028e3564a5755dd69">sectorSize</a> + sectorSkip;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;                        toRead = 0;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;                        while (1) {</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                                <span class="keywordflow">if</span>(j &gt;= fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#a1cf892c4c80adcc3500ca90baab803b5">clusterSize</a>)</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;                                {</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;                                        toRead += fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#a1cf892c4c80adcc3500ca90baab803b5">clusterSize</a>;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;                                        j -= fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#a1cf892c4c80adcc3500ca90baab803b5">clusterSize</a>;</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;                                }</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;                                {</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;                                        toRead += j;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                                        j = 0;</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                                }</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160; </div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                                <span class="comment">//Check that the next cluster is adjacent to this one, so we can read across.</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                                <span class="keywordflow">if</span> ((i &gt;= chainSize - 1) || (fatd-&gt;<a class="code" href="structfat__driver.html#a62c4794e13845244b324409ebfb71919">cbuf</a>[i] != (fatd-&gt;<a class="code" href="structfat__driver.html#a62c4794e13845244b324409ebfb71919">cbuf</a>[i+1]-1)))</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;                                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;                                <span class="keywordflow">if</span> (j == 0)</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;                                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;                                i++; <span class="comment">//Advance to the next cluster.</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;                        }</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160; </div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;                        <span class="comment">//Consider the number of sectors within the cluster to skip.</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;                        startSector += sectorSkip;</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;                        toRead -= sectorSkip;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160; </div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;                        <span class="comment">//process all sectors of the cluster (and skip leading sectors if needed)</span></div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;                        <span class="keywordflow">if</span> (dataSkip &gt; 0) {</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;                                bufSize = mass_device-&gt;sectorSize - dataSkip;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;                                <span class="keywordflow">if</span> (size &lt; bufSize)</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;                                        bufSize = size;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160; </div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;                                ret = <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a309ac075dc146b705bad3872c73db72b">fat_readSingleSector</a>(fatd-&gt;<a class="code" href="structfat__driver.html#aef714ddc28773eb0da5b91b99129834d">dev</a>, startSector, <a class="code" href="sior_8c.html#a12a89c3c8fa5f42541ab342d3b88c82d">buffer</a> + bufferPos, bufSize, dataSkip);</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;                                <span class="keywordflow">if</span> (ret != 1) {</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;                                        <span class="keywordflow">return</span> bufferPos;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;                                }</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160; </div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;                                <span class="keywordflow">if</span>(size + dataSkip &gt;= mass_device-&gt;sectorSize)</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;                                        toRead--;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160; </div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;                                size -= bufSize;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;                                bufferPos += bufSize;</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;                                dataSkip = 0;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;                                startSector++;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;                        }</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160; </div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;                        <span class="keywordflow">if</span>(toRead &gt; 0) {</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;                                <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ad069d2c1ce77d9078affb2e5f23bcd0c">INVALIDATE_SECTORS</a>(fatd-&gt;<a class="code" href="structfat__driver.html#aef714ddc28773eb0da5b91b99129834d">dev</a>, startSector, toRead);</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;                                ret = <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a860a36d102edab0eef0d03304b981fdf">READ_SECTORS_RAW</a>(fatd-&gt;<a class="code" href="structfat__driver.html#aef714ddc28773eb0da5b91b99129834d">dev</a>, startSector, toRead, <a class="code" href="sior_8c.html#a12a89c3c8fa5f42541ab342d3b88c82d">buffer</a> + bufferPos);</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;                                <span class="keywordflow">if</span> (ret != 0) {</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;                                        <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: Read sectors failed ! sector=%u (%u)\n&quot;</span>, startSector, toRead);</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;                                        <span class="keywordflow">return</span> bufferPos;</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;                                }</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160; </div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;                                bufSize = toRead * mass_device-&gt;sectorSize;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;                                size -= bufSize;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;                                bufferPos += bufSize;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;                                startSector += toRead;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;                        }</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160; </div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;                        <span class="keywordflow">if</span> (size &gt; 0 &amp;&amp; size &lt;= mass_device-&gt;sectorSize) {</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;                                bufSize = size;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160; </div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;                                ret = <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a309ac075dc146b705bad3872c73db72b">fat_readSingleSector</a>(fatd-&gt;<a class="code" href="structfat__driver.html#aef714ddc28773eb0da5b91b99129834d">dev</a>, startSector, <a class="code" href="sior_8c.html#a12a89c3c8fa5f42541ab342d3b88c82d">buffer</a> + bufferPos, bufSize, 0);</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;                                <span class="keywordflow">if</span> (ret != 1) {</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;                                        <span class="keywordflow">return</span> bufferPos;</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;                                }</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160; </div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;                                size -= bufSize;</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;                                bufferPos += bufSize;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;                        }</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160; </div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;                        sectorSkip = 0;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;                }</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;                clusterSkip = 0;</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;        }</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;        <span class="keywordflow">return</span> bufferPos;</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;}</div>
<div class="ttc" id="afs_2bdmfs__vfat_2src_2fat__driver_8c_html_a2132295b8b12475793629fcf9ae3f665"><div class="ttname"><a href="fs_2bdmfs__vfat_2src_2fat__driver_8c.html#a2132295b8b12475793629fcf9ae3f665">fat_getClusterAtFilePos</a></div><div class="ttdeci">void fat_getClusterAtFilePos(fat_driver *fatd, fat_dir *fatDir, unsigned int filePos, unsigned int *cluster, unsigned int *clusterPos)</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2fat__driver_8c_source.html#l00756">fat_driver.c:756</a></div></div>
<div class="ttc" id="asior_8c_html_a12a89c3c8fa5f42541ab342d3b88c82d"><div class="ttname"><a href="sior_8c.html#a12a89c3c8fa5f42541ab342d3b88c82d">buffer</a></div><div class="ttdeci">static union siorCommsData buffer</div><div class="ttdef"><b>Definition:</b> <a href="sior_8c_source.html#l00023">sior.c:28</a></div></div>
<div class="ttc" id="ausb_2usbhdfsd_2src_2fat__driver_8c_html_a309ac075dc146b705bad3872c73db72b"><div class="ttname"><a href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a309ac075dc146b705bad3872c73db72b">fat_readSingleSector</a></div><div class="ttdeci">static int fat_readSingleSector(mass_dev *dev, unsigned int sector, void *buffer, int size, int dataSkip)</div><div class="ttdef"><b>Definition:</b> <a href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00740">fat_driver.c:740</a></div></div>
<div class="ttc" id="ausb_2usbhdfsd_2src_2fat__driver_8c_html_a860a36d102edab0eef0d03304b981fdf"><div class="ttname"><a href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a860a36d102edab0eef0d03304b981fdf">READ_SECTORS_RAW</a></div><div class="ttdeci">#define READ_SECTORS_RAW(d, a, c, b)</div><div class="ttdef"><b>Definition:</b> <a href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00032">fat_driver.c:32</a></div></div>
<div class="ttc" id="ausb_2usbhdfsd_2src_2fat__driver_8c_html_ad069d2c1ce77d9078affb2e5f23bcd0c"><div class="ttname"><a href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ad069d2c1ce77d9078affb2e5f23bcd0c">INVALIDATE_SECTORS</a></div><div class="ttdeci">#define INVALIDATE_SECTORS(d, s, c)</div><div class="ttdef"><b>Definition:</b> <a href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00033">fat_driver.c:33</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="sior_8c_source.html#l00028">buffer</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00072">fat_driver::cbuf</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00048">fat_bpb::clusterSize</a>, <a class="el" href="iLink_2IEEE1394__disk_2src_2include_2fat__driver_8h_source.html#l00036">fat_driver::dev</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00145">fat_cluster2sector()</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2fat__driver_8c_source.html#l00756">fat_getClusterAtFilePos()</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2fat__driver_8c_source.html#l00235">fat_getClusterChain()</a>, <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00740">fat_readSingleSector()</a>, <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00033">INVALIDATE_SECTORS</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00071">MAX_DIR_CLUSTER</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00068">fat_driver::partBpb</a>, <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00032">READ_SECTORS_RAW</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00047">fat_bpb::sectorSize</a>, and <a class="el" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h_source.html#l00008">XPRINTF</a>.</p>

</div>
</div>
<a id="a309ac075dc146b705bad3872c73db72b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a309ac075dc146b705bad3872c73db72b">&#9670;&nbsp;</a></span>fat_readSingleSector()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int fat_readSingleSector </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structmass__dev.html">mass_dev</a> *&#160;</td>
          <td class="paramname"><em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>sector</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dataSkip</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00740">740</a> of file <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html">fat_driver.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                                                                                                          {</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* <a class="code" href="fs_2bdm_2src_2part__driver_8c.html#a6d4ae1f692b64a14d19895e323c7b853">sbuf</a> = <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; <span class="comment">//sector buffer</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        <span class="keywordtype">int</span> ret;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160; </div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        ret = <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ae328738f080a00611208ca42cb103e04">READ_SECTOR</a>(dev, sector, <a class="code" href="fs_2bdm_2src_2part__driver_8c.html#a6d4ae1f692b64a14d19895e323c7b853">sbuf</a>);</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: Read sector failed ! sector=%u\n&quot;</span>, sector);</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        }</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160; </div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        <a class="code" href="sysclib_8h.html#ad1b7311b48288a0d08172f26ff64dd67">memcpy</a>(<a class="code" href="sior_8c.html#a12a89c3c8fa5f42541ab342d3b88c82d">buffer</a>, <a class="code" href="fs_2bdm_2src_2part__driver_8c.html#a6d4ae1f692b64a14d19895e323c7b853">sbuf</a> + dataSkip, size);</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160; </div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;}</div>
<div class="ttc" id="asysclib_8h_html_ad1b7311b48288a0d08172f26ff64dd67"><div class="ttname"><a href="sysclib_8h.html#ad1b7311b48288a0d08172f26ff64dd67">memcpy</a></div><div class="ttdeci">void * memcpy(void *dest, const void *src, size_t size)</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="sior_8c_source.html#l00028">buffer</a>, <a class="el" href="sysclib_8h.html#ad1b7311b48288a0d08172f26ff64dd67">memcpy()</a>, <a class="el" href="defs_8h_source.html#l00022">NULL</a>, <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00031">READ_SECTOR</a>, <a class="el" href="fs_2bdm_2src_2part__driver_8c_source.html#l00064">sbuf</a>, and <a class="el" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h_source.html#l00008">XPRINTF</a>.</p>

<p class="reference">Referenced by <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00755">fat_readFile()</a>.</p>

</div>
</div>
<a id="a201fa4870033ca4ecd729047edd05be4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a201fa4870033ca4ecd729047edd05be4">&#9670;&nbsp;</a></span>fat_setFatDir()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void fat_setFatDir </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfat__driver.html">fat_driver</a> *&#160;</td>
          <td class="paramname"><em>fatd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfat__dir.html">fat_dir</a> *&#160;</td>
          <td class="paramname"><em>fatDir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>parentDirCluster</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfat__direntry__sfn.html">fat_direntry_sfn</a> *&#160;</td>
          <td class="paramname"><em>dsfn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfat__direntry__summary.html">fat_direntry_summary</a> *&#160;</td>
          <td class="paramname"><em>dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>getClusterInfo</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00513">513</a> of file <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html">fat_driver.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                                                                                                                                                                    {</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        <span class="keywordtype">char</span>* srcName;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160; </div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: setting fat dir...\n&quot;</span>);</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        srcName = dir-&gt;<a class="code" href="structfat__direntry__summary.html#a612974fb21a07051bdef981810d07efc">sname</a>;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <span class="keywordflow">if</span> (dir-&gt;<a class="code" href="structfat__direntry__summary.html#a731c27293c20abff15634b96aa625d8b">name</a>[0] != 0) { <span class="comment">//long filename not empty</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                srcName = dir-&gt;<a class="code" href="structfat__direntry__summary.html#a731c27293c20abff15634b96aa625d8b">name</a>;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        }</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        <span class="comment">//copy name</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        <span class="keywordflow">for</span> (i = 0; srcName[i] != 0; i++) fatDir-&gt;<a class="code" href="structfat__dir.html#aaca269321e4de97bdee90d1848834a71">name</a>[i] = srcName[i];</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        fatDir-&gt;<a class="code" href="structfat__dir.html#aaca269321e4de97bdee90d1848834a71">name</a>[i] = 0; <span class="comment">//terminate</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160; </div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        fatDir-&gt;<a class="code" href="structfat__dir.html#aaba9fc8582badd71d8403274f8e65030">attr</a> = dir-&gt;<a class="code" href="structfat__direntry__summary.html#a47299e884846ba00bef7ec883483ff3a">attr</a>;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        fatDir-&gt;<a class="code" href="structfat__dir.html#a96cc07046d02e2212cca338482ce0a55">size</a> = dir-&gt;<a class="code" href="structfat__direntry__summary.html#ac0088c089e563801a1c4171b79522e77">size</a>;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160; </div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        <span class="comment">//created Date: Day, Month, Year-low, Year-high</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        fatDir-&gt;<a class="code" href="structfat__dir.html#a037ba61a81fbc63563c10d4c359bd1aa">cdate</a>[0] = (dsfn-&gt;<a class="code" href="structfat__direntry__sfn.html#a1f96e2109dbf3a068f3cd1478ae70e58">dateCreate</a>[0] &amp; 0x1F);</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        fatDir-&gt;<a class="code" href="structfat__dir.html#a037ba61a81fbc63563c10d4c359bd1aa">cdate</a>[1] = (dsfn-&gt;<a class="code" href="structfat__direntry__sfn.html#a1f96e2109dbf3a068f3cd1478ae70e58">dateCreate</a>[0] &gt;&gt; 5) + ((dsfn-&gt;<a class="code" href="structfat__direntry__sfn.html#a1f96e2109dbf3a068f3cd1478ae70e58">dateCreate</a>[1] &amp; 0x01) &lt;&lt; 3 );</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        i = 1980 + (dsfn-&gt;<a class="code" href="structfat__direntry__sfn.html#a1f96e2109dbf3a068f3cd1478ae70e58">dateCreate</a>[1] &gt;&gt; 1);</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        fatDir-&gt;<a class="code" href="structfat__dir.html#a037ba61a81fbc63563c10d4c359bd1aa">cdate</a>[2] = (i &amp; 0xFF);</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        fatDir-&gt;<a class="code" href="structfat__dir.html#a037ba61a81fbc63563c10d4c359bd1aa">cdate</a>[3] = ((i &amp; 0xFF00)&gt;&gt; 8);</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160; </div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        <span class="comment">//created Time: Hours, Minutes, Seconds</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        fatDir-&gt;<a class="code" href="structfat__dir.html#a6f4700fe46dedbe664dcb8306f15c8da">ctime</a>[0] = ((dsfn-&gt;<a class="code" href="structfat__direntry__sfn.html#aa8c52036a01db97d0596b6f2862ae1bc">timeCreate</a>[1] &amp; 0xF8) &gt;&gt; 3);</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        fatDir-&gt;<a class="code" href="structfat__dir.html#a6f4700fe46dedbe664dcb8306f15c8da">ctime</a>[1] = ((dsfn-&gt;<a class="code" href="structfat__direntry__sfn.html#aa8c52036a01db97d0596b6f2862ae1bc">timeCreate</a>[1] &amp; 0x07) &lt;&lt; 3) + ((dsfn-&gt;<a class="code" href="structfat__direntry__sfn.html#aa8c52036a01db97d0596b6f2862ae1bc">timeCreate</a>[0] &amp; 0xE0) &gt;&gt; 5);</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        fatDir-&gt;<a class="code" href="structfat__dir.html#a6f4700fe46dedbe664dcb8306f15c8da">ctime</a>[2] = ((dsfn-&gt;<a class="code" href="structfat__direntry__sfn.html#aa8c52036a01db97d0596b6f2862ae1bc">timeCreate</a>[0] &amp; 0x1F) &lt;&lt; 1);</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160; </div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        <span class="comment">//accessed Date: Day, Month, Year-low, Year-high</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        fatDir-&gt;<a class="code" href="structfat__dir.html#ac536cc4fb136e9ca45bee22fc5b22f34">adate</a>[0] = (dsfn-&gt;<a class="code" href="structfat__direntry__sfn.html#a1942b47c96b49dbc9b508722c3734193">dateAccess</a>[0] &amp; 0x1F);</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        fatDir-&gt;<a class="code" href="structfat__dir.html#ac536cc4fb136e9ca45bee22fc5b22f34">adate</a>[1] = (dsfn-&gt;<a class="code" href="structfat__direntry__sfn.html#a1942b47c96b49dbc9b508722c3734193">dateAccess</a>[0] &gt;&gt; 5) + ((dsfn-&gt;<a class="code" href="structfat__direntry__sfn.html#a1942b47c96b49dbc9b508722c3734193">dateAccess</a>[1] &amp; 0x01) &lt;&lt; 3 );</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        i = 1980 + (dsfn-&gt;<a class="code" href="structfat__direntry__sfn.html#a1942b47c96b49dbc9b508722c3734193">dateAccess</a>[1] &gt;&gt; 1);</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        fatDir-&gt;<a class="code" href="structfat__dir.html#ac536cc4fb136e9ca45bee22fc5b22f34">adate</a>[2] = (i &amp; 0xFF);</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        fatDir-&gt;<a class="code" href="structfat__dir.html#ac536cc4fb136e9ca45bee22fc5b22f34">adate</a>[3] = ((i &amp; 0xFF00)&gt;&gt; 8);</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160; </div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        <span class="comment">//modified Date: Day, Month, Year-low, Year-high</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        fatDir-&gt;<a class="code" href="structfat__dir.html#ad4d4c4039b65d2cdf7a1315f5477785c">mdate</a>[0] = (dsfn-&gt;<a class="code" href="structfat__direntry__sfn.html#ad1f0ac8f5eb86339965cc0f273dd7c4c">dateWrite</a>[0] &amp; 0x1F);</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        fatDir-&gt;<a class="code" href="structfat__dir.html#ad4d4c4039b65d2cdf7a1315f5477785c">mdate</a>[1] = (dsfn-&gt;<a class="code" href="structfat__direntry__sfn.html#ad1f0ac8f5eb86339965cc0f273dd7c4c">dateWrite</a>[0] &gt;&gt; 5) + ((dsfn-&gt;<a class="code" href="structfat__direntry__sfn.html#ad1f0ac8f5eb86339965cc0f273dd7c4c">dateWrite</a>[1] &amp; 0x01) &lt;&lt; 3 );</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        i = 1980 + (dsfn-&gt;<a class="code" href="structfat__direntry__sfn.html#ad1f0ac8f5eb86339965cc0f273dd7c4c">dateWrite</a>[1] &gt;&gt; 1);</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        fatDir-&gt;<a class="code" href="structfat__dir.html#ad4d4c4039b65d2cdf7a1315f5477785c">mdate</a>[2] = (i &amp; 0xFF);</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        fatDir-&gt;<a class="code" href="structfat__dir.html#ad4d4c4039b65d2cdf7a1315f5477785c">mdate</a>[3] = ((i &amp; 0xFF00)&gt;&gt; 8);</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160; </div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        <span class="comment">//modified Time: Hours, Minutes, Seconds</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        fatDir-&gt;<a class="code" href="structfat__dir.html#a414855f1aaf74f0c44ca1f4ff48b2e15">mtime</a>[0] = ((dsfn-&gt;<a class="code" href="structfat__direntry__sfn.html#afc1ebaad2d99f34f8fe99e471749e1d4">timeWrite</a>[1] &amp; 0xF8) &gt;&gt; 3);</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        fatDir-&gt;<a class="code" href="structfat__dir.html#a414855f1aaf74f0c44ca1f4ff48b2e15">mtime</a>[1] = ((dsfn-&gt;<a class="code" href="structfat__direntry__sfn.html#afc1ebaad2d99f34f8fe99e471749e1d4">timeWrite</a>[1] &amp; 0x07) &lt;&lt; 3) + ((dsfn-&gt;<a class="code" href="structfat__direntry__sfn.html#afc1ebaad2d99f34f8fe99e471749e1d4">timeWrite</a>[0] &amp; 0xE0) &gt;&gt; 5);</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        fatDir-&gt;<a class="code" href="structfat__dir.html#a414855f1aaf74f0c44ca1f4ff48b2e15">mtime</a>[2] = ((dsfn-&gt;<a class="code" href="structfat__direntry__sfn.html#afc1ebaad2d99f34f8fe99e471749e1d4">timeWrite</a>[0] &amp; 0x1F) &lt;&lt; 1);</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160; </div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        fatDir-&gt;<a class="code" href="structfat__dir.html#aba046815960ef888c084fa51a24a5485">chain</a>[0].<a class="code" href="structfat__dir__chain__record.html#a7a11d0e531c6b1eb105301ba7e165a9c">cluster</a> = dir-&gt;<a class="code" href="structfat__direntry__summary.html#afa7836ddc180210650db2f456f6da285">cluster</a>;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        fatDir-&gt;<a class="code" href="structfat__dir.html#aba046815960ef888c084fa51a24a5485">chain</a>[0].<a class="code" href="structfat__dir__chain__record.html#a0da35f7bf9611f26bc7300d74ca4270c">index</a>  = 0;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        <span class="keywordflow">if</span> (getClusterInfo) {</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                <a class="code" href="fs_2bdmfs__vfat_2src_2fat__driver_8c.html#a5a0c248aa5373a0f923fdb9a87c43d1a">fat_setFatDirChain</a>(fatd, fatDir);</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        }</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160; </div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        fatDir-&gt;<a class="code" href="structfat__dir.html#a71c83fac088f563c68a6ed7e54bdb1b7">parentDirCluster</a> = parentDirCluster;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        fatDir-&gt;<a class="code" href="structfat__dir.html#a9afe24b845315773ac1ca98c068cae0c">startCluster</a> = dir-&gt;<a class="code" href="structfat__direntry__summary.html#afa7836ddc180210650db2f456f6da285">cluster</a>;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;}</div>
<div class="ttc" id="afs_2bdmfs__vfat_2src_2fat__driver_8c_html_a5a0c248aa5373a0f923fdb9a87c43d1a"><div class="ttname"><a href="fs_2bdmfs__vfat_2src_2fat__driver_8c.html#a5a0c248aa5373a0f923fdb9a87c43d1a">fat_setFatDirChain</a></div><div class="ttdeci">void fat_setFatDirChain(fat_driver *fatd, fat_dir *fatDir)</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2fat__driver_8c_source.html#l00474">fat_driver.c:474</a></div></div>
<div class="ttc" id="astructfat__dir_html_a037ba61a81fbc63563c10d4c359bd1aa"><div class="ttname"><a href="structfat__dir.html#a037ba61a81fbc63563c10d4c359bd1aa">fat_dir::cdate</a></div><div class="ttdeci">unsigned char cdate[4]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00032">fat_driver.h:32</a></div></div>
<div class="ttc" id="astructfat__dir_html_a414855f1aaf74f0c44ca1f4ff48b2e15"><div class="ttname"><a href="structfat__dir.html#a414855f1aaf74f0c44ca1f4ff48b2e15">fat_dir::mtime</a></div><div class="ttdeci">unsigned char mtime[3]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00037">fat_driver.h:37</a></div></div>
<div class="ttc" id="astructfat__dir_html_a6f4700fe46dedbe664dcb8306f15c8da"><div class="ttname"><a href="structfat__dir.html#a6f4700fe46dedbe664dcb8306f15c8da">fat_dir::ctime</a></div><div class="ttdeci">unsigned char ctime[3]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00033">fat_driver.h:33</a></div></div>
<div class="ttc" id="astructfat__dir_html_a71c83fac088f563c68a6ed7e54bdb1b7"><div class="ttname"><a href="structfat__dir.html#a71c83fac088f563c68a6ed7e54bdb1b7">fat_dir::parentDirCluster</a></div><div class="ttdeci">unsigned int parentDirCluster</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00039">fat_driver.h:39</a></div></div>
<div class="ttc" id="astructfat__dir_html_a96cc07046d02e2212cca338482ce0a55"><div class="ttname"><a href="structfat__dir.html#a96cc07046d02e2212cca338482ce0a55">fat_dir::size</a></div><div class="ttdeci">unsigned int size</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00038">fat_driver.h:38</a></div></div>
<div class="ttc" id="astructfat__dir_html_a9afe24b845315773ac1ca98c068cae0c"><div class="ttname"><a href="structfat__dir.html#a9afe24b845315773ac1ca98c068cae0c">fat_dir::startCluster</a></div><div class="ttdeci">unsigned int startCluster</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00040">fat_driver.h:40</a></div></div>
<div class="ttc" id="astructfat__dir_html_aaca269321e4de97bdee90d1848834a71"><div class="ttname"><a href="structfat__dir.html#aaca269321e4de97bdee90d1848834a71">fat_dir::name</a></div><div class="ttdeci">char name[FAT_MAX_NAME]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00031">fat_driver.h:31</a></div></div>
<div class="ttc" id="astructfat__dir_html_ac536cc4fb136e9ca45bee22fc5b22f34"><div class="ttname"><a href="structfat__dir.html#ac536cc4fb136e9ca45bee22fc5b22f34">fat_dir::adate</a></div><div class="ttdeci">unsigned char adate[4]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00034">fat_driver.h:34</a></div></div>
<div class="ttc" id="astructfat__dir_html_ad4d4c4039b65d2cdf7a1315f5477785c"><div class="ttname"><a href="structfat__dir.html#ad4d4c4039b65d2cdf7a1315f5477785c">fat_dir::mdate</a></div><div class="ttdeci">unsigned char mdate[4]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00036">fat_driver.h:36</a></div></div>
<div class="ttc" id="astructfat__direntry__sfn_html_a1942b47c96b49dbc9b508722c3734193"><div class="ttname"><a href="structfat__direntry__sfn.html#a1942b47c96b49dbc9b508722c3734193">fat_direntry_sfn::dateAccess</a></div><div class="ttdeci">unsigned char dateAccess[2]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00105">fat.h:105</a></div></div>
<div class="ttc" id="astructfat__direntry__sfn_html_a1f96e2109dbf3a068f3cd1478ae70e58"><div class="ttname"><a href="structfat__direntry__sfn.html#a1f96e2109dbf3a068f3cd1478ae70e58">fat_direntry_sfn::dateCreate</a></div><div class="ttdeci">unsigned char dateCreate[2]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00104">fat.h:104</a></div></div>
<div class="ttc" id="astructfat__direntry__sfn_html_aa8c52036a01db97d0596b6f2862ae1bc"><div class="ttname"><a href="structfat__direntry__sfn.html#aa8c52036a01db97d0596b6f2862ae1bc">fat_direntry_sfn::timeCreate</a></div><div class="ttdeci">unsigned char timeCreate[2]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00103">fat.h:103</a></div></div>
<div class="ttc" id="astructfat__direntry__sfn_html_ad1f0ac8f5eb86339965cc0f273dd7c4c"><div class="ttname"><a href="structfat__direntry__sfn.html#ad1f0ac8f5eb86339965cc0f273dd7c4c">fat_direntry_sfn::dateWrite</a></div><div class="ttdeci">unsigned char dateWrite[2]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00109">fat.h:109</a></div></div>
<div class="ttc" id="astructfat__direntry__sfn_html_afc1ebaad2d99f34f8fe99e471749e1d4"><div class="ttname"><a href="structfat__direntry__sfn.html#afc1ebaad2d99f34f8fe99e471749e1d4">fat_direntry_sfn::timeWrite</a></div><div class="ttdeci">unsigned char timeWrite[2]</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00108">fat.h:108</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00034">fat_dir::adate</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00137">fat_direntry_summary::attr</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00030">fat_dir::attr</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00032">fat_dir::cdate</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00043">fat_dir::chain</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00141">fat_direntry_summary::cluster</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00025">fat_dir_chain_record::cluster</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00033">fat_dir::ctime</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00105">fat_direntry_sfn::dateAccess</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00104">fat_direntry_sfn::dateCreate</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00109">fat_direntry_sfn::dateWrite</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2fat__driver_8c_source.html#l00474">fat_setFatDirChain()</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00026">fat_dir_chain_record::index</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00036">fat_dir::mdate</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00037">fat_dir::mtime</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00138">fat_direntry_summary::name</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00031">fat_dir::name</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00039">fat_dir::parentDirCluster</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00140">fat_direntry_summary::size</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00038">fat_dir::size</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00139">fat_direntry_summary::sname</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00040">fat_dir::startCluster</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00103">fat_direntry_sfn::timeCreate</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat_8h_source.html#l00108">fat_direntry_sfn::timeWrite</a>, and <a class="el" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h_source.html#l00008">XPRINTF</a>.</p>

<p class="reference">Referenced by <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00599">fat_getDirentryStartCluster()</a>, and <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00888">fat_getNextDirentry()</a>.</p>

</div>
</div>
<a id="a5a0c248aa5373a0f923fdb9a87c43d1a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a0c248aa5373a0f923fdb9a87c43d1a">&#9670;&nbsp;</a></span>fat_setFatDirChain()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fat_setFatDirChain </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfat__driver.html">fat_driver</a> *&#160;</td>
          <td class="paramname"><em>fatd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfat__dir.html">fat_dir</a> *&#160;</td>
          <td class="paramname"><em>fatDir</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00448">448</a> of file <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html">fat_driver.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                                                           {</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        <span class="keywordtype">int</span> i,j;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="sysclib_8h.html#a1d3748ca570dcb09a2fb28e8015107dd">index</a>, clusterChainStart, fileCluster, fileSize, blockSize;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> nextChain;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <span class="keywordtype">int</span> chainSize;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160; </div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: reading cluster chain  \n&quot;</span>);</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        fileCluster = fatDir-&gt;<a class="code" href="structfat__dir.html#aba046815960ef888c084fa51a24a5485">chain</a>[0].<a class="code" href="structfat__dir__chain__record.html#a7a11d0e531c6b1eb105301ba7e165a9c">cluster</a>;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160; </div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        <span class="keywordflow">if</span> (fileCluster &lt; 2) {</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD:    early exit... \n&quot;</span>);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        }</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160; </div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        fileSize = fatDir-&gt;<a class="code" href="structfat__dir.html#a96cc07046d02e2212cca338482ce0a55">size</a>;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        blockSize = fileSize / <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a142dc81af7f167c205cf2328b1d4e5fa">DIR_CHAIN_SIZE</a>;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160; </div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        nextChain = 1;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        clusterChainStart = 0;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        j = 1;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        fileSize = 0;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        <a class="code" href="sysclib_8h.html#a1d3748ca570dcb09a2fb28e8015107dd">index</a> = 0;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160; </div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <span class="keywordflow">while</span> (nextChain) {</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                <span class="keywordflow">if</span>((chainSize = <a class="code" href="fs_2bdmfs__vfat_2src_2fat__driver_8c.html#a04f7d3056137a9a46fa5735e8a38f730">fat_getClusterChain</a>(fatd, fileCluster, fatd-&gt;<a class="code" href="structfat__driver.html#a62c4794e13845244b324409ebfb71919">cbuf</a>, <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a8f3ada716b434a6f52c4cfbb919d3be4">MAX_DIR_CLUSTER</a>, 1)) &gt;=0){</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                        <span class="keywordflow">if</span> (chainSize &gt;= <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a8f3ada716b434a6f52c4cfbb919d3be4">MAX_DIR_CLUSTER</a>) { <span class="comment">//the chain is full, but more chain parts exist</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                                fileCluster = fatd-&gt;<a class="code" href="structfat__driver.html#a62c4794e13845244b324409ebfb71919">cbuf</a>[<a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a8f3ada716b434a6f52c4cfbb919d3be4">MAX_DIR_CLUSTER</a> - 1];</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                        }<span class="keywordflow">else</span> { <span class="comment">//chain fits in the chain buffer completely - no next chain exist</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                                nextChain = 0;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                        }</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                        <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: fat_setFatDirChain(): fat_getClusterChain() failed: %d\n&quot;</span>, chainSize);</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                }</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160; </div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                <span class="comment">//process the cluster chain (fatd-&gt;cbuf)</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                <span class="keywordflow">for</span> (i = clusterChainStart; i &lt; chainSize; i++) {</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                        fileSize += (fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#a1cf892c4c80adcc3500ca90baab803b5">clusterSize</a> * fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#aec6b3ab436f1855028e3564a5755dd69">sectorSize</a>);</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                        <span class="keywordflow">while</span> (fileSize &gt;= (j * blockSize) &amp;&amp; j &lt; <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a142dc81af7f167c205cf2328b1d4e5fa">DIR_CHAIN_SIZE</a>) {</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                                fatDir-&gt;<a class="code" href="structfat__dir.html#aba046815960ef888c084fa51a24a5485">chain</a>[j].<a class="code" href="structfat__dir__chain__record.html#a7a11d0e531c6b1eb105301ba7e165a9c">cluster</a> = fatd-&gt;<a class="code" href="structfat__driver.html#a62c4794e13845244b324409ebfb71919">cbuf</a>[i];</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                                fatDir-&gt;<a class="code" href="structfat__dir.html#aba046815960ef888c084fa51a24a5485">chain</a>[j].<a class="code" href="structfat__dir__chain__record.html#a0da35f7bf9611f26bc7300d74ca4270c">index</a> = <a class="code" href="sysclib_8h.html#a1d3748ca570dcb09a2fb28e8015107dd">index</a>;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                                j++;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                        }<span class="comment">//ends &quot;while&quot;</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                        <a class="code" href="sysclib_8h.html#a1d3748ca570dcb09a2fb28e8015107dd">index</a>++;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                }<span class="comment">//ends &quot;for&quot;</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                clusterChainStart = 1;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        }<span class="comment">//ends &quot;while&quot;</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        fatDir-&gt;<a class="code" href="structfat__dir.html#a46a941db1e1b6a823fbc3a3fb6d79f92">lastCluster</a> = fatd-&gt;<a class="code" href="structfat__driver.html#a62c4794e13845244b324409ebfb71919">cbuf</a>[i-1];</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160; </div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="preprocessor">#ifdef DEBUG_EXTREME </span><span class="comment">//dlanor: I patched this because this bloat hid important stuff</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        <span class="comment">//debug</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: SEEK CLUSTER CHAIN CACHE fileSize=%u blockSize=%u \n&quot;</span>, fatDir-&gt;<a class="code" href="structfat__dir.html#a96cc07046d02e2212cca338482ce0a55">size</a>, blockSize);</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h.html#a142dc81af7f167c205cf2328b1d4e5fa">DIR_CHAIN_SIZE</a>; i++) {</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: index=%u cluster=%u offset= %u - %u start=%u \n&quot;</span>,</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                        fatDir-&gt;<a class="code" href="structfat__dir.html#aba046815960ef888c084fa51a24a5485">chain</a>[i].<a class="code" href="structfat__dir__chain__record.html#a0da35f7bf9611f26bc7300d74ca4270c">index</a>, fatDir-&gt;<a class="code" href="structfat__dir.html#aba046815960ef888c084fa51a24a5485">chain</a>[i].<a class="code" href="structfat__dir__chain__record.html#a7a11d0e531c6b1eb105301ba7e165a9c">cluster</a>,</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                        fatDir-&gt;<a class="code" href="structfat__dir.html#aba046815960ef888c084fa51a24a5485">chain</a>[i].<a class="code" href="structfat__dir__chain__record.html#a0da35f7bf9611f26bc7300d74ca4270c">index</a> * fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#a1cf892c4c80adcc3500ca90baab803b5">clusterSize</a> * fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#aec6b3ab436f1855028e3564a5755dd69">sectorSize</a>,</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                        (fatDir-&gt;<a class="code" href="structfat__dir.html#aba046815960ef888c084fa51a24a5485">chain</a>[i].<a class="code" href="structfat__dir__chain__record.html#a0da35f7bf9611f26bc7300d74ca4270c">index</a>+1) * fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#a1cf892c4c80adcc3500ca90baab803b5">clusterSize</a> * fatd-&gt;<a class="code" href="structfat__driver.html#a11b132dd4e156c7a597339c0cef2cea6">partBpb</a>.<a class="code" href="structfat__bpb.html#aec6b3ab436f1855028e3564a5755dd69">sectorSize</a>,</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                        i * blockSize);</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        }</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* debug */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        <a class="code" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h.html#a730a51a001461c80e0268109f4bdf849">XPRINTF</a>(<span class="stringliteral">&quot;USBHDFSD: read cluster chain  done!\n&quot;</span>);</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;}</div>
<div class="ttc" id="astructfat__dir_html_a46a941db1e1b6a823fbc3a3fb6d79f92"><div class="ttname"><a href="structfat__dir.html#a46a941db1e1b6a823fbc3a3fb6d79f92">fat_dir::lastCluster</a></div><div class="ttdeci">unsigned int lastCluster</div><div class="ttdef"><b>Definition:</b> <a href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00042">fat_driver.h:42</a></div></div>
<div class="ttc" id="asysclib_8h_html_a1d3748ca570dcb09a2fb28e8015107dd"><div class="ttname"><a href="sysclib_8h.html#a1d3748ca570dcb09a2fb28e8015107dd">index</a></div><div class="ttdeci">char * index(const char *s, int c)</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00072">fat_driver::cbuf</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00043">fat_dir::chain</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00025">fat_dir_chain_record::cluster</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00048">fat_bpb::clusterSize</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00007">DIR_CHAIN_SIZE</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2fat__driver_8c_source.html#l00235">fat_getClusterChain()</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00026">fat_dir_chain_record::index</a>, <a class="el" href="sysclib_8h.html#a1d3748ca570dcb09a2fb28e8015107dd">index()</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00042">fat_dir::lastCluster</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00071">MAX_DIR_CLUSTER</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00068">fat_driver::partBpb</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00047">fat_bpb::sectorSize</a>, <a class="el" href="fs_2bdmfs__vfat_2src_2include_2fat__driver_8h_source.html#l00038">fat_dir::size</a>, and <a class="el" href="iLink_2IEEE1394__disk_2src_2include_2mass__debug_8h_source.html#l00008">XPRINTF</a>.</p>

</div>
</div>
<a id="a3a2036f7822d46473a88e7c707892b15"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3a2036f7822d46473a88e7c707892b15">&#9670;&nbsp;</a></span>InitFAT()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int InitFAT </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00039">39</a> of file <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html">fat_driver.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;{</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160; </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a2328493203f8da0a985673e0a369f196">NUM_DRIVES</a>; ++i)</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        <a class="code" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#ad8fbcb13516683f060e6e83e33b046ee">g_fatd</a>[i] = <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160; </div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00036">g_fatd</a>, <a class="el" href="defs_8h_source.html#l00022">NULL</a>, and <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00035">NUM_DRIVES</a>.</p>

<p class="reference">Referenced by <a class="el" href="fs_2bdmfs__vfat_2src_2main_8c_source.html#l00028">_start()</a>.</p>

</div>
</div>
<a id="ae21ac7e24598e16bdbd96bc2ab7114f0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae21ac7e24598e16bdbd96bc2ab7114f0">&#9670;&nbsp;</a></span>strEqual()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int strEqual </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>s1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>s2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00050">50</a> of file <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html">fat_driver.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;                                             {</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keywordtype">char</span> u1, u2;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                u1 = *<a class="code" href="as__reg__compat_8h.html#a09dff3d9a89874939fa7cc9d056b114c">s1</a>++;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;                u2 = *<a class="code" href="as__reg__compat_8h.html#a3ec77fc652b1787d9ace19f0f8fb6072">s2</a>++;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;                <span class="keywordflow">if</span> (u1 &gt;64 &amp;&amp; u1 &lt; 91)  u1+=32;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                <span class="keywordflow">if</span> (u2 &gt;64 &amp;&amp; u2 &lt; 91)  u2+=32;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;                <span class="keywordflow">if</span> (u1 != u2) {</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;                        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;                }</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                <span class="keywordflow">if</span> (u1 == <span class="charliteral">&#39;\0&#39;</span>) {</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                }</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    }</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;}</div>
<div class="ttc" id="aas__reg__compat_8h_html_a09dff3d9a89874939fa7cc9d056b114c"><div class="ttname"><a href="as__reg__compat_8h.html#a09dff3d9a89874939fa7cc9d056b114c">s1</a></div><div class="ttdeci">#define s1</div><div class="ttdef"><b>Definition:</b> <a href="as__reg__compat_8h_source.html#l00073">as_reg_compat.h:73</a></div></div>
<div class="ttc" id="aas__reg__compat_8h_html_a3ec77fc652b1787d9ace19f0f8fb6072"><div class="ttname"><a href="as__reg__compat_8h.html#a3ec77fc652b1787d9ace19f0f8fb6072">s2</a></div><div class="ttdeci">#define s2</div><div class="ttdef"><b>Definition:</b> <a href="as__reg__compat_8h_source.html#l00074">as_reg_compat.h:74</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="as__reg__compat_8h_source.html#l00073">s1</a>, and <a class="el" href="as__reg__compat_8h_source.html#l00074">s2</a>.</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ad8fbcb13516683f060e6e83e33b046ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad8fbcb13516683f060e6e83e33b046ee">&#9670;&nbsp;</a></span>g_fatd</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structfat__driver.html">fat_driver</a>* g_fatd[<a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c.html#a2328493203f8da0a985673e0a369f196">NUM_DRIVES</a>]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00036">36</a> of file <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html">fat_driver.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l01031">fat_forceUnmount()</a>, <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l01044">fat_getData()</a>, <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00984">fat_mount()</a>, and <a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c_source.html#l00039">InitFAT()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_0981ace215aa2029f526b70c145b9fbe.html">iop</a></li><li class="navelem"><a class="el" href="dir_b6c875632944d243a548db157cd77ec2.html">usb</a></li><li class="navelem"><a class="el" href="dir_b8874c233d466218401f983297aca89b.html">usbhdfsd</a></li><li class="navelem"><a class="el" href="dir_35e4cd4c6b68d708ba33184e89b685ac.html">src</a></li><li class="navelem"><a class="el" href="usb_2usbhdfsd_2src_2fat__driver_8c.html">fat_driver.c</a></li>
    <li class="footer">Generated on Thu Feb 11 2021 11:42:42 for ps2sdk by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
